{"version":3,"file":"use-collapse-item.js","sources":["uni_modules/tuniaoui-vue3/components/collapse/src/composables/use-collapse-item.ts"],"sourcesContent":["import {\r\n  computed,\r\n  getCurrentInstance,\r\n  inject,\r\n  nextTick,\r\n  onMounted,\r\n  ref,\r\n} from 'vue'\r\nimport { collapseContextKey } from '../../../../tokens'\r\nimport { useSelectorQuery } from '../../../../hooks'\r\nimport {\r\n  debugWarn,\r\n  generateId,\r\n  isEmptyVariableInDefault,\r\n} from '../../../../utils'\r\n\r\nimport type { CollapseItemProps } from '../collapse-item'\r\n\r\nexport const useCollapseItem = (props: CollapseItemProps) => {\r\n  const instance = getCurrentInstance()\r\n  if (!instance) {\r\n    debugWarn('TnCollapseItem', '请在 setup 函数中使用 TnCollapseItem')\r\n  }\r\n  const { uid } = instance!\r\n\r\n  const collapse = inject(collapseContextKey)\r\n  if (!collapse) {\r\n    debugWarn('TnCollapseItem', '请在 TnCollapse 中使用 TnCollapseItem')\r\n  }\r\n\r\n  collapse?.addItem({ uid })\r\n\r\n  const componentContentId = `tcic-${generateId()}`\r\n  const { getSelectorNodeInfo } = useSelectorQuery(instance)\r\n\r\n  // 当前组件是否为激活状态\r\n  const isActive = computed<boolean>(() => {\r\n    if (!collapse) return false\r\n    return collapse.activeUid.includes(uid)\r\n  })\r\n\r\n  // 是否显示折叠面板箭头\r\n  const showArrow = computed<boolean>(() =>\r\n    isEmptyVariableInDefault(collapse?.showArrow, false)\r\n  )\r\n\r\n  // 组件内容的高度\r\n  const compoenntContentDefaultHeight = ref<number>(0)\r\n  const componentTitleHeight = ref<number>(uni.upx2px(100))\r\n  const componentHeight = computed<string>(() => {\r\n    if (!isActive.value) return `${componentTitleHeight.value}px`\r\n    else\r\n      return `${\r\n        componentTitleHeight.value + compoenntContentDefaultHeight.value\r\n      }px`\r\n  })\r\n\r\n  let initCount = 0\r\n  // 获取内容容器高度\r\n  const getComponentContentHeight = async () => {\r\n    try {\r\n      const rectInfo = await getSelectorNodeInfo(`#${componentContentId}`)\r\n\r\n      initCount = 0\r\n      compoenntContentDefaultHeight.value = rectInfo.height || 0\r\n    } catch (err) {\r\n      if (initCount > 10) {\r\n        initCount = 0\r\n        debugWarn('TnCollapseItem', `获取内容高度失败: ${err}`)\r\n        return\r\n      }\r\n      initCount++\r\n      setTimeout(() => {\r\n        getComponentContentHeight()\r\n      }, 150)\r\n    }\r\n  }\r\n\r\n  // CollapseItem 点击事件\r\n  const collapseItemClick = () => {\r\n    if (props.disabled) return\r\n    collapse?.handleItemClick(uid)\r\n  }\r\n\r\n  onMounted(() => {\r\n    nextTick(() => {\r\n      getComponentContentHeight()\r\n    })\r\n  })\r\n\r\n  return {\r\n    componentContentId,\r\n    showArrow,\r\n    isActive,\r\n    componentHeight,\r\n    collapseItemClick,\r\n  }\r\n}\r\n"],"names":["getCurrentInstance","debugWarn","inject","collapseContextKey","generateId","useSelectorQuery","computed","isEmptyVariableInDefault","ref","uni","__awaiter","onMounted","nextTick"],"mappings":";;;;;;;;;AAkBO,MAAM,kBAAkB,CAAC,UAAwB;AACtD,QAAM,WAAWA,cAAAA;AACjB,MAAI,CAAC,UAAU;AACbC,mDAAU,kBAAkB,+BAA+B;AAAA,EAC5D;AACO,QAAA,MAAQ,SAAS;AAEzB,QAAM,WAAWC,qBAAOC,yCAAAA,kBAAkB;AAC1C,MAAI,CAAC,UAAU;AACbF,mDAAU,kBAAkB,kCAAkC;AAAA,EAC/D;AAED,eAAQ,QAAR,aAAQ,SAAA,SAAR,SAAU,QAAQ,EAAE,IAAG,CAAE;AAEzB,QAAM,qBAAqB,QAAQG,oCAAU,WAAA,CAAE;AACvC,QAAA,sBAAwBC,sDAAAA,iBAAiB,QAAQ;AAGzD,QAAM,WAAWC,cAAAA,SAAkB,MAAA;AACjC,QAAI,CAAC;AAAU,aAAO;AACtB,WAAO,SAAS,UAAU,SAAS,GAAG;AAAA,EACxC,CAAC;AAGD,QAAM,YAAYA,cAAAA,SAAkB,MAAA;AAClC,WAAAC,gEAAyB,aAAA,QAAA,aAAA,SAAA,SAAA,SAAU,WAAW,KAAK;AAAA,EAAnD,CAAoD;AAItD,QAAM,gCAAgCC,kBAAY,CAAC;AACnD,QAAM,uBAAuBA,cAAAA,IAAYC,cAAAA,MAAI,OAAO,GAAG,CAAC;AACxD,QAAM,kBAAkBH,cAAAA,SAAiB,MAAA;AACvC,QAAI,CAAC,SAAS;AAAO,aAAO,GAAG,qBAAqB,KAAK;AAAA;AAEvD,aAAO,GACL,qBAAqB,QAAQ,8BAA8B,KAC7D;AAAA,EACJ,CAAC;AAED,MAAI,YAAY;AAEhB,QAAM,4BAA4B,MAAA;AAAA,WAAAI,cAAA,UAAA,QAAA,QAAA,QAAA,aAAA;AAChC,UAAI;AACF,cAAM,WAAW,MAAM,oBAAoB,IAAI,kBAAkB,EAAE;AAEnE,oBAAY;AACZ,sCAA8B,QAAQ,SAAS,UAAU;AAAA,MAC1D,SAAQ,KAAK;AACZ,YAAI,YAAY,IAAI;AAClB,sBAAY;AACZT,+CAAAA,UAAU,kBAAkB,aAAa,GAAG,EAAE;AAC9C;AAAA,QACD;AACD;AACA,mBAAW,MAAA;AACT;QACD,GAAE,GAAG;AAAA,MACP;AAAA,IACF,CAAA;AAAA;AAGD,QAAM,oBAAoB,MAAA;AACxB,QAAI,MAAM;AAAU;AACpB,iBAAQ,QAAR,aAAA,SAAA,SAAA,SAAU,gBAAgB,GAAG;AAAA,EAC/B;AAEAU,gBAAAA,UAAU,MAAA;AACRC,kBAAAA,WAAS,MAAA;AACP;IACF,CAAC;AAAA,EACH,CAAC;AAED,SAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA;AAEJ;;"}