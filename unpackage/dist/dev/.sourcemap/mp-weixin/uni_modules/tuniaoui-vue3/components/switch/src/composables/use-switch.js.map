{"version":3,"file":"use-switch.js","sources":["uni_modules/tuniaoui-vue3/components/switch/src/composables/use-switch.ts"],"sourcesContent":["import { computed, getCurrentInstance, nextTick, watch } from 'vue'\nimport { debugWarn, isBoolean, isPromise } from '../../../../utils'\nimport { CHANGE_EVENT, UPDATE_MODEL_EVENT } from '../../../../constants'\nimport { useFormItem } from '../../../form'\nimport { useSwitchCommonProps } from './use-switch-common-props'\n\nimport type { SwitchProps } from '../switch'\n\nexport const useSwitch = (props: SwitchProps) => {\n  const { emit } = getCurrentInstance()!\n\n  const { formItem } = useFormItem()\n\n  const { disabled } = useSwitchCommonProps(props)\n\n  // 判断是否为选中状态\n  const selected = computed<boolean>(\n    () => props.modelValue === props.activeValue\n  )\n\n  // 处理切换事件\n  const handleSwitch = () => {\n    const value =\n      props.modelValue === props.activeValue\n        ? props.inactiveValue\n        : props.activeValue\n\n    emit(UPDATE_MODEL_EVENT, value)\n    nextTick(() => emit(CHANGE_EVENT, value))\n  }\n\n  // switch按钮的点击切换事件\n  const switchClickEvent = () => {\n    if (disabled.value || props.loading) return\n\n    const { beforeChange } = props\n    if (!beforeChange) {\n      handleSwitch()\n      return\n    }\n\n    const shouldChange = beforeChange()\n\n    const isPromiseOrBool = [\n      isPromise(shouldChange),\n      isBoolean(shouldChange),\n    ].includes(true)\n    if (!isPromiseOrBool) {\n      throw new Error(\n        '[TnSwitch] beforeChange 返回值必须是 Promise 或者 boolean'\n      )\n    }\n\n    if (isPromise(shouldChange)) {\n      shouldChange\n        .then((res) => {\n          if (res) handleSwitch()\n        })\n        .catch((err) => {\n          // eslint-disable-next-line no-console\n          console.warn(`[TnSwitch] some error occured: ${err}`)\n        })\n    } else if (shouldChange) {\n      handleSwitch()\n    }\n  }\n\n  watch(\n    () => props.modelValue,\n    () => {\n      if (props.validateEvent) {\n        formItem?.validate?.('change').catch((err) => {\n          debugWarn(err)\n        })\n      }\n    }\n  )\n\n  return {\n    selected,\n    switchClickEvent,\n  }\n}\n"],"names":["getCurrentInstance","useFormItem","useSwitchCommonProps","computed","UPDATE_MODEL_EVENT","nextTick","CHANGE_EVENT","isPromise","isBoolean","uni","watch","debugWarn"],"mappings":";;;;;;;;;AAQO,MAAM,YAAY,CAAC,UAAkB;AAClC,QAAA,OAASA,iCAAqB;AAE9B,QAAA,WAAaC,iFAAa;AAE1B,QAAA,WAAaC,gFAAAA,qBAAqB,KAAK;AAG/C,QAAM,WAAWC,uBACf,MAAA;AAAM,WAAA,MAAM,eAAe,MAAM;AAAA,EAA3B,CAAsC;AAI9C,QAAM,eAAe,MAAA;AACnB,UAAM,QACJ,MAAM,eAAe,MAAM,cACvB,MAAM,gBACN,MAAM;AAEZ,SAAKC,yCAAAA,oBAAoB,KAAK;AAC9BC,kBAAQ,WAAC,MAAA;AAAM,aAAA,KAAKC,yCAAY,cAAE,KAAK;AAAA,IAAC,CAAA;AAAA,EAC1C;AAGA,QAAM,mBAAmB,MAAA;AACvB,QAAI,SAAS,SAAS,MAAM;AAAS;AAE7B,UAAA,eAAiB,MAAK;AAC9B,QAAI,CAAC,cAAc;AACjB;AACA;AAAA,IACD;AAED,UAAM,eAAe;AAErB,UAAM,kBAAkB;AAAA,MACtBC,cAAAA,UAAU,YAAY;AAAA,MACtBC,+CAAAA,UAAU,YAAY;AAAA,IACvB,EAAC,SAAS,IAAI;AACf,QAAI,CAAC,iBAAiB;AACpB,YAAM,IAAI,MACR,mDAAmD;AAAA,IAEtD;AAED,QAAID,cAAAA,UAAU,YAAY,GAAG;AAC3B,mBACG,KAAK,CAAC,QAAG;AACR,YAAI;AAAK;MACX,CAAC,EACA,MAAM,CAAC,QAAG;AAETE,sBAAa,MAAA,MAAA,QAAA,mFAAA,kCAAkC,GAAG,EAAE;AAAA,MACtD,CAAC;AAAA,IACJ,WAAU,cAAc;AACvB;IACD;AAAA,EACH;AAEAC,gBAAAA,MACE;AAAM,WAAA,MAAM;AAAA,EAAU,GACtB,MAAA;;AACE,QAAI,MAAM,eAAe;AACvB,OAAA,KAAA,aAAQ,QAAR,aAAQ,SAAA,SAAR,SAAU,cAAQ,QAAA,OAAA,SAAA,SAAA,GAAA,KAAA,UAAG,QAAQ,EAAE,MAAM,CAAC,QAAG;AACvCC,6CAAS,UAAC,GAAG;AAAA,MACf,CAAC;AAAA,IACF;AAAA,EACH,CAAC;AAGH,SAAO;AAAA,IACL;AAAA,IACA;AAAA;AAEJ;;"}