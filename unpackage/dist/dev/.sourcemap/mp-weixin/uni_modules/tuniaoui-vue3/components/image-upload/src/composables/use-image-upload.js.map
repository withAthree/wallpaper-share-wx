{"version":3,"file":"use-image-upload.js","sources":["uni_modules/tuniaoui-vue3/components/image-upload/src/composables/use-image-upload.ts"],"sourcesContent":["import { computed, getCurrentInstance, nextTick, ref, watch } from 'vue'\r\nimport { CHANGE_EVENT, UPDATE_MODEL_EVENT } from '../../../../constants'\r\nimport { debugWarn, isBoolean, isPromise, throwError } from '../../../../utils'\r\nimport { useFormItem } from '../../../form'\r\nimport useUploadHandleFunction from './use-upload-handle-function'\r\n\r\nimport type { ImageUploadList, ImageUploadListItem } from '../types'\r\nimport type { ImageUploadProps } from '../image-upload'\r\n\r\nexport const useImageUpload = (props: ImageUploadProps) => {\r\n  const { emit } = getCurrentInstance()!\r\n  const {\r\n    chooseImage,\r\n    uploadProcess,\r\n    checkFileSizeAndExtension,\r\n    showErrorTips,\r\n  } = useUploadHandleFunction(props)\r\n\r\n  const { formItem } = useFormItem()\r\n\r\n  // 文件列表\r\n  const fileList = ref<ImageUploadList>([])\r\n\r\n  // 监听文件列表变化\r\n  let isInnerUpdate = false\r\n  watch(\r\n    () => props.modelValue,\r\n    (val) => {\r\n      if (isInnerUpdate) {\r\n        isInnerUpdate = false\r\n        return\r\n      }\r\n\r\n      fileList.value = val.map((item) => ({\r\n        url: item,\r\n        status: 'done',\r\n        progress: 100,\r\n      }))\r\n    },\r\n    {\r\n      immediate: true,\r\n    }\r\n  )\r\n\r\n  // 判断是否超过最大上传数\r\n  const isExceedMaxCount = computed<boolean>(\r\n    () => fileList.value.length >= props.limit\r\n  )\r\n  // 当前剩余可选文件数量\r\n  const currentRemainFileCount = computed<number>(() => {\r\n    if (props.multiple) {\r\n      return props.limit - fileList.value.length\r\n    } else {\r\n      return props.limit - fileList.value.length > 0 ? 1 : 0\r\n    }\r\n  })\r\n\r\n  // 选择文件\r\n  const chooseFile = async () => {\r\n    const { disabled, action, customUploadHandler } = props\r\n    if (disabled) return\r\n\r\n    // 如果没有设置action或者没有自定义图片上传处理函数，则直接返回\r\n    if (!action && !customUploadHandler) {\r\n      showErrorTips('请设置action或者自定义图片上传处理函数')\r\n      debugWarn('TnImageUpload', '请设置action或者自定义图片上传处理函数')\r\n      return\r\n    }\r\n    // 选择前已有文件的数量\r\n    const prevUploadedFileCount = fileList.value.length\r\n    chooseImage(currentRemainFileCount.value)\r\n      .then((res) => {\r\n        let selectFile = res\r\n        // 判断尺寸和格式是否正确\r\n        const checkFailFiles = checkFileSizeAndExtension(selectFile)\r\n        if (checkFailFiles.length) {\r\n          showErrorTips('文件格式或大小不符合要求')\r\n          emit('oversizeOrNoSupport', checkFailFiles)\r\n          // 剔除不符合要求的文件\r\n          selectFile = selectFile.filter(\r\n            (item) => !checkFailFiles.includes(item)\r\n          )\r\n        }\r\n        fileList.value.push(\r\n          ...selectFile.map<ImageUploadListItem>((item) => {\r\n            const url = (item as UniApp.ChooseImageSuccessCallbackResultFile)\r\n              .path\r\n            return {\r\n              url,\r\n              status: 'ready',\r\n              progress: 0,\r\n              file: item,\r\n            }\r\n          })\r\n        )\r\n        if (props.autoUpload && selectFile.length)\r\n          uploadFile(prevUploadedFileCount)\r\n      })\r\n      .catch((err) => {\r\n        debugWarn('TnImageUpload', `选择图片失败: ${err}`)\r\n        showErrorTips(err?.errMsg || '选择图片失败')\r\n      })\r\n  }\r\n\r\n  // 处理上传事件\r\n  const handleUploadEvent = (\r\n    item: ImageUploadListItem,\r\n    index: number,\r\n    uploadSingle = false\r\n  ) => {\r\n    uploadProcess(item)\r\n      .then((res) => {\r\n        if (res) {\r\n          handleUploadSuccess(item)\r\n        } else {\r\n          handleUploadError(item, '上传失败')\r\n        }\r\n      })\r\n      .catch((err) => {\r\n        handleUploadError(item, err)\r\n      })\r\n      .finally(() => {\r\n        if (!uploadSingle) uploadFile(index + 1)\r\n      })\r\n  }\r\n\r\n  // 上传文件\r\n  const uploadFile = (startIndex: number, uploadSingle = false) => {\r\n    const { autoUpload, beforeUpload } = props\r\n    const autoNextUpload = autoUpload && !uploadSingle\r\n    // 判断是否全部文件上传完毕\r\n    if (startIndex >= fileList.value.length) {\r\n      if (props.autoRemoveFaildFile) handleUploadCompleteFailFile()\r\n      return\r\n    }\r\n\r\n    const fileItem = fileList.value[startIndex]\r\n\r\n    // 如果当前上传完毕自动上传下一张\r\n    if (fileItem.progress === 100) {\r\n      fileItem.status = 'done'\r\n      fileItem.uploadTask = undefined\r\n      if (autoNextUpload) uploadFile(startIndex + 1)\r\n      return\r\n    }\r\n\r\n    // 上传前回调\r\n    if (!beforeUpload) {\r\n      handleUploadEvent(fileItem, startIndex, uploadSingle)\r\n      return\r\n    }\r\n\r\n    const shouldUpload = beforeUpload(fileItem.file!)\r\n    const isBeforeUploadPromiseOrBoolean = [\r\n      isPromise(shouldUpload),\r\n      isBoolean(shouldUpload),\r\n    ].includes(true)\r\n    if (!isBeforeUploadPromiseOrBoolean) {\r\n      throwError(\r\n        '[TnImageUpload]',\r\n        'beforeUpload返回值必须是Promise或者Boolean'\r\n      )\r\n    }\r\n\r\n    if (isPromise(shouldUpload)) {\r\n      shouldUpload\r\n        .then((res) => {\r\n          if (res) handleUploadEvent(fileItem, startIndex, uploadSingle)\r\n          else {\r\n            removeFile(startIndex)\r\n            if (autoNextUpload) uploadFile(startIndex)\r\n          }\r\n        })\r\n        .catch((err) => {\r\n          debugWarn('TnImageUpload', `beforeUpload出错: ${err}`)\r\n          fileItem.status = 'failed'\r\n        })\r\n    } else {\r\n      if (shouldUpload) handleUploadEvent(fileItem, startIndex, uploadSingle)\r\n      else {\r\n        removeFile(startIndex)\r\n        if (autoNextUpload) uploadFile(startIndex)\r\n      }\r\n    }\r\n  }\r\n\r\n  // 获取上传成功的文件url\r\n  const getUploadSuceesFileUrlValue = () => {\r\n    return fileList.value\r\n      .filter((item) => item.status === 'done')\r\n      .map((item) => item.url)\r\n  }\r\n\r\n  // 已上传文件列表发生改变\r\n  const uploadSuccessFileListChange = () => {\r\n    isInnerUpdate = true\r\n    const value = getUploadSuceesFileUrlValue()\r\n    emit(UPDATE_MODEL_EVENT, value)\r\n    nextTick(() => {\r\n      emit(CHANGE_EVENT, value)\r\n      if (props.validateEvent) {\r\n        formItem?.validate?.('change').catch((err) => {\r\n          debugWarn(err)\r\n        })\r\n      }\r\n    })\r\n  }\r\n\r\n  // 处理文件上传成功\r\n  const handleUploadSuccess = (item: ImageUploadListItem) => {\r\n    item.status = 'done'\r\n    item.progress = 100\r\n    item.uploadTask = undefined\r\n    item.file = undefined\r\n    emit('success', item)\r\n    uploadSuccessFileListChange()\r\n  }\r\n\r\n  // 处理上传文件发生错误\r\n  const handleUploadError = (item: ImageUploadListItem, errorMsg: string) => {\r\n    item.status = 'failed'\r\n    item.progress = 0\r\n    item.uploadTask = undefined\r\n    item.file = undefined\r\n    showErrorTips(errorMsg)\r\n    emit('fail', new Error(errorMsg), item)\r\n  }\r\n\r\n  // 处理上传完成后失败的文件\r\n  const handleUploadCompleteFailFile = () => {\r\n    const tempFileList = [...fileList.value]\r\n    tempFileList.forEach((item, index) => {\r\n      if (item.status === 'failed') {\r\n        removeFile(index)\r\n      }\r\n    })\r\n  }\r\n\r\n  // 重新上传文件\r\n  const retryUploadFile = (index: number) => {\r\n    const fileItem = fileList.value[index]\r\n    fileItem.status = 'ready'\r\n    fileItem.progress = 0\r\n    uploadFile(index, true)\r\n  }\r\n\r\n  // 重新上传全部文件\r\n  const retryAllUpload = () => {\r\n    // 查找出第一张上传失败的图片\r\n    const firstFailedFileIndex = fileList.value.findIndex(\r\n      (item) => item.status === 'failed'\r\n    )\r\n    uploadFile(firstFailedFileIndex)\r\n  }\r\n\r\n  // 手动上传文件\r\n  const customUploadHandle = () => {\r\n    if (!fileList.value.length) return\r\n    uploadFile(0)\r\n  }\r\n\r\n  // 移除文件\r\n  const removeFile = (index: number) => {\r\n    const fileItem = fileList.value[index]\r\n\r\n    // 如果文件正在上传中，取消上传\r\n    if (\r\n      fileItem.status === 'uploading' &&\r\n      fileItem.uploadTask &&\r\n      fileItem.progress > 0 &&\r\n      fileItem.progress < 100\r\n    ) {\r\n      fileItem.uploadTask.abort()\r\n    }\r\n\r\n    fileList.value.splice(index, 1)\r\n\r\n    // 如果文件是已经完成的，重新计算上传成功的文件url\r\n    if (fileItem.status === 'done') {\r\n      emit('remove', fileItem.url)\r\n      uploadSuccessFileListChange()\r\n    }\r\n  }\r\n\r\n  // 删除文件\r\n  const removeFileEvent = (index: number) => {\r\n    const { disabled, beforeRemove } = props\r\n    if (disabled) return\r\n    // 获取待删除的文件\r\n    const fileItem = fileList.value[index]\r\n    if (!fileItem) return\r\n\r\n    uni.showModal({\r\n      title: '操作提示',\r\n      content: '确认需要移除该图片吗?',\r\n      showCancel: true,\r\n      cancelText: '取 消',\r\n      confirmText: '确 认',\r\n      success: (res) => {\r\n        if (res.confirm) {\r\n          // 删除前回调\r\n          if (!beforeRemove) {\r\n            removeFile(index)\r\n            return\r\n          }\r\n\r\n          const shouldRemove = beforeRemove(fileItem)\r\n          const isShouldRemovePromiseOrBoolean = [\r\n            isPromise(shouldRemove),\r\n            isBoolean(shouldRemove),\r\n          ].includes(true)\r\n          if (!isShouldRemovePromiseOrBoolean) {\r\n            throwError(\r\n              '[TnImageUpload]',\r\n              'beforeRemove返回值必须是Promise或者Boolean'\r\n            )\r\n          }\r\n\r\n          if (isPromise(shouldRemove)) {\r\n            shouldRemove\r\n              .then((res) => {\r\n                if (res) removeFile(index)\r\n              })\r\n              .catch((err) => {\r\n                debugWarn('TnImageUpload', `beforeRemove出错: ${err}`)\r\n              })\r\n          } else {\r\n            if (shouldRemove) removeFile(index)\r\n          }\r\n        }\r\n      },\r\n    })\r\n  }\r\n\r\n  // 清空文件列表\r\n  const clearAllFile = () => {\r\n    // 如果文件正在上传中，取消上传\r\n    fileList.value.forEach((item) => {\r\n      if (\r\n        item.status === 'uploading' &&\r\n        item.uploadTask &&\r\n        item.progress > 0 &&\r\n        item.progress < 100\r\n      ) {\r\n        item.uploadTask.abort()\r\n      }\r\n    })\r\n    fileList.value = []\r\n    uploadSuccessFileListChange()\r\n  }\r\n\r\n  // 点击图片预览图片\r\n  const previewImage = (index: number) => {\r\n    const previewImageList = fileList.value\r\n      .filter((item) => item.status === 'done')\r\n      .map((item) => item.url)\r\n\r\n    uni.previewImage({\r\n      current: index,\r\n      urls: previewImageList,\r\n    })\r\n\r\n    emit('preview', previewImageList[index])\r\n  }\r\n\r\n  return {\r\n    fileList,\r\n    isExceedMaxCount,\r\n    chooseFile,\r\n    retryUploadFile,\r\n    retryAllUpload,\r\n    customUploadHandle,\r\n    removeFileEvent,\r\n    clearAllFile,\r\n    previewImage,\r\n  }\r\n}\r\n"],"names":["getCurrentInstance","useUploadHandleFunction","useFormItem","ref","watch","computed","__awaiter","debugWarn","isPromise","isBoolean","throwError","UPDATE_MODEL_EVENT","nextTick","CHANGE_EVENT","_a","uni","res"],"mappings":"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"}