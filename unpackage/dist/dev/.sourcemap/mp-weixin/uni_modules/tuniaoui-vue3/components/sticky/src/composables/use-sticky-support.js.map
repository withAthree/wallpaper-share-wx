{"version":3,"file":"use-sticky-support.js","sources":["uni_modules/tuniaoui-vue3/components/sticky/src/composables/use-sticky-support.ts"],"sourcesContent":["import { getCurrentInstance, ref } from 'vue'\r\nimport { debugWarn } from '../../../..//utils'\r\n\r\nexport const useStickySupport = () => {\r\n  const supportCSSSticky = ref<boolean | null>(null)\r\n\r\n  const instance = getCurrentInstance()\r\n  if (!instance) {\r\n    debugWarn('TnSticky', '请在 setup 中使用 useStickySupport')\r\n  }\r\n\r\n  // H5通过创建元素的方法嗅探是否支持 CSS Sticky\r\n  const checkCSSStickySupportForH5 = () => {\r\n    // #ifdef H5\r\n    const vendorList = ['', '-webkit-', '-ms-', '-moz-', '-o-'],\r\n      vendorListLength = vendorList.length,\r\n      stickyElement = document.createElement('div')\r\n\r\n    for (let i = 0; i < vendorListLength; i++) {\r\n      stickyElement.style.position = `${vendorList[i]}sticky`\r\n      if (stickyElement.style.position !== '') {\r\n        supportCSSSticky.value = true\r\n        return\r\n      }\r\n    }\r\n\r\n    supportCSSSticky.value = false\r\n    // #endif\r\n  }\r\n\r\n  // 在APP和微信小程序上，通过uni.createSelectorQuery嗅探是否支持 CSS Sticky\r\n  const checkCSSStickySupportForAPPAndMPWX = (selector: string) => {\r\n    // #ifdef APP-VUE || MP-WEIXIN\r\n    uni\r\n      .createSelectorQuery()\r\n      .in(instance)\r\n      .select(selector)\r\n      .fields(\r\n        {\r\n          computedStyle: ['position'],\r\n        },\r\n        // eslint-disable-next-line @typescript-eslint/no-empty-function\r\n        () => {}\r\n      )\r\n      .exec((res) => {\r\n        if ('sticky' === res[0].position) {\r\n          supportCSSSticky.value = true\r\n        } else {\r\n          supportCSSSticky.value = false\r\n        }\r\n      })\r\n    // #endif\r\n  }\r\n\r\n  // 根据机型检测是否支持 CSS Sticky\r\n  const checkCSSStickySupportForDevice = () => {\r\n    // 获取手机对应的系统\\操作系统名称和版本\r\n    const { platform, system } = uni.getSystemInfoSync()\r\n    const os = platform.toLowerCase()\r\n    const osVersion = system\r\n    if (\r\n      (os === 'android' && Number(osVersion.replace('Android', '')) > 8) ||\r\n      os === 'ios'\r\n    ) {\r\n      supportCSSSticky.value = true\r\n    } else {\r\n      supportCSSSticky.value = false\r\n    }\r\n  }\r\n\r\n  // 检测当前环境是否支持 CSS Sticky\r\n  const checkCSSStickySupport = async (selector: string) => {\r\n    // 检测H5是否支持 CSS Sticky，主流浏览器都支持\r\n    // #ifdef H5\r\n    checkCSSStickySupportForH5()\r\n    // #endif\r\n\r\n    // 通过机型去判断是否支持 CSS Sticky\r\n    if (!supportCSSSticky.value) {\r\n      checkCSSStickySupportForDevice()\r\n    }\r\n\r\n    // 通过节点去判断是否支持 CSS Sticky\r\n    if (!supportCSSSticky.value) {\r\n      // #ifdef APP-VUE || MP-WEIXIN\r\n      checkCSSStickySupportForAPPAndMPWX(selector)\r\n      // #endif\r\n    }\r\n\r\n    // #ifdef APP-NVUE\r\n    // nvue默认时支持的\r\n    supportCSSSticky.value = true\r\n    // #endif\r\n  }\r\n\r\n  return {\r\n    supportCSSSticky,\r\n    checkCSSStickySupport,\r\n  }\r\n}\r\n"],"names":["ref","getCurrentInstance","debugWarn","uni","__awaiter"],"mappings":";;;;AAGa,MAAA,mBAAmB,MAAA;AAC9B,QAAM,mBAAmBA,kBAAoB,IAAI;AAEjD,QAAM,WAAWC,cAAAA;AACjB,MAAI,CAAC,UAAU;AACbC,mDAAU,YAAY,+BAA+B;AAAA,EACtD;AAsBD,QAAM,qCAAqC,CAAC,aAAgB;AAE1DC,kBAAG,MACA,oBAAqB,EACrB,GAAG,QAAQ,EACX,OAAO,QAAQ,EACf;AAAA,MACC;AAAA,QACE,eAAe,CAAC,UAAU;AAAA,MAC3B;AAAA;AAAA,MAED,MAAA;AAAA;IAAQ,EAET,KAAK,CAAC,QAAG;AACR,UAAI,aAAa,IAAI,CAAC,EAAE,UAAU;AAChC,yBAAiB,QAAQ;AAAA,MAC1B,OAAM;AACL,yBAAiB,QAAQ;AAAA,MAC1B;AAAA,IACH,CAAC;AAAA,EAEL;AAGA,QAAM,iCAAiC,MAAA;AAE/B,UAAA,KAAuBA,oBAAI,qBAAzB,WAAQ,GAAA,UAAE,SAAM,GAAA;AACxB,UAAM,KAAK,SAAS;AACpB,UAAM,YAAY;AAClB,QACG,OAAO,aAAa,OAAO,UAAU,QAAQ,WAAW,EAAE,CAAC,IAAI,KAChE,OAAO,OACP;AACA,uBAAiB,QAAQ;AAAA,IAC1B,OAAM;AACL,uBAAiB,QAAQ;AAAA,IAC1B;AAAA,EACH;AAGA,QAAM,wBAAwB,CAAO,aAAgB;AAAA,WAAAC,cAAAA,UAAA,QAAA,QAAA,QAAA,aAAA;AAOnD,UAAI,CAAC,iBAAiB,OAAO;AAC3B;MACD;AAGD,UAAI,CAAC,iBAAiB,OAAO;AAE3B,2CAAmC,QAAQ;AAAA,MAE5C;AAAA,IAMF,CAAA;AAAA;AAED,SAAO;AAAA,IACL;AAAA,IACA;AAAA;AAEJ;;"}