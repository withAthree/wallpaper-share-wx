{"version":3,"file":"index.js","sources":["uni_modules/tuniaoui-vue3/hooks/use-observer/index.ts"],"sourcesContent":["import { getCurrentInstance } from 'vue'\nimport { debugWarn } from '../../utils'\n\nimport type { ComponentInternalInstance } from 'vue'\n\nexport interface ObserverFnOptions {\n  type: 'relativeTo' | 'relativeToViewport'\n  selector?: string\n  margins: {\n    top?: number\n    right?: number\n    bottom?: number\n    left?: number\n  }\n}\n\nexport const useObserver = (instance?: ComponentInternalInstance | null) => {\n  if (!instance) {\n    instance = getCurrentInstance()\n  }\n\n  // #ifdef H5 | APP-PLUS\n  instance = instance?.proxy?.$parent as ComponentInternalInstance | null\n  // #endif\n\n  if (!instance) {\n    debugWarn('useObserver', '请在 setup 中使用 useObserver')\n  }\n\n  // Observer对象\n  let observerInstance: UniApp.IntersectionObserver | null = null\n\n  const connectObserver = (\n    selector: string,\n    fn: (res: UniApp.ObserveResult) => void,\n    fnOptions: ObserverFnOptions,\n    options?: UniApp.CreateIntersectionObserverOptions\n  ) => {\n    // 开始监听布局之前先停止旧的监听\n    disconnectObserver()\n\n    observerInstance = uni.createIntersectionObserver(instance, options)\n    if (fnOptions.type === 'relativeTo')\n      observerInstance.relativeTo(fnOptions?.selector || '', fnOptions.margins)\n    else if (fnOptions.type === 'relativeToViewport')\n      observerInstance.relativeToViewport(fnOptions.margins)\n\n    observerInstance.observe(selector, (res) => {\n      fn && fn(res)\n    })\n  }\n\n  // 停止监听布局状态\n  const disconnectObserver = () => {\n    if (observerInstance) {\n      observerInstance.disconnect()\n      observerInstance = null\n    }\n  }\n\n  return {\n    connectObserver,\n    disconnectObserver,\n  }\n}\n"],"names":["getCurrentInstance","debugWarn","uni"],"mappings":";;;;AAgBO,MAAM,cAAc,CAAC,aAA2C;AACrE,MAAI,CAAC,UAAU;AACb,eAAWA,cAAkB,mBAAA;AAAA,EAC9B;AAMD,MAAI,CAAC,UAAU;AACbC,mDAAU,eAAe,0BAA0B;AAAA,EACpD;AAGD,MAAI,mBAAuD;AAE3D,QAAM,kBAAkB,CACtB,UACA,IACA,WACA,YAAkD;AAGlD;AAEA,uBAAmBC,cAAAA,MAAI,2BAA2B,UAAU,OAAO;AACnE,QAAI,UAAU,SAAS;AACrB,uBAAiB,YAAW,cAAS,QAAT,cAAA,SAAA,SAAA,UAAW,aAAY,IAAI,UAAU,OAAO;AAAA,aACjE,UAAU,SAAS;AAC1B,uBAAiB,mBAAmB,UAAU,OAAO;AAEvD,qBAAiB,QAAQ,UAAU,CAAC,QAAG;AACrC,YAAM,GAAG,GAAG;AAAA,IACd,CAAC;AAAA,EACH;AAGA,QAAM,qBAAqB,MAAA;AACzB,QAAI,kBAAkB;AACpB,uBAAiB,WAAU;AAC3B,yBAAmB;AAAA,IACpB;AAAA,EACH;AAEA,SAAO;AAAA,IACL;AAAA,IACA;AAAA;AAEJ;;"}