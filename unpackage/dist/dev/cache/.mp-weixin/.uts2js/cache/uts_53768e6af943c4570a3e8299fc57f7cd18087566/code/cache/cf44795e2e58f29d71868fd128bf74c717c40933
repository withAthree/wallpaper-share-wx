{"code":"import { computed, getCurrentInstance, nextTick, watch } from 'vue';\nimport { useNamespace } from '../../../../hooks';\nimport { generateId, isEmptyVariableInDefault } from '../../../../utils';\nexport const useCircleProgress = (props) => {\n    const instance = getCurrentInstance();\n    const ns = useNamespace('circle-progress');\n    // 圆环的直径\n    const radius = computed(() => {\n        return isEmptyVariableInDefault(props === null || props === void 0 ? void 0 : props.radius, 50);\n    });\n    // 圆环的宽度\n    const ringWidth = computed(() => {\n        return isEmptyVariableInDefault(props === null || props === void 0 ? void 0 : props.ringWidth, 14);\n    });\n    // 圆环的颜色\n    const circleColor = computed(() => {\n        return isEmptyVariableInDefault(props === null || props === void 0 ? void 0 : props.inactiveColor, '#e6e6e6');\n    });\n    // 圆环激活时的颜色\n    const activeCircleColor = computed(() => {\n        return isEmptyVariableInDefault(props === null || props === void 0 ? void 0 : props.activeColor, '#01beff');\n    });\n    // 动画执行时间\n    const duration = computed(() => {\n        return isEmptyVariableInDefault(props === null || props === void 0 ? void 0 : props.duration, 1500);\n    });\n    // 进度信息，为了产生动画效果，需要在进度条变化时，将进度信息保存下来\n    let currentPercent = 0;\n    let prevPercent = 0;\n    // 生成canvas圆环id\n    const canvasId = String(generateId());\n    // canvas容器对象\n    let progressCanvas = null;\n    // 圆环开始角度\n    const startAngle = -90 * (Math.PI / 180);\n    // 绘制progress圆环\n    const drawProgressCircle = (percent) => {\n        if (!progressCanvas) {\n            progressCanvas = uni.createCanvasContext(canvasId, instance);\n        }\n        // 清空画布\n        progressCanvas.clearRect(0, 0, radius.value * 2, radius.value * 2);\n        // 绘制底部圆环\n        progressCanvas.beginPath();\n        // 设置颜色\\线框\n        progressCanvas.setLineWidth(ringWidth.value);\n        progressCanvas.setStrokeStyle(circleColor.value);\n        // 绘制圆环\n        progressCanvas.arc(radius.value, radius.value, radius.value - ringWidth.value / 2, startAngle, Math.PI * 1.5, false);\n        progressCanvas.stroke();\n        // 如果进度为0，不绘制进度圆环\n        if (percent === 0) {\n            progressCanvas.draw();\n            return;\n        }\n        // 绘制进度圆环\n        progressCanvas.beginPath();\n        // 设置颜色\\线框\n        progressCanvas.setLineCap('round');\n        progressCanvas.setLineWidth(ringWidth.value);\n        progressCanvas.setStrokeStyle(activeCircleColor.value);\n        // 结束角度\n        const endAngle = (Math.PI * 2 * percent) / 100 - Math.PI / 2;\n        progressCanvas.arc(radius.value, radius.value, radius.value - ringWidth.value / 2, startAngle, endAngle, false);\n        progressCanvas.stroke();\n        progressCanvas.draw();\n    };\n    // 计算缓动动画时间函数\n    function easeOutCubic(t, b, c, d) {\n        return c * ((t = t / d - 1) * t * t + 1) + b;\n    }\n    // 开始执行动画\n    let startTime = null;\n    const progressAnimation = () => {\n        if (!startTime)\n            startTime = Date.now();\n        const elapsed = Date.now() - startTime;\n        let percent = easeOutCubic(elapsed, prevPercent, currentPercent - prevPercent, duration.value);\n        if (percent < 0)\n            percent = 0;\n        drawProgressCircle(percent);\n        if (elapsed < duration.value) {\n            setTimeout(progressAnimation, 16);\n        }\n    };\n    watch(() => { return props.percent; }, (nVal, oVal) => {\n        currentPercent = nVal > 100 ? 100 : nVal;\n        prevPercent = !oVal || oVal < 0 ? 0 : oVal;\n        nextTick(() => {\n            startTime = null;\n            progressAnimation();\n        });\n    }, {\n        immediate: true,\n    });\n    return {\n        ns,\n        canvasId,\n        radius,\n        activeCircleColor,\n    };\n};\n//# sourceMappingURL=D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/circle-progress/src/composables/use-circle-progress.js.map","references":["D:/DEV/HBuilderX/plugins/uniapp-cli-vite/node_modules/@vue/runtime-core/dist/runtime-core.d.ts","D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/hooks/index.ts","D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/utils/index.ts","D:/DEV/HBuilderX/plugins/uniapp-cli-vite/node_modules/@vue/runtime-core/dist/runtime-core.d.ts","D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/circle-progress/src/circle-progress.ts"],"uniExtApis":[],"map":"{\"version\":3,\"file\":\"use-circle-progress.js\",\"sourceRoot\":\"\",\"sources\":[\"use-circle-progress.ts\"],\"names\":[],\"mappings\":\"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\"}"}
