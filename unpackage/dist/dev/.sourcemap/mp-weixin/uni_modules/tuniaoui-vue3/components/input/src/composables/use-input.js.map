{"version":3,"file":"use-input.js","sources":["uni_modules/tuniaoui-vue3/components/input/src/composables/use-input.ts"],"sourcesContent":["import { computed, nextTick, ref, watch } from 'vue'\nimport { trim } from '../../../../libs/lodash'\nimport {\n  CHANGE_EVENT,\n  INPUT_EVENT,\n  UPDATE_MODEL_EVENT,\n} from '../../../../constants'\nimport {\n  FormValidateIconsMap,\n  debugWarn,\n  isEmptyVariableInDefault,\n} from '../../../../utils'\nimport { useToggle } from '../../../../hooks'\nimport { useFormDisabled, useFormItem } from '../../../form'\n\nimport type { SetupContext } from 'vue'\nimport type { FormItemValidateStates } from '../../../form'\nimport type { InputEmit, InputProps } from '../input'\n\nexport const useInput = (\n  props: InputProps,\n  emits: SetupContext<InputEmit>['emit']\n) => {\n  const { form, formItem } = useFormItem()\n\n  // 输入框内容\n  const inputText = ref<string>(\n    String(isEmptyVariableInDefault(props.modelValue, ''))\n  )\n  watch(\n    () => props.modelValue,\n    (val) => {\n      inputText.value = String(isEmptyVariableInDefault(val, ''))\n      if (props.validateEvent) {\n        formItem?.validate?.('change').catch((err) => {\n          debugWarn(err)\n        })\n      }\n    }\n  )\n\n  // 显示/隐藏密码状态\n  const [passwordVisible, togglePasswordVisible] = useToggle(false)\n\n  // 是否显示状态图标\n  const needStatusIcon = computed(() =>\n    isEmptyVariableInDefault(form?.statusIcon, false)\n  )\n  // 校验状态\n  const validateState = computed(() =>\n    isEmptyVariableInDefault<FormItemValidateStates>(\n      formItem?.validateState,\n      ''\n    )\n  )\n  // 校验状态图标\n  const validateIcon = computed(\n    () => validateState.value && FormValidateIconsMap[validateState.value]\n  )\n\n  // 密码显示密码图标\n  const passwordIcon = computed(() =>\n    passwordVisible.value ? 'eye-hide' : 'eye'\n  )\n\n  // 是否显示图标\n  const showIcon = computed(() => {\n    let status = false\n    if (validateState.value && needStatusIcon.value && validateIcon.value)\n      status = true\n    if (props.showPassword) status = true\n    if (props.rightIcon) status = true\n    if (props.clearable) status = true\n    return status\n  })\n\n  // 输入框禁止事件\n  const disabled = useFormDisabled(props.disabled)\n\n  // 是否显示字数统计\n  const showWordLimit = computed<boolean>(\n    () =>\n      props.type === 'textarea' && !!props?.maxlength && !!props?.showWordLimit\n  )\n  // 当前的字数\n  const currentWordCount = computed<number>(() => {\n    if (props.showWordLimit && props.type === 'textarea') {\n      return inputText.value?.length || 0\n    }\n    return 0\n  })\n\n  // 内容输入触发事件\n  const inputInputEvent = (event: any) => {\n    const { value } = event.detail\n    _updateInputText(value)\n  }\n\n  // 输入框聚焦事件\n  const inputFocusEvent = (event: any) => {\n    emits('focus', event)\n  }\n\n  // 输入框失去焦点事件\n  const inputBlurEvent = (event: any) => {\n    emits('blur', event)\n    if (props.validateEvent) {\n      // eslint-disable-next-line @typescript-eslint/no-empty-function\n      formItem?.validate?.('blur').catch((err) => {\n        debugWarn(err)\n      })\n    }\n  }\n\n  // 点击完成时触发事件\n  const confirmEvent = (event: any) => {\n    const { value } = event.detail\n    emits('confirm', _formatInputText(value))\n  }\n\n  // 点击清除按钮\n  const clearClickEvent = () => {\n    if (disabled.value) return\n    _updateInputText('')\n    emits('clear')\n  }\n\n  // 更新输入框内容\n  const _updateInputText = (value: string) => {\n    value = props.trim ? trim(value) : value\n    // inputText.value = value\n    emits(UPDATE_MODEL_EVENT, _formatInputText(value))\n    nextTick(() => {\n      emits(INPUT_EVENT, _formatInputText(value))\n      emits(CHANGE_EVENT, _formatInputText(value))\n    })\n  }\n\n  // 输入框点击事件\n  const inputClickEvent = () => {\n    if (props.type === 'select') {\n      emits('click')\n    }\n  }\n\n  const _formatInputText = (value: string) => {\n    if (value === '') return ''\n    if (props.type === 'number' || props.type === 'digit')\n      return Number.parseFloat(value)\n    return value\n  }\n\n  return {\n    inputText,\n    needStatusIcon,\n    validateState,\n    validateIcon,\n    passwordVisible,\n    passwordIcon,\n    showIcon,\n    disabled,\n    showWordLimit,\n    currentWordCount,\n    togglePasswordVisible,\n    inputInputEvent,\n    inputFocusEvent,\n    inputBlurEvent,\n    clearClickEvent,\n    confirmEvent,\n    inputClickEvent,\n  }\n}\n"],"names":["useFormItem","ref","isEmptyVariableInDefault","watch","_a","debugWarn","__read","useToggle","computed","FormValidateIconsMap","useFormDisabled","trim","UPDATE_MODEL_EVENT","nextTick","INPUT_EVENT","CHANGE_EVENT"],"mappings":"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"}