{"version":3,"file":"use-collapse-item.js","sources":["uni_modules/tuniaoui-vue3/components/collapse/src/composables/use-collapse-item.ts"],"sourcesContent":["import {\n  computed,\n  getCurrentInstance,\n  inject,\n  nextTick,\n  onMounted,\n  ref,\n} from 'vue'\nimport { collapseContextKey } from '../../../../tokens'\nimport { useSelectorQuery } from '../../../../hooks'\nimport {\n  debugWarn,\n  generateId,\n  isEmptyVariableInDefault,\n} from '../../../../utils'\n\nimport type { CollapseItemProps } from '../collapse-item'\n\nexport const useCollapseItem = (props: CollapseItemProps) => {\n  const instance = getCurrentInstance()\n  if (!instance) {\n    debugWarn('TnCollapseItem', '请在 setup 函数中使用 TnCollapseItem')\n  }\n  const { uid } = instance!\n\n  const collapse = inject(collapseContextKey)\n  if (!collapse) {\n    debugWarn('TnCollapseItem', '请在 TnCollapse 中使用 TnCollapseItem')\n  }\n\n  collapse?.addItem({ uid })\n\n  const componentContentId = `tcic-${generateId()}`\n  const { getSelectorNodeInfo } = useSelectorQuery(instance)\n\n  // 当前组件是否为激活状态\n  const isActive = computed<boolean>(() => {\n    if (!collapse) return false\n    return collapse.activeUid.includes(uid)\n  })\n\n  // 是否显示折叠面板箭头\n  const showArrow = computed<boolean>(() =>\n    isEmptyVariableInDefault(collapse?.showArrow, false)\n  )\n\n  // 组件内容的高度\n  const compoenntContentDefaultHeight = ref<number>(0)\n  const componentTitleHeight = ref<number>(uni.upx2px(100))\n  const componentHeight = computed<string>(() => {\n    if (!isActive.value) return `${componentTitleHeight.value}px`\n    else\n      return `${\n        componentTitleHeight.value + compoenntContentDefaultHeight.value\n      }px`\n  })\n\n  let initCount = 0\n  // 获取内容容器高度\n  const getComponentContentHeight = async () => {\n    try {\n      const rectInfo = await getSelectorNodeInfo(`#${componentContentId}`)\n\n      initCount = 0\n      compoenntContentDefaultHeight.value = rectInfo.height || 0\n    } catch (err) {\n      if (initCount > 10) {\n        initCount = 0\n        debugWarn('TnCollapseItem', `获取内容高度失败: ${err}`)\n        return\n      }\n      initCount++\n      setTimeout(() => {\n        getComponentContentHeight()\n      }, 150)\n    }\n  }\n\n  // CollapseItem 点击事件\n  const collapseItemClick = () => {\n    if (props.disabled) return\n    collapse?.handleItemClick(uid)\n  }\n\n  onMounted(() => {\n    nextTick(() => {\n      getComponentContentHeight()\n    })\n  })\n\n  return {\n    componentContentId,\n    showArrow,\n    isActive,\n    componentHeight,\n    collapseItemClick,\n  }\n}\n"],"names":["getCurrentInstance","debugWarn","inject","collapseContextKey","generateId","useSelectorQuery","computed","isEmptyVariableInDefault","ref","uni","__awaiter","onMounted","nextTick"],"mappings":";;;;;;;;;AAkBO,MAAM,kBAAkB,CAAC,UAAwB;AACtD,QAAM,WAAWA,cAAAA;AACjB,MAAI,CAAC,UAAU;AACbC,mDAAU,kBAAkB,+BAA+B;AAAA,EAC5D;AACO,QAAA,MAAQ,SAAS;AAEzB,QAAM,WAAWC,qBAAOC,yCAAAA,kBAAkB;AAC1C,MAAI,CAAC,UAAU;AACbF,mDAAU,kBAAkB,kCAAkC;AAAA,EAC/D;AAED,eAAQ,QAAR,aAAQ,SAAA,SAAR,SAAU,QAAQ,EAAE,IAAG,CAAE;AAEzB,QAAM,qBAAqB,QAAQG,oCAAU,WAAA,CAAE;AACvC,QAAA,sBAAwBC,sDAAAA,iBAAiB,QAAQ;AAGzD,QAAM,WAAWC,cAAAA,SAAkB,MAAA;AACjC,QAAI,CAAC;AAAU,aAAO;AACtB,WAAO,SAAS,UAAU,SAAS,GAAG;AAAA,EACxC,CAAC;AAGD,QAAM,YAAYA,cAAAA,SAAkB,MAAA;AAClC,WAAAC,gEAAyB,aAAA,QAAA,aAAA,SAAA,SAAA,SAAU,WAAW,KAAK;AAAA,EAAnD,CAAoD;AAItD,QAAM,gCAAgCC,kBAAY,CAAC;AACnD,QAAM,uBAAuBA,cAAAA,IAAYC,cAAAA,MAAI,OAAO,GAAG,CAAC;AACxD,QAAM,kBAAkBH,cAAAA,SAAiB,MAAA;AACvC,QAAI,CAAC,SAAS;AAAO,aAAO,GAAG,qBAAqB,KAAK;AAAA;AAEvD,aAAO,GACL,qBAAqB,QAAQ,8BAA8B,KAC7D;AAAA,EACJ,CAAC;AAED,MAAI,YAAY;AAEhB,QAAM,4BAA4B,MAAA;AAAA,WAAAI,cAAA,UAAA,QAAA,QAAA,QAAA,aAAA;AAChC,UAAI;AACF,cAAM,WAAW,MAAM,oBAAoB,IAAI,kBAAkB,EAAE;AAEnE,oBAAY;AACZ,sCAA8B,QAAQ,SAAS,UAAU;AAAA,MAC1D,SAAQ,KAAK;AACZ,YAAI,YAAY,IAAI;AAClB,sBAAY;AACZT,+CAAAA,UAAU,kBAAkB,aAAa,GAAG,EAAE;AAC9C;AAAA,QACD;AACD;AACA,mBAAW,MAAA;AACT;QACD,GAAE,GAAG;AAAA,MACP;AAAA,IACF,CAAA;AAAA;AAGD,QAAM,oBAAoB,MAAA;AACxB,QAAI,MAAM;AAAU;AACpB,iBAAQ,QAAR,aAAA,SAAA,SAAA,SAAU,gBAAgB,GAAG;AAAA,EAC/B;AAEAU,gBAAAA,UAAU,MAAA;AACRC,kBAAAA,WAAS,MAAA;AACP;IACF,CAAC;AAAA,EACH,CAAC;AAED,SAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA;AAEJ;;"}