{"code":"import { __awaiter } from \"tslib\";\nimport { computed, getCurrentInstance, nextTick, onMounted, onUnmounted, ref, watch, } from 'vue';\nimport { useObserver, useSelectorQuery } from '../../../../hooks';\nimport { debugWarn, generateId, isEmptyVariableInDefault, } from '../../../../utils';\nimport { useStickySupport } from './use-sticky-support';\nexport const useSticky = (props) => {\n    const instance = getCurrentInstance();\n    if (!instance) {\n        debugWarn('TnSticky', 'useSticky 必须在 setup 中使用');\n    }\n    const emit = instance.emit;\n    // 组件id\n    const componentId = `ts-${generateId()}`;\n    const _a = useStickySupport(), supportCSSSticky = _a.supportCSSSticky, checkCSSStickySupport = _a.checkCSSStickySupport;\n    const _b = useObserver(instance), connectObserver = _b.connectObserver, disconnectObserver = _b.disconnectObserver;\n    const getSelectorNodeInfo = useSelectorQuery(instance).getSelectorNodeInfo;\n    // 吸顶的距离\n    const stickyDistance = computed(() => {\n        return isEmptyVariableInDefault(props === null || props === void 0 ? void 0 : props.offsetTop, 0);\n    });\n    // 是否吸顶\n    const stickyStatus = ref(false);\n    // 设置吸顶的状态\n    const setStickyStatus = (status) => {\n        if (status) {\n            emit('change', true);\n        }\n        else if (stickyStatus.value) {\n            emit('change', false);\n        }\n        stickyStatus.value = status;\n    };\n    // 初始化节点次数\n    let initCount = 0;\n    // sticky容器节点信息，防止在js模式下设置为fixed后元素塌陷无法进行交互\n    const stickyContainerRect = ref({\n        width: 'auto',\n        height: 'auto',\n        left: 0,\n    });\n    // 监听节点信息\n    const monitorNodeInfo = () => {\n        connectObserver(`#${componentId}`, (observerRes) => {\n            if (!props.enabled)\n                return;\n            setStickyStatus(observerRes.boundingClientRect.top <= stickyDistance.value);\n        }, {\n            type: 'relativeToViewport',\n            margins: {\n                top: -stickyDistance.value,\n            },\n        }, {\n            thresholds: [0.95, 0.98, 1],\n        });\n    };\n    // 初始化Observer\n    const initObserver = () => { return __awaiter(void 0, void 0, void 0, function* () {\n        disconnectObserver();\n        try {\n            const rectInfo = yield getSelectorNodeInfo(`#${componentId}`);\n            initCount = 0;\n            // 设置容器信息\n            stickyContainerRect.value.width = rectInfo.width || 0;\n            stickyContainerRect.value.height = rectInfo.height || 0;\n            stickyContainerRect.value.left = rectInfo.left || 0;\n            nextTick(() => {\n                monitorNodeInfo();\n            });\n        }\n        catch (err) {\n            if (initCount > 10) {\n                initCount = 0;\n                debugWarn('TnSticky', `获取sticky节点信息失败: ${err}`);\n                return;\n            }\n            initCount++;\n            setTimeout(() => {\n                initObserver();\n            }, 150);\n        }\n    }); };\n    watch(() => { return supportCSSSticky.value; }, (val) => {\n        if (val === false && props.enabled) {\n            initObserver();\n        }\n    });\n    // 如果修改了吸顶高度则重新进行监听\n    watch(() => { return props.offsetTop; }, () => {\n        nextTick(() => {\n            initSticky();\n        });\n    });\n    // 监听是否动态设置吸顶状态\n    watch(() => { return props.enabled; }, (val) => {\n        if (!val) {\n            setStickyStatus(false);\n            disconnectObserver();\n        }\n        else {\n            disconnectObserver();\n            monitorNodeInfo();\n        }\n    });\n    // 初始化组件\n    const initSticky = () => {\n        checkCSSStickySupport(`#${componentId}`);\n    };\n    onMounted(() => {\n        nextTick(() => {\n            initSticky();\n        });\n    });\n    onUnmounted(() => {\n        disconnectObserver();\n    });\n    return {\n        componentId,\n        supportCSSSticky,\n        stickyStatus,\n        stickyContainerRect,\n        stickyDistance,\n    };\n};\n//# sourceMappingURL=D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/sticky/src/composables/use-sticky.js.map","references":["D:/DEV/HBuilderX/plugins/uniapp-cli-vite/node_modules/@vue/runtime-core/dist/runtime-core.d.ts","D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/hooks/index.ts","D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/utils/index.ts","D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/sticky/src/composables/use-sticky-support.ts","D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/sticky/src/sticky.ts","D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/sticky/src/types.ts"],"uniExtApis":[],"map":"{\"version\":3,\"file\":\"use-sticky.js\",\"sourceRoot\":\"\",\"sources\":[\"use-sticky.ts\"],\"names\":[],\"mappings\":\"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\"}"}
