{"version":3,"file":"index.js","sources":["uni_modules/tuniaoui-vue3/hooks/use-observer/index.ts"],"sourcesContent":["import { getCurrentInstance } from 'vue'\r\nimport { debugWarn } from '../../utils'\r\n\r\nimport type { ComponentInternalInstance } from 'vue'\r\n\r\nexport interface ObserverFnOptions {\r\n  type: 'relativeTo' | 'relativeToViewport'\r\n  selector?: string\r\n  margins: {\r\n    top?: number\r\n    right?: number\r\n    bottom?: number\r\n    left?: number\r\n  }\r\n}\r\n\r\nexport const useObserver = (instance?: ComponentInternalInstance | null) => {\r\n  if (!instance) {\r\n    instance = getCurrentInstance()\r\n  }\r\n\r\n  // #ifdef H5 | APP-PLUS\r\n  instance = instance?.proxy?.$parent as ComponentInternalInstance | null\r\n  // #endif\r\n\r\n  if (!instance) {\r\n    debugWarn('useObserver', '请在 setup 中使用 useObserver')\r\n  }\r\n\r\n  // Observer对象\r\n  let observerInstance: UniApp.IntersectionObserver | null = null\r\n\r\n  const connectObserver = (\r\n    selector: string,\r\n    fn: (res: UniApp.ObserveResult) => void,\r\n    fnOptions: ObserverFnOptions,\r\n    options?: UniApp.CreateIntersectionObserverOptions\r\n  ) => {\r\n    // 开始监听布局之前先停止旧的监听\r\n    disconnectObserver()\r\n\r\n    observerInstance = uni.createIntersectionObserver(instance, options)\r\n    if (fnOptions.type === 'relativeTo')\r\n      observerInstance.relativeTo(fnOptions?.selector || '', fnOptions.margins)\r\n    else if (fnOptions.type === 'relativeToViewport')\r\n      observerInstance.relativeToViewport(fnOptions.margins)\r\n\r\n    observerInstance.observe(selector, (res) => {\r\n      fn && fn(res)\r\n    })\r\n  }\r\n\r\n  // 停止监听布局状态\r\n  const disconnectObserver = () => {\r\n    if (observerInstance) {\r\n      observerInstance.disconnect()\r\n      observerInstance = null\r\n    }\r\n  }\r\n\r\n  return {\r\n    connectObserver,\r\n    disconnectObserver,\r\n  }\r\n}\r\n"],"names":["getCurrentInstance","debugWarn","uni"],"mappings":";;;;AAgBO,MAAM,cAAc,CAAC,aAA2C;AACrE,MAAI,CAAC,UAAU;AACb,eAAWA,cAAkB,mBAAA;AAAA,EAC9B;AAMD,MAAI,CAAC,UAAU;AACbC,mDAAU,eAAe,0BAA0B;AAAA,EACpD;AAGD,MAAI,mBAAuD;AAE3D,QAAM,kBAAkB,CACtB,UACA,IACA,WACA,YAAkD;AAGlD;AAEA,uBAAmBC,cAAAA,MAAI,2BAA2B,UAAU,OAAO;AACnE,QAAI,UAAU,SAAS;AACrB,uBAAiB,YAAW,cAAS,QAAT,cAAA,SAAA,SAAA,UAAW,aAAY,IAAI,UAAU,OAAO;AAAA,aACjE,UAAU,SAAS;AAC1B,uBAAiB,mBAAmB,UAAU,OAAO;AAEvD,qBAAiB,QAAQ,UAAU,CAAC,QAAG;AACrC,YAAM,GAAG,GAAG;AAAA,IACd,CAAC;AAAA,EACH;AAGA,QAAM,qBAAqB,MAAA;AACzB,QAAI,kBAAkB;AACpB,uBAAiB,WAAU;AAC3B,yBAAmB;AAAA,IACpB;AAAA,EACH;AAEA,SAAO;AAAA,IACL;AAAA,IACA;AAAA;AAEJ;;"}