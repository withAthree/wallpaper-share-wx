{"code":"import { computed, nextTick, ref, watch } from 'vue';\nimport dayjs from '../../../../libs/dayjs';\nimport { CHANGE_EVENT, UPDATE_MODEL_EVENT } from '../../../../constants';\nimport { isEmptyVariableInDefault } from '../../../../utils';\nimport { useWeekCalendarSelector } from './use-week-calendar-selector';\nexport const useWeekCalendar = (props, emits) => {\n    // 当前日期的Dayjs\n    const currentDateDayjs = dayjs();\n    const _a = useWeekCalendarSelector(), componentDateItemId = _a.componentDateItemId, dateItemContainerHeight = _a.dateItemContainerHeight;\n    // 当前日期的年份\n    const currentYear = computed(() => {\n        return props.year ? Number(props.year) : currentDateDayjs.year();\n    });\n    // 当前日期的月份\n    const currentMonth = computed(() => {\n        return props.month ? Number(props.month) : currentDateDayjs.month() + 1;\n    });\n    // 最小可选日期\n    const minDate = computed(() => {\n        return props.minDate\n            ? Number(props.minDate)\n            : currentDateDayjs.year() === currentYear.value &&\n                currentDateDayjs.month() + 1 === currentMonth.value\n                ? currentDateDayjs.date()\n                : 1;\n    });\n    // 最大可选日期\n    const maxDate = computed(() => {\n        return props.maxDate ? Number(props.maxDate) : currentDateDayjs.daysInMonth();\n    });\n    // 用户自定义日期描述数据\n    const customDescData = computed(() => {\n        const map = new Map();\n        props.customData.forEach((item) => {\n            map.set(item.date, item.desc);\n        });\n        return map;\n    });\n    // 星期提示文字\n    const weekText = ref(['日', '一', '二', '三', '四', '五', '六']);\n    // 周日历数据\n    const weekCalendarData = ref([]);\n    // 当前激活的日期\n    const activeDate = computed(() => {\n        return isEmptyVariableInDefault(props.modelValue, 0);\n    });\n    // 当前选中的轮播位置\n    const currentSwiperIndex = ref(0);\n    // 更新指定的日期为激活状态\n    const updateActiveDate = (date) => {\n        weekCalendarData.value.forEach((week) => {\n            week.forEach((item) => {\n                if (item.status !== 'disabled') {\n                    if (item.date === date) {\n                        item.status = 'active';\n                    }\n                    else {\n                        item.status = 'normal';\n                    }\n                }\n            });\n        });\n    };\n    // 更新modelValue的值\n    const updateModelValue = (value, changeEmits = true) => {\n        emits(UPDATE_MODEL_EVENT, value);\n        if (changeEmits) {\n            updateActiveDate(value);\n            nextTick(() => {\n                emits(CHANGE_EVENT, value);\n            });\n        }\n    };\n    // 生成周日历数据\n    const generateWeekCalendarData = () => {\n        const data = [];\n        const generateMonthDayjs = dayjs(`${currentYear.value}/${currentMonth.value}/01`);\n        const dates = generateMonthDayjs.daysInMonth();\n        const firstDayWeek = generateMonthDayjs.day();\n        // 填充空白数据\n        for (let i = 0; i < firstDayWeek; i++) {\n            data.push({\n                date: 0,\n                status: 'disabled',\n            });\n        }\n        // 填充日期数据\n        for (let i = 1; i <= dates; i++) {\n            let status = i >= minDate.value && i <= maxDate.value ? 'normal' : 'disabled';\n            if (i === activeDate.value) {\n                status = 'active';\n                // 设置当前激活日期所在的位置\n                currentSwiperIndex.value = Math.floor((i + firstDayWeek - 1) / 7);\n            }\n            const desc = customDescData.value.get(i);\n            data.push({\n                date: i,\n                status,\n                desc,\n            });\n        }\n        // 分割数据，每7个为一组\n        const result = [];\n        for (let i = 0; i < data.length; i += 7) {\n            result.push(data.slice(i, i + 7));\n        }\n        weekCalendarData.value = result;\n    };\n    // 初始化周日历数据\n    const initWeekCalendarData = () => {\n        let updateModelValueDate = false;\n        let modelValue = props.modelValue;\n        // 判断modelValue是否有值，并且在最小和最大日期范围内\n        // 如果没有值则以当前日期为准\n        if (!modelValue) {\n            modelValue = currentDateDayjs.date();\n            updateModelValueDate = true;\n        }\n        // 如果比最小日期小，则以最小日期为准\n        if (modelValue < minDate.value) {\n            modelValue = minDate.value;\n            updateModelValueDate = true;\n        }\n        // 如果比最大日期大，则以最大日期为准\n        if (modelValue > maxDate.value) {\n            modelValue = maxDate.value;\n            updateModelValueDate = true;\n        }\n        if (updateModelValueDate) {\n            updateModelValue(modelValue);\n        }\n        nextTick(() => {\n            generateWeekCalendarData();\n        });\n    };\n    initWeekCalendarData();\n    // 日期选中事件\n    const dateItemClick = (item) => {\n        if (item.status === 'active' ||\n            item.status === 'disabled' ||\n            item.date === 0)\n            return;\n        updateModelValue(item.date);\n    };\n    // 切换星期\n    const switchWeek = (type) => {\n        if (type === 'prev') {\n            if (currentSwiperIndex.value === 0)\n                return;\n            currentSwiperIndex.value--;\n        }\n        if (type === 'next') {\n            if (currentSwiperIndex.value === weekCalendarData.value.length - 1)\n                return;\n            currentSwiperIndex.value++;\n        }\n        emits('week-change', currentSwiperIndex.value);\n    };\n    // 滑动切换星期\n    const swiperChangeWeek = (event) => {\n        currentSwiperIndex.value = event.detail.current;\n        emits('week-change', currentSwiperIndex.value);\n    };\n    // 如果自定义数据发生变化，重新生成周日历数据\n    watch(() => { return props.customData; }, () => {\n        generateWeekCalendarData();\n    }, {\n        deep: true,\n    });\n    return {\n        componentDateItemId,\n        dateItemContainerHeight,\n        weekCalendarData,\n        weekText,\n        currentSwiperIndex,\n        dateItemClick,\n        switchWeek,\n        swiperChangeWeek,\n    };\n};\n//# sourceMappingURL=D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/week-calendar/src/composables/use-week-calendar.js.map","references":["D:/DEV/HBuilderX/plugins/uniapp-cli-vite/node_modules/@vue/runtime-core/dist/runtime-core.d.ts","D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/libs/dayjs/index.d.ts","D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/constants/index.ts","D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/utils/index.ts","D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/week-calendar/src/composables/use-week-calendar-selector.ts","D:/DEV/HBuilderX/plugins/uniapp-cli-vite/node_modules/@vue/runtime-core/dist/runtime-core.d.ts","D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/week-calendar/src/week-calendar.ts","D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/week-calendar/src/types.ts"],"uniExtApis":[],"map":"{\"version\":3,\"file\":\"use-week-calendar.js\",\"sourceRoot\":\"\",\"sources\":[\"use-week-calendar.ts\"],\"names\":[],\"mappings\":\"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\"}"}
