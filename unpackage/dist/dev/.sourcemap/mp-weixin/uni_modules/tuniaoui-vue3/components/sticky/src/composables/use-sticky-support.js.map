{"version":3,"file":"use-sticky-support.js","sources":["uni_modules/tuniaoui-vue3/components/sticky/src/composables/use-sticky-support.ts"],"sourcesContent":["import { getCurrentInstance, ref } from 'vue'\nimport { debugWarn } from '../../../..//utils'\n\nexport const useStickySupport = () => {\n  const supportCSSSticky = ref<boolean | null>(null)\n\n  const instance = getCurrentInstance()\n  if (!instance) {\n    debugWarn('TnSticky', '请在 setup 中使用 useStickySupport')\n  }\n\n  // H5通过创建元素的方法嗅探是否支持 CSS Sticky\n  const checkCSSStickySupportForH5 = () => {\n    // #ifdef H5\n    const vendorList = ['', '-webkit-', '-ms-', '-moz-', '-o-'],\n      vendorListLength = vendorList.length,\n      stickyElement = document.createElement('div')\n\n    for (let i = 0; i < vendorListLength; i++) {\n      stickyElement.style.position = `${vendorList[i]}sticky`\n      if (stickyElement.style.position !== '') {\n        supportCSSSticky.value = true\n        return\n      }\n    }\n\n    supportCSSSticky.value = false\n    // #endif\n  }\n\n  // 在APP和微信小程序上，通过uni.createSelectorQuery嗅探是否支持 CSS Sticky\n  const checkCSSStickySupportForAPPAndMPWX = (selector: string) => {\n    // #ifdef APP-VUE || MP-WEIXIN\n    uni\n      .createSelectorQuery()\n      .in(instance)\n      .select(selector)\n      .fields(\n        {\n          computedStyle: ['position'],\n        },\n        // eslint-disable-next-line @typescript-eslint/no-empty-function\n        () => {}\n      )\n      .exec((res) => {\n        if ('sticky' === res[0].position) {\n          supportCSSSticky.value = true\n        } else {\n          supportCSSSticky.value = false\n        }\n      })\n    // #endif\n  }\n\n  // 根据机型检测是否支持 CSS Sticky\n  const checkCSSStickySupportForDevice = () => {\n    // 获取手机对应的系统\\操作系统名称和版本\n    const { platform, system } = uni.getSystemInfoSync()\n    const os = platform.toLowerCase()\n    const osVersion = system\n    if (\n      (os === 'android' && Number(osVersion.replace('Android', '')) > 8) ||\n      os === 'ios'\n    ) {\n      supportCSSSticky.value = true\n    } else {\n      supportCSSSticky.value = false\n    }\n  }\n\n  // 检测当前环境是否支持 CSS Sticky\n  const checkCSSStickySupport = async (selector: string) => {\n    // 检测H5是否支持 CSS Sticky，主流浏览器都支持\n    // #ifdef H5\n    checkCSSStickySupportForH5()\n    // #endif\n\n    // 通过机型去判断是否支持 CSS Sticky\n    if (!supportCSSSticky.value) {\n      checkCSSStickySupportForDevice()\n    }\n\n    // 通过节点去判断是否支持 CSS Sticky\n    if (!supportCSSSticky.value) {\n      // #ifdef APP-VUE || MP-WEIXIN\n      checkCSSStickySupportForAPPAndMPWX(selector)\n      // #endif\n    }\n\n    // #ifdef APP-NVUE\n    // nvue默认时支持的\n    supportCSSSticky.value = true\n    // #endif\n  }\n\n  return {\n    supportCSSSticky,\n    checkCSSStickySupport,\n  }\n}\n"],"names":["ref","getCurrentInstance","debugWarn","uni","__awaiter"],"mappings":";;;;AAGa,MAAA,mBAAmB,MAAA;AAC9B,QAAM,mBAAmBA,kBAAoB,IAAI;AAEjD,QAAM,WAAWC,cAAAA;AACjB,MAAI,CAAC,UAAU;AACbC,mDAAU,YAAY,+BAA+B;AAAA,EACtD;AAsBD,QAAM,qCAAqC,CAAC,aAAgB;AAE1DC,kBAAG,MACA,oBAAqB,EACrB,GAAG,QAAQ,EACX,OAAO,QAAQ,EACf;AAAA,MACC;AAAA,QACE,eAAe,CAAC,UAAU;AAAA,MAC3B;AAAA;AAAA,MAED,MAAA;AAAA;IAAQ,EAET,KAAK,CAAC,QAAG;AACR,UAAI,aAAa,IAAI,CAAC,EAAE,UAAU;AAChC,yBAAiB,QAAQ;AAAA,MAC1B,OAAM;AACL,yBAAiB,QAAQ;AAAA,MAC1B;AAAA,IACH,CAAC;AAAA,EAEL;AAGA,QAAM,iCAAiC,MAAA;AAE/B,UAAA,KAAuBA,oBAAI,qBAAzB,WAAQ,GAAA,UAAE,SAAM,GAAA;AACxB,UAAM,KAAK,SAAS;AACpB,UAAM,YAAY;AAClB,QACG,OAAO,aAAa,OAAO,UAAU,QAAQ,WAAW,EAAE,CAAC,IAAI,KAChE,OAAO,OACP;AACA,uBAAiB,QAAQ;AAAA,IAC1B,OAAM;AACL,uBAAiB,QAAQ;AAAA,IAC1B;AAAA,EACH;AAGA,QAAM,wBAAwB,CAAO,aAAgB;AAAA,WAAAC,cAAAA,UAAA,QAAA,QAAA,QAAA,aAAA;AAOnD,UAAI,CAAC,iBAAiB,OAAO;AAC3B;MACD;AAGD,UAAI,CAAC,iBAAiB,OAAO;AAE3B,2CAAmC,QAAQ;AAAA,MAE5C;AAAA,IAMF,CAAA;AAAA;AAED,SAAO;AAAA,IACL;AAAA,IACA;AAAA;AAEJ;;"}