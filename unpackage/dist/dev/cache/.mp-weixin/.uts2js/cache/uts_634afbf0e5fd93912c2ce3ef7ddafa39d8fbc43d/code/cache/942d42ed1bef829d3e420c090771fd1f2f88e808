{"code":"import { __awaiter } from \"tslib\";\nimport { computed, getCurrentInstance, inject, nextTick, onMounted, onUnmounted, ref, watch, } from 'vue';\nimport { swipeActionContextKey } from '../../../../tokens';\nimport { useSelectorQuery, useTouch } from '../../../../hooks';\nimport { debugWarn, generateId, isEmptyDoubleVariableInDefault, } from '../../../../utils';\nexport const useSwipeActionItem = (props) => {\n    const instance = getCurrentInstance();\n    if (!instance) {\n        debugWarn('TnSwipeActionItem', '请在 setup 中使用 useSwipeActionItem');\n    }\n    const uid = instance.uid;\n    const swipeActionContext = inject(swipeActionContextKey, null);\n    if (!swipeActionContext) {\n        debugWarn('TnSwipeActionItem', '请在 TnSwipeAction 中使用 TnSwipeActionItem');\n    }\n    const componentId = `tsai-${generateId()}`;\n    const optionComponentClass = `${componentId}-option`;\n    const _a = useSelectorQuery(instance), getSelectorNodeInfo = _a.getSelectorNodeInfo, getSelectorNodeInfos = _a.getSelectorNodeInfos;\n    const _b = useTouch(), swipeActionItemDeltaX = _b.deltaX, swipeActionItemDistanceX = _b.distanceX, swipeActionItemDistanceY = _b.distanceY, swipeActionItemTouchIsVertical = _b.isVertical, updateSwipeActionItemTouchOptions = _b.updateOptions, swipeActionItemTouchStartEvent = _b.onTouchStart, swipeActionItemTouchMoveEvent = _b.onTouchMove, swipeActionItemTouchEndEvent = _b.onTouchEnd;\n    // 当前item的菜单是否为打开状态\n    const isOptionsOpen = computed(() => {\n        return swipeActionContext.activeUid.includes(uid);\n    });\n    // 点击options后是否自动关闭\n    const autoClose = computed(() => {\n        return isEmptyDoubleVariableInDefault(props === null || props === void 0 ? void 0 : props.autoClose, swipeActionContext === null || swipeActionContext === void 0 ? void 0 : swipeActionContext.autoClose, true);\n    });\n    // 禁止滑动\n    const disabledSwipe = computed(() => { var _a; return props.disabled || !((_a = props.options) === null || _a === void 0 ? void 0 : _a.length); });\n    watch(() => { return disabledSwipe.value; }, (val) => {\n        updateSwipeActionItemTouchOptions({\n            disabled: val,\n        });\n    }, {\n        immediate: true,\n    });\n    // 操作菜单的长度\n    const optionsMenuWidth = ref(0);\n    // 获取当前组件节点信息\n    let initCount = 0;\n    const getComponentNodeInfo = () => { return __awaiter(void 0, void 0, void 0, function* () {\n        var _a;\n        try {\n            const componentRectInfo = yield getSelectorNodeInfo(`#${componentId}`);\n            let optionsRectInfo = [];\n            if ((_a = props.options) === null || _a === void 0 ? void 0 : _a.length) {\n                optionsRectInfo = yield getSelectorNodeInfos(`.${optionComponentClass}`);\n            }\n            initCount = 0;\n            updateSwipeActionItemTouchOptions({\n                left: componentRectInfo.left,\n                right: componentRectInfo.right,\n                top: componentRectInfo.top,\n                bottom: componentRectInfo.bottom,\n            });\n            optionsMenuWidth.value = optionsRectInfo.reduce((prev, curr) => {\n                return prev + (curr.width || 0);\n            }, 0);\n        }\n        catch (err) {\n            if (initCount > 10) {\n                initCount = 0;\n                debugWarn('TnSwipeActionItem', `获取节点信息失败: ${err}`);\n                return;\n            }\n            initCount++;\n            setTimeout(() => {\n                getComponentNodeInfo();\n            }, 150);\n        }\n    }); };\n    // 内容距离左边移动的距离\n    const contentRightDistance = ref(0);\n    // 标记是否正在滑动，正在手动滑动的时候暂停动画\n    const isSwipe = ref(false);\n    // 内容滑动事件\n    const onTouchStart = (event) => {\n        swipeActionItemTouchStartEvent(event);\n    };\n    const onTouchMove = (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        swipeActionItemTouchMoveEvent(event);\n        isSwipe.value = true;\n        // 如果垂直方向上的移动距离过大则不允许进行滑动\n        if (swipeActionItemDistanceX.value < 3 &&\n            swipeActionItemDistanceY.value > 5) {\n            return;\n        }\n        // 如果当前菜单已经打开了则根据滑动的距离计算内容滑动的距离\n        if (isOptionsOpen.value) {\n            contentRightDistance.value =\n                optionsMenuWidth.value - swipeActionItemDeltaX.value;\n        }\n        else {\n            contentRightDistance.value = -swipeActionItemDeltaX.value;\n        }\n        if (contentRightDistance.value < 0)\n            contentRightDistance.value = 0;\n        if (contentRightDistance.value > optionsMenuWidth.value)\n            contentRightDistance.value = optionsMenuWidth.value;\n    };\n    const onTouchEnd = (event) => {\n        swipeActionItemTouchEndEvent(event);\n        // 如果垂直方向上的移动距离过大则不允许进行滑动\n        if (swipeActionItemDistanceX.value < 3 &&\n            swipeActionItemDistanceY.value > 5) {\n            return;\n        }\n        isSwipe.value = false;\n        // 如果滑动的距离大于展开阈值则显示操作菜单\n        if (-swipeActionItemDeltaX.value > props.threshold) {\n            openOptionsMenu();\n        }\n        else {\n            closeOptionsMenu();\n            updateAllItemOptionStatus();\n        }\n        if (swipeActionItemTouchIsVertical.value) {\n            updateAllItemOptionStatus();\n        }\n    };\n    // 关闭菜单\n    const closeOptionsMenu = () => {\n        isSwipe.value = false;\n        contentRightDistance.value = 0;\n    };\n    // 更新所有item的菜单状态\n    const updateAllItemOptionStatus = () => {\n        if (isOptionsOpen.value) {\n            swipeActionContext === null || swipeActionContext === void 0 ? void 0 : swipeActionContext.setActiveItem(uid);\n        }\n        else {\n            if (swipeActionContext === null || swipeActionContext === void 0 ? void 0 : swipeActionContext.exclusive) {\n                swipeActionContext === null || swipeActionContext === void 0 ? void 0 : swipeActionContext.closeAllItemOption();\n            }\n        }\n    };\n    // 打开菜单\n    const openOptionsMenu = () => {\n        isSwipe.value = false;\n        contentRightDistance.value = optionsMenuWidth.value;\n        swipeActionContext === null || swipeActionContext === void 0 ? void 0 : swipeActionContext.setActiveItem(uid);\n    };\n    watch(() => { return isOptionsOpen.value; }, (val) => {\n        if (!val) {\n            closeOptionsMenu();\n        }\n    });\n    // 监听菜单操作点击事件\n    const optionClickEvent = (index) => {\n        const option = props.options[index];\n        if (option.disabled)\n            return;\n        swipeActionContext === null || swipeActionContext === void 0 ? void 0 : swipeActionContext.optionClick(uid, index);\n        if (autoClose.value) {\n            closeOptionsMenu();\n        }\n    };\n    onMounted(() => {\n        swipeActionContext === null || swipeActionContext === void 0 ? void 0 : swipeActionContext.addItem({\n            uid,\n        });\n        nextTick(() => {\n            getComponentNodeInfo();\n        });\n    });\n    onUnmounted(() => {\n        swipeActionContext === null || swipeActionContext === void 0 ? void 0 : swipeActionContext.removeItem(uid);\n    });\n    return {\n        componentId,\n        optionComponentClass,\n        isOptionsOpen,\n        optionsMenuWidth,\n        contentRightDistance,\n        isSwipe,\n        onTouchStart,\n        onTouchMove,\n        onTouchEnd,\n        optionClickEvent,\n    };\n};\n//# sourceMappingURL=D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/swipe-action/src/composables/use-swipe-action-item.js.map","references":["D:/Development/HBuilderX/plugins/uniapp-cli-vite/node_modules/@vue/runtime-core/dist/runtime-core.d.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/tokens/index.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/hooks/index.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/utils/index.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/swipe-action/src/swipe-action-item.ts"],"uniExtApis":[],"map":"{\"version\":3,\"file\":\"use-swipe-action-item.js\",\"sourceRoot\":\"\",\"sources\":[\"use-swipe-action-item.ts\"],\"names\":[],\"mappings\":\";AAAA,OAAO,EACL,QAAQ,EACR,kBAAkB,EAClB,MAAM,EACN,QAAQ,EACR,SAAS,EACT,WAAW,EACX,GAAG,EACH,KAAK,GACN,MAAM,KAAK,CAAA;AACZ,OAAO,EAAE,qBAAqB,EAAE,MAAM,oBAAoB,CAAA;AAC1D,OAAO,EAAE,gBAAgB,EAAE,QAAQ,EAAE,MAAM,mBAAmB,CAAA;AAC9D,OAAO,EACL,SAAS,EACT,UAAU,EACV,8BAA8B,GAC/B,MAAM,mBAAmB,CAAA;AAI1B,MAAM,CAAC,MAAM,kBAAkB,GAAG,CAAC,KAA2B;IAC5D,MAAM,QAAQ,GAAG,kBAAkB,EAAE,CAAA;IACrC,IAAI,CAAC,QAAQ,EAAE;QACb,SAAS,CAAC,mBAAmB,EAAE,iCAAiC,CAAC,CAAA;KAClE;IACO,MAAA,GAAG,GAAK,QAAS,IAAd,CAAc;IAEzB,MAAM,kBAAkB,GAAG,MAAM,CAAC,qBAAqB,EAAE,IAAI,CAAC,CAAA;IAC9D,IAAI,CAAC,kBAAkB,EAAE;QACvB,SAAS,CACP,mBAAmB,EACnB,wCAAwC,CACzC,CAAA;KACF;IAED,MAAM,WAAW,GAAG,QAAQ,UAAU,EAAE,EAAE,CAAA;IAC1C,MAAM,oBAAoB,GAAG,GAAG,WAAW,SAAS,CAAA;IAE9C,MAAA,KACJ,gBAAgB,CAAC,QAAQ,CAAC,EADpB,mBAAmB,yBAAA,EAAE,oBAAoB,0BACrB,CAAA;IAEtB,MAAA,KASF,QAAQ,EAAE,EARJ,qBAAqB,YAAA,EAClB,wBAAwB,eAAA,EACxB,wBAAwB,eAAA,EACvB,8BAA8B,gBAAA,EAC3B,iCAAiC,mBAAA,EAClC,8BAA8B,kBAAA,EAC/B,6BAA6B,iBAAA,EAC9B,4BAA4B,gBAC5B,CAAA;IAEd,mBAAmB;IACnB,MAAM,aAAa,GAAG,QAAQ,CAAU;QACtC,OAAA,kBAAmB,CAAC,SAAS,CAAC,QAAQ,CAAC,GAAG,CAAC;IAA3C,CAA2C,CAC5C,CAAA;IAED,mBAAmB;IACnB,MAAM,SAAS,GAAG,QAAQ,CAAU;QAClC,OAAA,8BAA8B,CAC5B,KAAK,aAAL,KAAK,uBAAL,KAAK,CAAE,SAAS,EAChB,kBAAkB,aAAlB,kBAAkB,uBAAlB,kBAAkB,CAAE,SAAS,EAC7B,IAAI,CACL;IAJD,CAIC,CACF,CAAA;IAED,OAAO;IACP,MAAM,aAAa,GAAG,QAAQ,CAC5B,gBAAM,OAAA,KAAK,CAAC,QAAQ,IAAI,CAAC,CAAA,MAAA,KAAK,CAAC,OAAO,0CAAE,MAAM,CAAA,CAAA,EAAA,CAC/C,CAAA;IACD,KAAK,CACH,QAAM,OAAA,aAAa,CAAC,KAAK,EAAnB,CAAmB,EACzB,CAAC,GAAG;QACF,iCAAiC,CAAC;YAChC,QAAQ,EAAE,GAAG;SACd,CAAC,CAAA;IACJ,CAAC,EACD;QACE,SAAS,EAAE,IAAI;KAChB,CACF,CAAA;IAED,UAAU;IACV,MAAM,gBAAgB,GAAG,GAAG,CAAC,CAAC,CAAC,CAAA;IAE/B,aAAa;IACb,IAAI,SAAS,GAAG,CAAC,CAAA;IACjB,MAAM,oBAAoB,GAAG;;QAC3B,IAAI;YACF,MAAM,iBAAiB,GAAG,MAAM,mBAAmB,CAAC,IAAI,WAAW,EAAE,CAAC,CAAA;YACtE,IAAI,eAAe,GAAsB,EAAE,CAAA;YAC3C,IAAI,MAAA,KAAK,CAAC,OAAO,0CAAE,MAAM,EAAE;gBACzB,eAAe,GAAG,MAAM,oBAAoB,CAAC,IAAI,oBAAoB,EAAE,CAAC,CAAA;aACzE;YAED,SAAS,GAAG,CAAC,CAAA;YACb,iCAAiC,CAAC;gBAChC,IAAI,EAAE,iBAAiB,CAAC,IAAI;gBAC5B,KAAK,EAAE,iBAAiB,CAAC,KAAK;gBAC9B,GAAG,EAAE,iBAAiB,CAAC,GAAG;gBAC1B,MAAM,EAAE,iBAAiB,CAAC,MAAM;aACjC,CAAC,CAAA;YAEF,gBAAgB,CAAC,KAAK,GAAG,eAAe,CAAC,MAAM,CAAC,CAAC,IAAI,EAAE,IAAI;gBACzD,OAAO,IAAI,GAAG,CAAC,IAAI,CAAC,KAAK,IAAI,CAAC,CAAC,CAAA;YACjC,CAAC,EAAE,CAAC,CAAC,CAAA;SACN;QAAC,OAAO,GAAG,EAAE;YACZ,IAAI,SAAS,GAAG,EAAE,EAAE;gBAClB,SAAS,GAAG,CAAC,CAAA;gBACb,SAAS,CAAC,mBAAmB,EAAE,aAAa,GAAG,EAAE,CAAC,CAAA;gBAClD,OAAM;aACP;YACD,SAAS,EAAE,CAAA;YACX,UAAU,CAAC;gBACT,oBAAoB,EAAE,CAAA;YACxB,CAAC,EAAE,GAAG,CAAC,CAAA;SACR;IACH,CAAC,IAAA,CAAA;IAED,cAAc;IACd,MAAM,oBAAoB,GAAG,GAAG,CAAS,CAAC,CAAC,CAAA;IAE3C,yBAAyB;IACzB,MAAM,OAAO,GAAG,GAAG,CAAU,KAAK,CAAC,CAAA;IAEnC,SAAS;IACT,MAAM,YAAY,GAAG,CAAC,KAAU;QAC9B,8BAA8B,CAAC,KAAK,CAAC,CAAA;IACvC,CAAC,CAAA;IACD,MAAM,WAAW,GAAG,CAAC,KAAU;QAC7B,KAAK,CAAC,cAAc,EAAE,CAAA;QACtB,KAAK,CAAC,eAAe,EAAE,CAAA;QACvB,6BAA6B,CAAC,KAAK,CAAC,CAAA;QACpC,OAAO,CAAC,KAAK,GAAG,IAAI,CAAA;QACpB,yBAAyB;QACzB,IACE,wBAAwB,CAAC,KAAK,GAAG,CAAC;YAClC,wBAAwB,CAAC,KAAK,GAAG,CAAC,EAClC;YACA,OAAM;SACP;QAED,+BAA+B;QAC/B,IAAI,aAAa,CAAC,KAAK,EAAE;YACvB,oBAAoB,CAAC,KAAK;gBACxB,gBAAgB,CAAC,KAAK,GAAG,qBAAqB,CAAC,KAAK,CAAA;SACvD;aAAM;YACL,oBAAoB,CAAC,KAAK,GAAG,CAAC,qBAAqB,CAAC,KAAK,CAAA;SAC1D;QACD,IAAI,oBAAoB,CAAC,KAAK,GAAG,CAAC;YAAE,oBAAoB,CAAC,KAAK,GAAG,CAAC,CAAA;QAClE,IAAI,oBAAoB,CAAC,KAAK,GAAG,gBAAgB,CAAC,KAAK;YACrD,oBAAoB,CAAC,KAAK,GAAG,gBAAgB,CAAC,KAAK,CAAA;IACvD,CAAC,CAAA;IACD,MAAM,UAAU,GAAG,CAAC,KAAU;QAC5B,4BAA4B,CAAC,KAAK,CAAC,CAAA;QACnC,yBAAyB;QACzB,IACE,wBAAwB,CAAC,KAAK,GAAG,CAAC;YAClC,wBAAwB,CAAC,KAAK,GAAG,CAAC,EAClC;YACA,OAAM;SACP;QACD,OAAO,CAAC,KAAK,GAAG,KAAK,CAAA;QACrB,uBAAuB;QACvB,IAAI,CAAC,qBAAqB,CAAC,KAAK,GAAG,KAAK,CAAC,SAAS,EAAE;YAClD,eAAe,EAAE,CAAA;SAClB;aAAM;YACL,gBAAgB,EAAE,CAAA;YAClB,yBAAyB,EAAE,CAAA;SAC5B;QAED,IAAI,8BAA8B,CAAC,KAAK,EAAE;YACxC,yBAAyB,EAAE,CAAA;SAC5B;IACH,CAAC,CAAA;IAED,OAAO;IACP,MAAM,gBAAgB,GAAG;QACvB,OAAO,CAAC,KAAK,GAAG,KAAK,CAAA;QACrB,oBAAoB,CAAC,KAAK,GAAG,CAAC,CAAA;IAChC,CAAC,CAAA;IAED,gBAAgB;IAChB,MAAM,yBAAyB,GAAG;QAChC,IAAI,aAAa,CAAC,KAAK,EAAE;YACvB,kBAAkB,aAAlB,kBAAkB,uBAAlB,kBAAkB,CAAE,aAAa,CAAC,GAAG,CAAC,CAAA;SACvC;aAAM;YACL,IAAI,kBAAkB,aAAlB,kBAAkB,uBAAlB,kBAAkB,CAAE,SAAS,EAAE;gBACjC,kBAAkB,aAAlB,kBAAkB,uBAAlB,kBAAkB,CAAE,kBAAkB,EAAE,CAAA;aACzC;SACF;IACH,CAAC,CAAA;IAED,OAAO;IACP,MAAM,eAAe,GAAG;QACtB,OAAO,CAAC,KAAK,GAAG,KAAK,CAAA;QACrB,oBAAoB,CAAC,KAAK,GAAG,gBAAgB,CAAC,KAAK,CAAA;QACnD,kBAAkB,aAAlB,kBAAkB,uBAAlB,kBAAkB,CAAE,aAAa,CAAC,GAAG,CAAC,CAAA;IACxC,CAAC,CAAA;IAED,KAAK,CACH,QAAM,OAAA,aAAa,CAAC,KAAK,EAAnB,CAAmB,EACzB,CAAC,GAAG;QACF,IAAI,CAAC,GAAG,EAAE;YACR,gBAAgB,EAAE,CAAA;SACnB;IACH,CAAC,CACF,CAAA;IAED,aAAa;IACb,MAAM,gBAAgB,GAAG,CAAC,KAAa;QACrC,MAAM,MAAM,GAAG,KAAK,CAAC,OAAQ,CAAC,KAAK,CAAC,CAAA;QACpC,IAAI,MAAM,CAAC,QAAQ;YAAE,OAAM;QAC3B,kBAAkB,aAAlB,kBAAkB,uBAAlB,kBAAkB,CAAE,WAAW,CAAC,GAAG,EAAE,KAAK,CAAC,CAAA;QAC3C,IAAI,SAAS,CAAC,KAAK,EAAE;YACnB,gBAAgB,EAAE,CAAA;SACnB;IACH,CAAC,CAAA;IAED,SAAS,CAAC;QACR,kBAAkB,aAAlB,kBAAkB,uBAAlB,kBAAkB,CAAE,OAAO,CAAC;YAC1B,GAAG;SACJ,CAAC,CAAA;QACF,QAAQ,CAAC;YACP,oBAAoB,EAAE,CAAA;QACxB,CAAC,CAAC,CAAA;IACJ,CAAC,CAAC,CAAA;IAEF,WAAW,CAAC;QACV,kBAAkB,aAAlB,kBAAkB,uBAAlB,kBAAkB,CAAE,UAAU,CAAC,GAAG,CAAC,CAAA;IACrC,CAAC,CAAC,CAAA;IAEF,OAAO;QACL,WAAW;QACX,oBAAoB;QACpB,aAAa;QACb,gBAAgB;QAChB,oBAAoB;QACpB,OAAO;QACP,YAAY;QACZ,WAAW;QACX,UAAU;QACV,gBAAgB;KACjB,CAAA;AACH,CAAC,CAAA\"}"}
