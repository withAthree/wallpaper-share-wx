{"code":"import { __awaiter, __values } from \"tslib\";\nimport { computed } from 'vue';\nimport { filterFields } from '../utils';\nimport { isFunction } from '../../../../utils';\nexport const useForm = (props) => {\n    // formItem信息\n    const fields = [];\n    // 添加formItem信息\n    const addField = (field) => {\n        fields.push(field);\n    };\n    // 移除formItem信息\n    const removeField = (field) => {\n        if (field.prop) {\n            fields.splice(fields.indexOf(field), 1);\n        }\n    };\n    // 重置formItem\n    const resetFields = (properties = []) => {\n        if (!props.model) {\n            // eslint-disable-next-line no-console\n            return uni.__f__('warn', 'at uni_modules/tuniaoui-vue3/components/form/src/composables/use-form.ts:36', '[TnForm] model参数未定义');\n        }\n        filterFields(fields, properties).forEach((field) => { return field.resetField(); });\n    };\n    // 清除formItem验证\n    const clearValidate = (props = []) => {\n        filterFields(fields, props).forEach((field) => { return field.clearValidate(); });\n    };\n    // 是否可以进行校验\n    const isValidatable = computed(() => {\n        const hasModel = !!props.model;\n        if (!hasModel) {\n            // eslint-disable-next-line no-console\n            uni.__f__('warn', 'at uni_modules/tuniaoui-vue3/components/form/src/composables/use-form.ts:51', '[TnForm] model参数未定义');\n        }\n        return hasModel;\n    });\n    // 获取需要校验的字段\n    const obtainValidateFields = (props) => {\n        if (fields.length === 0)\n            return [];\n        const filteredFields = filterFields(fields, props);\n        if (!filteredFields.length) {\n            // eslint-disable-next-line no-console\n            uni.__f__('warn', 'at uni_modules/tuniaoui-vue3/components/form/src/composables/use-form.ts:63', '[TnForm] 未找到需要校验的字段');\n            return [];\n        }\n        return filteredFields;\n    };\n    // 校验\n    const validate = (callback) => { return __awaiter(void 0, void 0, void 0, function* () { return validateField(undefined, callback); }); };\n    // 开始校验字段\n    const doValidateField = (props) => { return __awaiter(void 0, void 0, void 0, function* () {\n        var e_1, _a;\n        if (!isValidatable.value)\n            return false;\n        const fields = obtainValidateFields(props);\n        if (fields.length === 0)\n            return false;\n        let validationErrors = {};\n        try {\n            for (var fields_1 = __values(fields), fields_1_1 = fields_1.next(); !fields_1_1.done; fields_1_1 = fields_1.next()) {\n                var field = fields_1_1.value;\n                try {\n                    yield field.validate('');\n                }\n                catch (fields) {\n                    validationErrors = Object.assign(Object.assign({}, validationErrors), fields);\n                }\n            }\n        }\n        catch (e_1_1) { e_1 = { error: e_1_1 }; }\n        finally {\n            try {\n                if (fields_1_1 && !fields_1_1.done && (_a = fields_1.return)) _a.call(fields_1);\n            }\n            finally { if (e_1) throw e_1.error; }\n        }\n        if (Object.keys(validationErrors).length === 0)\n            return true;\n        return Promise.reject(validationErrors);\n    }); };\n    // 校验字段\n    const validateField = (modelProps = [], callback) => { return __awaiter(void 0, void 0, void 0, function* () {\n        const shouldThrow = !isFunction(callback);\n        try {\n            const result = yield doValidateField(modelProps);\n            // 如果结果为false则说明当前校验不通过\n            if (result === true) {\n                callback === null || callback === void 0 ? void 0 : callback(true);\n            }\n            return result;\n        }\n        catch (e) {\n            if (e instanceof Error)\n                throw e;\n            const invalidFields = e;\n            callback === null || callback === void 0 ? void 0 : callback(false, invalidFields);\n            return shouldThrow && Promise.reject(invalidFields);\n        }\n    }); };\n    return {\n        addField,\n        removeField,\n        resetFields,\n        clearValidate,\n        validate,\n        validateField,\n    };\n};\n//# sourceMappingURL=D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/form/src/composables/use-form.js.map","references":["D:/Development/HBuilderX/plugins/uniapp-cli-vite/node_modules/@vue/runtime-core/dist/runtime-core.d.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/form/src/utils.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/utils/index.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/libs/async-validator/index.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/form/src/form-item.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/form/src/form.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/form/src/types.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/utils/index.ts"],"uniExtApis":[],"map":"{\"version\":3,\"file\":\"use-form.js\",\"sourceRoot\":\"\",\"sources\":[\"use-form.ts\"],\"names\":[],\"mappings\":\"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\"}"}
