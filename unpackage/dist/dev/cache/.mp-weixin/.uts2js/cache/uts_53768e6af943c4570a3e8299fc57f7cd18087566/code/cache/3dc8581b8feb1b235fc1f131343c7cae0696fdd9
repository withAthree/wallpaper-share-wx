{"code":"import { __awaiter } from \"tslib\";\nimport { reactive, watch } from 'vue';\nimport { debugWarn, generateId } from '../../../../utils';\nimport { useSelectorQuery, useTouch } from '../../../../hooks';\nimport { useSliderCommonProps } from './use-slider-common-porps';\nimport { useSlider } from './use-slider';\nexport const useSliderNodeInfo = (props) => {\n    const sliderId = `slider-${generateId()}`;\n    const getSelectorNodeInfo = useSelectorQuery().getSelectorNodeInfo;\n    const disabled = useSliderCommonProps(props).disabled;\n    const _a = useSlider(props), mode = _a.mode, sliderValue = _a.sliderValue, precision = _a.precision, updateSliderValue = _a.updateSliderValue, changeSliderValue = _a.changeSliderValue;\n    const sliderNodeInfo = reactive({\n        left: 0,\n        top: 0,\n        right: 0,\n        bottom: 0,\n        width: 0,\n        height: 0,\n    });\n    const _b = useTouch(), sliderBarCurrentX = _b.currentX, sliderTouchUpdateOptions = _b.updateOptions, sliderTouchStart = _b.onTouchStart, sliderTouchMove = _b.onTouchMove, sliderTouchEnd = _b.onTouchEnd;\n    // 更新禁用状态\n    watch(() => { return disabled; }, (val) => {\n        sliderTouchUpdateOptions({\n            disabled: val.value,\n        });\n    });\n    // 初始化滑动条的布局信息\n    // 初始化次数\n    let initCount = 0;\n    const initSliderNodeInfo = () => { return __awaiter(void 0, void 0, void 0, function* () {\n        try {\n            const sliderRectInfo = yield getSelectorNodeInfo(`#${sliderId}`);\n            if (!sliderRectInfo) {\n                throw new Error('获取滑动条的布局信息失败');\n            }\n            initCount = 0;\n            sliderNodeInfo.left = sliderRectInfo.left || 0;\n            sliderNodeInfo.top = sliderRectInfo.top || 0;\n            sliderNodeInfo.right = sliderRectInfo.right || 0;\n            sliderNodeInfo.bottom = sliderRectInfo.bottom || 0;\n            sliderNodeInfo.width = sliderRectInfo.width || 0;\n            sliderNodeInfo.height = sliderRectInfo.height || 0;\n            // 初始化触摸的参数\n            sliderTouchUpdateOptions({\n                left: sliderNodeInfo.left,\n                right: sliderNodeInfo.right,\n                top: sliderNodeInfo.top,\n                bottom: sliderNodeInfo.bottom,\n            });\n        }\n        catch (err) {\n            initCount++;\n            if (initCount > 10) {\n                initCount = 0;\n                debugWarn('TnSilider', `获取滑动条的布局信息失败: ${err}`);\n                return;\n            }\n            setTimeout(() => {\n                initSliderNodeInfo();\n            }, 150);\n        }\n    }); };\n    // 滑块滑动中\n    const onSliderBarTouchMove = (event, type) => {\n        sliderTouchMove(event);\n        // 滑块的位置\n        const sliderBarPosition = (sliderBarCurrentX.value / sliderNodeInfo.width) * 100;\n        const value = setPosiiton(sliderBarPosition);\n        updateSliderValue(value, type);\n    };\n    // 滑块滑动结束\n    const onSliderBarTouchEnd = (event, type) => {\n        sliderTouchEnd(event);\n        // 滑块的位置\n        const sliderBarPosition = (sliderBarCurrentX.value / sliderNodeInfo.width) * 100;\n        const value = setPosiiton(sliderBarPosition);\n        changeSliderValue(value, type);\n    };\n    // 滑动条点击事件\n    const sliderClickEvent = (event) => {\n        if (disabled.value)\n            return;\n        let touchX = 0;\n        touchX = event.detail.x;\n        const sliderBarPosition = ((touchX - sliderNodeInfo.left) / sliderNodeInfo.width) * 100;\n        const value = setPosiiton(sliderBarPosition);\n        if (mode.value === 'single') {\n            updateSliderValue(value);\n            changeSliderValue(value);\n        }\n        else if (mode.value === 'range') {\n            // 判断当前点击位置靠近那个值\n            const minValue = sliderValue.value[0];\n            const maxValue = sliderValue.value[1];\n            const minDistance = Math.abs(minValue - value);\n            const maxDistance = Math.abs(maxValue - value);\n            if (minDistance < maxDistance) {\n                updateSliderValue(value, 'min');\n                changeSliderValue(value, 'min');\n            }\n            else {\n                updateSliderValue(value, 'max');\n                changeSliderValue(value, 'max');\n            }\n        }\n    };\n    // 设置滑块的位置\n    const setPosiiton = (position) => {\n        if (position === null || Number.isNaN(+position))\n            return 0;\n        if (position < 0)\n            position = 0;\n        else if (position > 100)\n            position = 100;\n        // 每一步的长度\n        const lengthPerStep = 100 / ((props.max - props.min) / props.step);\n        // 当前在第几步\n        const steps = Math.round(position / lengthPerStep);\n        // 计算当前的值\n        let value = steps * lengthPerStep * (props.max - props.min) * 0.01 + props.min;\n        value = Number.parseFloat(value.toFixed(precision.value));\n        return value;\n    };\n    return {\n        sliderId,\n        initSliderNodeInfo,\n        onSliderBarTouchStart: sliderTouchStart,\n        onSliderBarTouchMove,\n        onSliderBarTouchEnd,\n        sliderClickEvent,\n    };\n};\n//# sourceMappingURL=D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/slider/src/composables/use-slider-node-info.js.map","references":["D:/DEV/HBuilderX/plugins/uniapp-cli-vite/node_modules/@vue/runtime-core/dist/runtime-core.d.ts","D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/utils/index.ts","D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/hooks/index.ts","D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/slider/src/composables/use-slider-common-porps.ts","D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/slider/src/composables/use-slider.ts","D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/slider/src/slider.ts"],"uniExtApis":[],"map":"{\"version\":3,\"file\":\"use-slider-node-info.js\",\"sourceRoot\":\"\",\"sources\":[\"use-slider-node-info.ts\"],\"names\":[],\"mappings\":\"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\"}"}
