{"version":3,"file":"use-calendar-selector.js","sources":["uni_modules/tuniaoui-vue3/components/calendar/src/composables/use-calendar-selector.ts"],"sourcesContent":["import { computed, getCurrentInstance, nextTick, onMounted, ref } from 'vue'\r\nimport { useSelectorQuery } from '../../../../hooks'\r\nimport { debugWarn, generateId } from '../../../../utils'\r\n\r\nimport type { Ref } from 'vue'\r\nimport type { CalendarMode } from '../calendar'\r\n\r\nexport const useCalendarSelector = (\r\n  currentDateCount: Ref<number>,\r\n  mode: CalendarMode\r\n) => {\r\n  const instance = getCurrentInstance()\r\n  if (!instance) {\r\n    debugWarn('TnCalendar', '请在 setup 函数中使用 useCalendarSelector')\r\n  }\r\n\r\n  const calendarId = `tc-${generateId()}`\r\n\r\n  const { getSelectorNodeInfo } = useSelectorQuery(instance)\r\n\r\n  // 单个日期的高度\r\n  const singleDateItemHeight = ref<number>(0)\r\n\r\n  // 日期容器的高度\r\n  const dateContainerHeight = computed<number>(\r\n    () => Math.ceil(currentDateCount.value / 7) * singleDateItemHeight.value\r\n  )\r\n\r\n  let initCount = 0\r\n  // 获取单个日期容器的信息\r\n  const getDateItemComponentRectInfo = async () => {\r\n    try {\r\n      const rectInfo = await getSelectorNodeInfo(\r\n        `#${calendarId} .tn-calendar__data__date`\r\n      )\r\n\r\n      initCount = 0\r\n      singleDateItemHeight.value = rectInfo.width || 0\r\n      if (mode === 'date' || mode === 'multi') {\r\n        singleDateItemHeight.value += uni.upx2px(12)\r\n      }\r\n    } catch (err) {\r\n      if (initCount > 10) {\r\n        initCount = 0\r\n        debugWarn('TnCalendar', `获取单个日期容器信息失败: ${err}`)\r\n        return\r\n      }\r\n      initCount++\r\n      setTimeout(() => {\r\n        getDateItemComponentRectInfo()\r\n      }, 150)\r\n    }\r\n  }\r\n\r\n  onMounted(() => {\r\n    nextTick(() => {\r\n      setTimeout(() => {\r\n        getDateItemComponentRectInfo()\r\n      }, 50)\r\n    })\r\n  })\r\n\r\n  return {\r\n    calendarId,\r\n    dateContainerHeight,\r\n  }\r\n}\r\n"],"names":["getCurrentInstance","debugWarn","generateId","useSelectorQuery","ref","computed","__awaiter","uni","onMounted","nextTick"],"mappings":";;;;;;;AAOa,MAAA,sBAAsB,CACjC,kBACA,SAAkB;AAElB,QAAM,WAAWA,cAAAA;AACjB,MAAI,CAAC,UAAU;AACbC,mDAAU,cAAc,oCAAoC;AAAA,EAC7D;AAED,QAAM,aAAa,MAAMC,oCAAU,WAAA,CAAE;AAE7B,QAAA,sBAAwBC,sDAAAA,iBAAiB,QAAQ;AAGzD,QAAM,uBAAuBC,kBAAY,CAAC;AAG1C,QAAM,sBAAsBC,cAAQ,SAClC;AAAM,WAAA,KAAK,KAAK,iBAAiB,QAAQ,CAAC,IAAI,qBAAqB;AAAA,EAAK,CAAA;AAG1E,MAAI,YAAY;AAEhB,QAAM,+BAA+B,MAAA;AAAA,WAAAC,cAAA,UAAA,QAAA,QAAA,QAAA,aAAA;AACnC,UAAI;AACF,cAAM,WAAW,MAAM,oBACrB,IAAI,UAAU,2BAA2B;AAG3C,oBAAY;AACZ,6BAAqB,QAAQ,SAAS,SAAS;AAC/C,YAAI,SAAS,UAAU,SAAS,SAAS;AACvC,+BAAqB,SAASC,cAAAA,MAAI,OAAO,EAAE;AAAA,QAC5C;AAAA,MACF,SAAQ,KAAK;AACZ,YAAI,YAAY,IAAI;AAClB,sBAAY;AACZN,+CAAAA,UAAU,cAAc,iBAAiB,GAAG,EAAE;AAC9C;AAAA,QACD;AACD;AACA,mBAAW,MAAA;AACT;QACD,GAAE,GAAG;AAAA,MACP;AAAA,IACF,CAAA;AAAA;AAEDO,gBAAAA,UAAU,MAAA;AACRC,kBAAAA,WAAS,MAAA;AACP,iBAAW,MAAA;AACT;MACD,GAAE,EAAE;AAAA,IACP,CAAC;AAAA,EACH,CAAC;AAED,SAAO;AAAA,IACL;AAAA,IACA;AAAA;AAEJ;;"}