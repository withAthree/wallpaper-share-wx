{"code":"import { __awaiter } from \"tslib\";\nimport { getCurrentInstance, nextTick, onMounted, provide, reactive, ref, toRefs, watch, } from 'vue';\nimport { subsectionContextKey } from '../../../../tokens';\nimport { useOrderedChildren, useSelectorQuery } from '../../../../hooks';\nimport { debugWarn, generateId, isEmptyDoubleVariableInDefault, } from '../../../../utils';\nexport const useSubsection = (props, emits) => {\n    const instance = getCurrentInstance();\n    if (!instance) {\n        debugWarn('TnSubsection', '请在 setup 中使用 useSubsection');\n    }\n    const _a = useOrderedChildren(), items = _a.children, addChild = _a.addChild, removeItem = _a.removeChild;\n    const componentId = `ts-${generateId()}`;\n    const getSelectorNodeInfo = useSelectorQuery(instance).getSelectorNodeInfo;\n    // 当前激活的item的uid\n    const activeUid = ref(0);\n    // 当前选中的Index\n    const currentActiveIndex = ref(0);\n    // 添加ChildrenItem\n    const addItem = (item) => {\n        if (props.modelValue !== undefined) {\n            if (props.modelValue === items.value.length) {\n                currentActiveIndex.value = props.modelValue;\n                activeUid.value = item.uid;\n                nextTick(() => {\n                    updateSliderRectInfo(item);\n                });\n            }\n        }\n        addChild(item);\n    };\n    // 根据当前激活的Index更新activeUid\n    const updateActiveUidWithIndex = () => {\n        nextTick(() => {\n            const item = items.value[currentActiveIndex.value];\n            if (item) {\n                activeUid.value = item.uid;\n                updateSliderRectInfo(item);\n            }\n        });\n    };\n    let innerUpdate = false;\n    watch(() => { return props.modelValue; }, (val) => {\n        if (innerUpdate) {\n            innerUpdate = false;\n            return;\n        }\n        if (val === undefined || val > items.value.length - 1) {\n            currentActiveIndex.value = 0;\n        }\n        else {\n            currentActiveIndex.value = val;\n        }\n        updateActiveUidWithIndex();\n    });\n    // 获取组件节点信息\n    let componentLeft = 0;\n    let initCount = 0;\n    const getComponentRectInfo = () => { return __awaiter(void 0, void 0, void 0, function* () {\n        try {\n            const rectInfo = yield getSelectorNodeInfo(`#${componentId}`);\n            initCount = 0;\n            componentLeft = rectInfo.left || 0;\n        }\n        catch (err) {\n            if (initCount > 10) {\n                initCount = 0;\n                debugWarn('TnSubsection', `获取组件节点信息失败: ${err}`);\n                return;\n            }\n            initCount++;\n            setTimeout(() => {\n                getComponentRectInfo();\n            }, 150);\n        }\n    }); };\n    // 设置当前被点击的activeUID\n    const setActiveItem = (uid) => {\n        const index = items.value.findIndex((item) => { return item.uid === uid; });\n        if (index !== -1) {\n            innerUpdate = true;\n            activeUid.value = uid;\n            currentActiveIndex.value = index;\n            updateSliderRectInfo(items.value[index]);\n            emits('update:modelValue', index);\n            nextTick(() => {\n                emits('change', index);\n            });\n        }\n    };\n    // 更新滑动样式容器信息\n    const activeColor = ref('');\n    const sliderRectInfo = ref({\n        left: 0,\n        width: 0,\n    });\n    const updateSliderRectInfo = (item) => {\n        if (!item)\n            return;\n        sliderRectInfo.value.left = item.element.left - componentLeft;\n        sliderRectInfo.value.width = item.element.width;\n        if (props.mode === 'default') {\n            sliderRectInfo.value.left -= 1;\n            if (props.modelValue === items.value.length - 1) {\n                sliderRectInfo.value.width += 2;\n            }\n        }\n        activeColor.value = isEmptyDoubleVariableInDefault(item.activeColor, props.activeColor, '');\n    };\n    onMounted(() => {\n        nextTick(() => {\n            getComponentRectInfo();\n        });\n    });\n    provide(subsectionContextKey, reactive(Object.assign(Object.assign({}, toRefs(props)), { items,\n        addItem,\n        removeItem,\n        activeUid,\n        setActiveItem })));\n    return {\n        componentId,\n        activeColor,\n        sliderRectInfo,\n    };\n};\n//# sourceMappingURL=D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/subsection/src/composables/use-subsection.js.map","references":["D:/Development/HBuilderX/plugins/uniapp-cli-vite/node_modules/@vue/runtime-core/dist/runtime-core.d.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/tokens/index.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/hooks/index.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/utils/index.ts","D:/Development/HBuilderX/plugins/uniapp-cli-vite/node_modules/@vue/runtime-core/dist/runtime-core.d.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/tokens/index.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/subsection/src/subsection.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/subsection/src/types.ts"],"uniExtApis":[],"map":"{\"version\":3,\"file\":\"use-subsection.js\",\"sourceRoot\":\"\",\"sources\":[\"use-subsection.ts\"],\"names\":[],\"mappings\":\"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\"}"}
