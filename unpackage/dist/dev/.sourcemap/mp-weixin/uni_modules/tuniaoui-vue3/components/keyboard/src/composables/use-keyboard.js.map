{"version":3,"file":"use-keyboard.js","sources":["uni_modules/tuniaoui-vue3/components/keyboard/src/composables/use-keyboard.ts"],"sourcesContent":["import { nextTick, ref, toRef, watch } from 'vue'\r\nimport { useLongPress } from '../../../../hooks'\r\nimport { isEmptyVariableInDefault } from '../../../../utils'\r\n\r\nimport type { SetupContext } from 'vue'\r\nimport type { CarKeyboardLang, KeyboardEmits, KeyboardProps } from '../keyboard'\r\n\r\nexport const useKeyboard = (\r\n  props: KeyboardProps,\r\n  emits: SetupContext<KeyboardEmits>['emit']\r\n) => {\r\n  // 弹出隐藏键盘\r\n  const showKeyboard = ref<boolean>(false)\r\n  watch(\r\n    () => props.show,\r\n    (val) => {\r\n      showKeyboard.value = val\r\n    }\r\n  )\r\n\r\n  // popup弹框关闭事件\r\n  const popupCloseEvent = () => {\r\n    emits('close')\r\n    emits('update:show', false)\r\n  }\r\n\r\n  // 用户输入的值\r\n  const inputValue = ref<string>(props.modelValue || '')\r\n  watch(\r\n    () => props.modelValue,\r\n    (val) => (inputValue.value = val)\r\n  )\r\n\r\n  // 键盘点击事件\r\n  const keyboardClickEvent = (value: string, disabled: boolean) => {\r\n    if (disabled) return\r\n    if (props.vibrate) {\r\n      uni.vibrateShort()\r\n    }\r\n    let concatValue = true\r\n    if (value === 'confirm') {\r\n      popupCloseEvent()\r\n      emits('confirm')\r\n      return\r\n    } else if (value === 'cancel') {\r\n      popupCloseEvent()\r\n      return\r\n    } else {\r\n      // 处理小数的0位和小数点位置\r\n      if (props.mode === 'digit') {\r\n        // 判断当前点击的value是是否位.\r\n        if (value === '.') {\r\n          // 判断modelValue中是否已经存在.，如果存在，则直接return\r\n          if (inputValue.value.includes('.')) {\r\n            return\r\n          }\r\n          // 当小数点在第一位时，前面自动补0\r\n          if (inputValue.value === '') {\r\n            inputValue.value = '0.'\r\n            concatValue = false\r\n          }\r\n        }\r\n        // 判断当前点击的value是否为0\r\n        if (value === '0') {\r\n          // 判断第一位是否为0，如果是，直接return\r\n          if (inputValue.value === '0') {\r\n            return\r\n          }\r\n        }\r\n        // 如果第一位为0，第二位不为.，则将第一位替换为当前点击的value\r\n        if (inputValue.value === '0' && value !== '.') {\r\n          inputValue.value = value\r\n          concatValue = false\r\n        }\r\n      }\r\n      if (\r\n        props.mode === 'idcard' &&\r\n        value === 'X' &&\r\n        inputValue.value.includes('X')\r\n      ) {\r\n        return\r\n      }\r\n      if (concatValue) {\r\n        inputValue.value += value\r\n      }\r\n    }\r\n\r\n    emits('update:modelValue', inputValue.value)\r\n    nextTick(() => {\r\n      emits('change', inputValue.value)\r\n    })\r\n  }\r\n\r\n  // 单独处理删除事件\r\n  const backspaceEvent = () => {\r\n    if (inputValue.value === '') {\r\n      clearBackspaceLongPressEvent()\r\n      return\r\n    }\r\n    if (props.vibrate) {\r\n      uni.vibrateShort()\r\n    }\r\n    inputValue.value = inputValue.value.slice(0, -1)\r\n\r\n    emits('backspace')\r\n    emits('update:modelValue', inputValue.value)\r\n    nextTick(() => {\r\n      emits('change', inputValue.value)\r\n    })\r\n  }\r\n\r\n  const {\r\n    handleLongPressEvent: handleBackspaceEvent,\r\n    clearLongPressTimer: clearBackspaceLongPressEvent,\r\n  } = useLongPress(backspaceEvent, toRef(props, 'longPressDelete'))\r\n\r\n  // 车牌键盘中英文切换\r\n  const carKeyboardLang = ref<CarKeyboardLang>(\r\n    isEmptyVariableInDefault(props.carLang, 'cn')\r\n  )\r\n  let updateCarLangInner = false\r\n  watch(\r\n    () => props.carLang,\r\n    (val) => {\r\n      if (updateCarLangInner) {\r\n        updateCarLangInner = false\r\n        return\r\n      }\r\n      carKeyboardLang.value = val\r\n    }\r\n  )\r\n\r\n  const carKeyboardSwitchLang = () => {\r\n    if (carKeyboardLang.value === 'cn') {\r\n      carKeyboardLang.value = 'en'\r\n    } else {\r\n      carKeyboardLang.value = 'cn'\r\n    }\r\n\r\n    updateCarLangInner = true\r\n    emits('update:carLangMode', carKeyboardLang.value)\r\n  }\r\n\r\n  return {\r\n    showKeyboard,\r\n    carKeyboardLang,\r\n    popupCloseEvent,\r\n    keyboardClickEvent,\r\n    handleBackspaceEvent,\r\n    clearBackspaceLongPressEvent,\r\n    carKeyboardSwitchLang,\r\n  }\r\n}\r\n"],"names":["ref","watch","uni","nextTick","useLongPress","toRef","isEmptyVariableInDefault"],"mappings":";;;;;;AAOa,MAAA,cAAc,CACzB,OACA,UAA0C;AAG1C,QAAM,eAAeA,kBAAa,KAAK;AACvCC,gBAAK,MACH,MAAM;AAAA,WAAA,MAAM;AAAA,EAAN,GACN,CAAC,QAAG;AACF,iBAAa,QAAQ;AAAA,EACvB,CAAC;AAIH,QAAM,kBAAkB,MAAA;AACtB,UAAM,OAAO;AACb,UAAM,eAAe,KAAK;AAAA,EAC5B;AAGA,QAAM,aAAaD,cAAG,IAAS,MAAM,cAAc,EAAE;AACrDC,gBAAAA,MACE;AAAM,WAAA,MAAM;AAAA,EAAU,GACtB,CAAC;AAAQ,WAAC,WAAW,QAAQ;AAAA,EAAI,CAAA;AAInC,QAAM,qBAAqB,CAAC,OAAe,aAAiB;AAC1D,QAAI;AAAU;AACd,QAAI,MAAM,SAAS;AACjBC,oBAAG,MAAC,aAAY;AAAA,IACjB;AACD,QAAI,cAAc;AAClB,QAAI,UAAU,WAAW;AACvB;AACA,YAAM,SAAS;AACf;AAAA,IACD,WAAU,UAAU,UAAU;AAC7B;AACA;AAAA,IACD,OAAM;AAEL,UAAI,MAAM,SAAS,SAAS;AAE1B,YAAI,UAAU,KAAK;AAEjB,cAAI,WAAW,MAAM,SAAS,GAAG,GAAG;AAClC;AAAA,UACD;AAED,cAAI,WAAW,UAAU,IAAI;AAC3B,uBAAW,QAAQ;AACnB,0BAAc;AAAA,UACf;AAAA,QACF;AAED,YAAI,UAAU,KAAK;AAEjB,cAAI,WAAW,UAAU,KAAK;AAC5B;AAAA,UACD;AAAA,QACF;AAED,YAAI,WAAW,UAAU,OAAO,UAAU,KAAK;AAC7C,qBAAW,QAAQ;AACnB,wBAAc;AAAA,QACf;AAAA,MACF;AACD,UACE,MAAM,SAAS,YACf,UAAU,OACV,WAAW,MAAM,SAAS,GAAG,GAC7B;AACA;AAAA,MACD;AACD,UAAI,aAAa;AACf,mBAAW,SAAS;AAAA,MACrB;AAAA,IACF;AAED,UAAM,qBAAqB,WAAW,KAAK;AAC3CC,kBAAAA,WAAS,MAAA;AACP,YAAM,UAAU,WAAW,KAAK;AAAA,IAClC,CAAC;AAAA,EACH;AAGA,QAAM,iBAAiB,MAAA;AACrB,QAAI,WAAW,UAAU,IAAI;AAC3B;AACA;AAAA,IACD;AACD,QAAI,MAAM,SAAS;AACjBD,oBAAG,MAAC,aAAY;AAAA,IACjB;AACD,eAAW,QAAQ,WAAW,MAAM,MAAM,GAAG,EAAE;AAE/C,UAAM,WAAW;AACjB,UAAM,qBAAqB,WAAW,KAAK;AAC3CC,kBAAAA,WAAS,MAAA;AACP,YAAM,UAAU,WAAW,KAAK;AAAA,IAClC,CAAC;AAAA,EACH;AAEM,QAAA,KAGFC,kDAAY,aAAC,gBAAgBC,cAAK,MAAC,OAAO,iBAAiB,CAAC,GAFxC,gDACD;AAIvB,QAAM,kBAAkBL,cAAAA,IACtBM,uCAAwB,yBAAC,MAAM,SAAS,IAAI,CAAC;AAE/C,MAAI,qBAAqB;AACzBL,gBAAK,MACH,MAAM;AAAA,WAAA,MAAM;AAAA,EAAN,GACN,CAAC,QAAG;AACF,QAAI,oBAAoB;AACtB,2BAAqB;AACrB;AAAA,IACD;AACD,oBAAgB,QAAQ;AAAA,EAC1B,CAAC;AAGH,QAAM,wBAAwB,MAAA;AAC5B,QAAI,gBAAgB,UAAU,MAAM;AAClC,sBAAgB,QAAQ;AAAA,IACzB,OAAM;AACL,sBAAgB,QAAQ;AAAA,IACzB;AAED,yBAAqB;AACrB,UAAM,sBAAsB,gBAAgB,KAAK;AAAA,EACnD;AAEA,SAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA;AAEJ;;"}