{"code":"import { __awaiter } from \"tslib\";\nimport { computed, getCurrentInstance, inject, nextTick, onMounted, ref, watch, } from 'vue';\nimport { noticeBarKey } from '../../../../tokens';\nimport { useSelectorQuery } from '../../../../hooks';\nimport { debugWarn, generateId, isEmptyVariableInDefault, } from '../../../../utils';\nexport const useRowNoticeBar = () => {\n    const instance = getCurrentInstance();\n    const noticeBar = inject(noticeBarKey, null);\n    const getSelectorNodeInfo = useSelectorQuery(instance).getSelectorNodeInfo;\n    const componentId = `trnb-${generateId()}`;\n    const componentTextId = `${componentId}-text`;\n    // 需要显示的数据\n    const data = computed(() => {\n        var _a;\n        if (!((_a = noticeBar === null || noticeBar === void 0 ? void 0 : noticeBar.data) === null || _a === void 0 ? void 0 : _a.length))\n            return '';\n        return noticeBar.data.join(' ');\n    });\n    // 每秒显示的像素数\n    const speed = computed(() => {\n        return isEmptyVariableInDefault(noticeBar === null || noticeBar === void 0 ? void 0 : noticeBar.speed, 80);\n    });\n    // 动画参数\n    let animationDuration = 0;\n    let animation = null;\n    const animationData = ref(null);\n    let animationLoopTimer = null;\n    // 创建动画\n    const createAnimation = () => {\n        animation = uni.createAnimation({\n            duration: animationDuration,\n            timingFunction: 'linear',\n        });\n        animation\n            .translateX(-(contentWidth + contentTextWidth) + Number(Math.random() * 10))\n            .step({\n            duration: animationDuration,\n        });\n        animation.translateX(0).step({\n            duration: 0,\n        });\n        animationData.value = animation.export();\n    };\n    // 创建循环动画\n    const createLoopAnimation = () => {\n        createAnimation();\n        animationLoopTimer = setInterval(() => {\n            createAnimation();\n        }, animationDuration + 80);\n    };\n    // 停止动画\n    const stopAnimation = () => {\n        animation = null;\n        animationData.value = null;\n        if (animationLoopTimer) {\n            clearInterval(animationLoopTimer);\n            animationLoopTimer = null;\n        }\n    };\n    watch(() => { return noticeBar === null || noticeBar === void 0 ? void 0 : noticeBar.play; }, (newVal) => {\n        if (newVal) {\n            createLoopAnimation();\n        }\n        else {\n            stopAnimation();\n        }\n    });\n    let initCount = 0;\n    // 获取内容区域容器信息\n    let contentWidth = 0;\n    let contentTextWidth = 0;\n    const getContentRectInfo = () => { return __awaiter(void 0, void 0, void 0, function* () {\n        try {\n            const contentRectInfo = yield getSelectorNodeInfo(`#${componentId}`);\n            const contentTextRectInfo = yield getSelectorNodeInfo(`#${componentTextId}`);\n            initCount = 0;\n            // 根据 t=s/v(时间=路程/速度)\n            contentWidth = contentRectInfo.width || 0;\n            contentTextWidth = contentTextRectInfo.width || 0;\n            animationDuration =\n                ((contentWidth + contentTextWidth) / speed.value) * 1000;\n            if ((noticeBar === null || noticeBar === void 0 ? void 0 : noticeBar.play) && (noticeBar === null || noticeBar === void 0 ? void 0 : noticeBar.autoPlay)) {\n                setTimeout(() => {\n                    createLoopAnimation();\n                }, 50);\n            }\n        }\n        catch (err) {\n            if (initCount > 10) {\n                initCount = 0;\n                debugWarn('TnNoticeBar', `获取通知栏容器信息失败: ${err}`);\n                return;\n            }\n            initCount++;\n            setTimeout(() => {\n                getContentRectInfo();\n            }, 150);\n        }\n    }); };\n    // 如果修改了speed重新初始化\n    watch(() => { return noticeBar === null || noticeBar === void 0 ? void 0 : noticeBar.speed; }, () => {\n        stopAnimation();\n        getContentRectInfo();\n    });\n    // 通知点击事件\n    const noticeClickEvent = () => {\n        noticeBar === null || noticeBar === void 0 ? void 0 : noticeBar.click(0);\n    };\n    onMounted(() => {\n        nextTick(() => {\n            getContentRectInfo();\n        });\n    });\n    return {\n        componentId,\n        componentTextId,\n        data,\n        animationData,\n        noticeClickEvent,\n    };\n};\n//# sourceMappingURL=D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/notice-bar/src/composables/use-row-notice-bar.js.map","references":["D:/DEV/HBuilderX/plugins/uniapp-cli-vite/node_modules/@vue/runtime-core/dist/runtime-core.d.ts","D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/tokens/index.ts","D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/hooks/index.ts","D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/utils/index.ts"],"uniExtApis":[],"map":"{\"version\":3,\"file\":\"use-row-notice-bar.js\",\"sourceRoot\":\"\",\"sources\":[\"use-row-notice-bar.ts\"],\"names\":[],\"mappings\":\"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\"}"}
