{"code":"import { nextTick, ref, watch } from 'vue';\nimport regionJsonData from '../../libs/region-data.json';\nimport { CHANGE_EVENT, UPDATE_MODEL_EVENT } from '../../../../constants';\nimport { cloneDeep } from '../../../../utils';\nexport const useRegionPicker = (porps, emits) => {\n    // 列表数据\n    const pickerSelectData = regionJsonData;\n    // 显示/隐藏地址选择器\n    const showPicker = ref(false);\n    watch(() => { return porps.open; }, (val) => {\n        showPicker.value = val;\n    });\n    const _closePicker = () => {\n        emits('update:open', false);\n    };\n    // picker关闭事件\n    const handlePickerCloseEvent = () => {\n        _closePicker();\n        emits('close');\n    };\n    // 当前选中的值\n    const currentSelectValue = ref([]);\n    // 标记当前传递的值的类型\n    let userRegionValueMode = 'code';\n    // 根据name获取code\n    const getCodeByNames = (names) => {\n        const code = [];\n        let data = regionJsonData;\n        do {\n            const name = names.shift();\n            const regionItem = data.find((item) => { return item.name === name; }) || data[0];\n            if (regionItem) {\n                code.push(regionItem.code);\n            }\n            data = (regionItem === null || regionItem === void 0 ? void 0 : regionItem.children) || [];\n        } while (data.length);\n        return code;\n    };\n    // 根据code获取name\n    const getNameByCodes = (codes) => {\n        const name = [];\n        let data = regionJsonData;\n        do {\n            const code = codes.shift();\n            const regionItem = data.find((item) => { return item.code === code; }) || data[0];\n            if (regionItem) {\n                name.push(regionItem.name);\n            }\n            data = (regionItem === null || regionItem === void 0 ? void 0 : regionItem.children) || [];\n        } while (data.length);\n        return name;\n    };\n    /**\n     * 填充code\n     * @example 传递的是['44', '4401'] 返回 ['44', '4401', '440113']\n     */\n    const fillCode = (codes) => {\n        const result = [];\n        let data = regionJsonData;\n        do {\n            const code = codes.shift();\n            const regionItem = data.find((item) => { return item.code === code; }) || data[0];\n            if (regionItem) {\n                result.push(regionItem.code);\n            }\n            data = (regionItem === null || regionItem === void 0 ? void 0 : regionItem.children) || [];\n        } while (data.length);\n        return result;\n    };\n    // 标记是否内部更新\n    let isInnerUpdate = false;\n    watch(() => { return porps.modelValue; }, (val) => {\n        if (isInnerUpdate) {\n            isInnerUpdate = false;\n            return;\n        }\n        const chineseReg = /^[\\u4E00-\\u9FA5]+$/; // 中文正则\n        const codeReg = /^\\d{2,6}$/; // 地区编码正则\n        if (val.length) {\n            const value = cloneDeep(val);\n            if (chineseReg.test(value[0])) {\n                userRegionValueMode = 'name';\n                currentSelectValue.value = getCodeByNames(value);\n                isInnerUpdate = true;\n                emits(UPDATE_MODEL_EVENT, getNameByCodes(cloneDeep(currentSelectValue.value)));\n            }\n            else if (codeReg.test(value[0])) {\n                userRegionValueMode = 'code';\n                currentSelectValue.value = fillCode(value);\n                isInnerUpdate = true;\n                emits(UPDATE_MODEL_EVENT, currentSelectValue.value);\n            }\n        }\n    }, {\n        immediate: true,\n    });\n    // picker发生改变回调\n    const handlePickerChangeEvent = (value, index, item) => {\n        if (userRegionValueMode === 'name') {\n            value = getNameByCodes(value);\n        }\n        isInnerUpdate = true;\n        emits(CHANGE_EVENT, value, item);\n    };\n    // picker确认事件\n    const handlePickerConfirmEvent = (value, item) => {\n        currentSelectValue.value = cloneDeep(value);\n        if (userRegionValueMode === 'name') {\n            value = getNameByCodes(value);\n        }\n        emits(UPDATE_MODEL_EVENT, value);\n        nextTick(() => {\n            emits('confirm', value, item);\n        });\n        _closePicker();\n    };\n    // picker取消事件\n    const handlePickerCancelEvent = () => {\n        _closePicker();\n        emits('cancel');\n    };\n    return {\n        pickerSelectData,\n        showPicker,\n        currentSelectValue,\n        handlePickerCloseEvent,\n        handlePickerChangeEvent,\n        handlePickerConfirmEvent,\n        handlePickerCancelEvent,\n    };\n};\n//# sourceMappingURL=D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/region-picker/src/composables/use-region-picker.js.map","references":["D:/Development/HBuilderX/plugins/uniapp-cli-vite/node_modules/@vue/runtime-core/dist/runtime-core.d.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/region-picker/libs/region-data.json.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/constants/index.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/utils/index.ts","D:/Development/HBuilderX/plugins/uniapp-cli-vite/node_modules/@vue/runtime-core/dist/runtime-core.d.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/region-picker/libs/index.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/region-picker/src/region-picker.ts"],"uniExtApis":[],"map":"{\"version\":3,\"file\":\"use-region-picker.js\",\"sourceRoot\":\"\",\"sources\":[\"use-region-picker.ts\"],\"names\":[],\"mappings\":\"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\"}"}
