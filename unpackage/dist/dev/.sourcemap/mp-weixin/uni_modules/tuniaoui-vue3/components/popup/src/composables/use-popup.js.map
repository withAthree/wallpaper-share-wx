{"version":3,"file":"use-popup.js","sources":["uni_modules/tuniaoui-vue3/components/popup/src/composables/use-popup.ts"],"sourcesContent":["import { computed, getCurrentInstance, ref, watch } from 'vue'\nimport { UPDATE_MODEL_EVENT } from '../../../../constants'\n\nimport type { PopupProps } from '../popup'\n\nexport const usePopup = (props: PopupProps) => {\n  const { emit } = getCurrentInstance()!\n  const iosDevice = computed<boolean>(() => {\n    const systemInfo = uni.getSystemInfoSync()\n    return systemInfo.osName === 'ios' || systemInfo.osName === 'macos'\n  })\n\n  // 是否显示遮罩层\n  const showOverlay = ref(false)\n  // 是否显示弹框\n  const showPopup = ref(false)\n  const visiblePopup = ref(false)\n  let initPopupModelValue = false\n  watch(\n    () => props.modelValue,\n    (value) => {\n      if (value) {\n        visiblePopup.value = true\n        if (iosDevice.value) {\n          setTimeout(() => {\n            showPopup.value = true\n            if (props.overlay) showOverlay.value = true\n            initPopupModelValue && emit('open')\n          }, 0)\n        } else {\n          showPopup.value = true\n          if (props.overlay) showOverlay.value = true\n          initPopupModelValue && emit('open')\n        }\n      } else {\n        showPopup.value = false\n        showOverlay.value = false\n        setTimeout(() => {\n          visiblePopup.value = false\n        }, 250)\n        initPopupModelValue && emit('close')\n      }\n      initPopupModelValue = true\n    },\n    {\n      immediate: true,\n    }\n  )\n\n  // 更新模态框的状态\n  const updateModelValue = (value: boolean) => {\n    emit(UPDATE_MODEL_EVENT, value)\n  }\n\n  // 点击关闭按钮\n  const onClickCloseBtn = () => {\n    updateModelValue(false)\n    emit('close')\n  }\n\n  // 点击遮罩层关闭模态框\n  const onClickOverlay = () => {\n    if (props.overlayCloseable) {\n      updateModelValue(false)\n      emit('close')\n      emit('overlay-click')\n    }\n  }\n\n  return {\n    iosDevice,\n    showOverlay,\n    showPopup,\n    visiblePopup,\n    updateModelValue,\n    onClickCloseBtn,\n    onClickOverlay,\n  }\n}\n"],"names":["getCurrentInstance","computed","uni","ref","watch","UPDATE_MODEL_EVENT"],"mappings":";;;AAKO,MAAM,WAAW,CAAC,UAAiB;AAChC,QAAA,OAASA,iCAAqB;AACtC,QAAM,YAAYC,cAAAA,SAAkB,MAAA;AAClC,UAAM,aAAaC,oBAAI;AACvB,WAAO,WAAW,WAAW,SAAS,WAAW,WAAW;AAAA,EAC9D,CAAC;AAGD,QAAM,cAAcC,kBAAI,KAAK;AAE7B,QAAM,YAAYA,kBAAI,KAAK;AAC3B,QAAM,eAAeA,kBAAI,KAAK;AAC9B,MAAI,sBAAsB;AAC1BC,gBAAK,MACH,MAAM;AAAA,WAAA,MAAM;AAAA,EAAN,GACN,CAAC,UAAK;AACJ,QAAI,OAAO;AACT,mBAAa,QAAQ;AACrB,UAAI,UAAU,OAAO;AACnB,mBAAW,MAAA;AACT,oBAAU,QAAQ;AAClB,cAAI,MAAM;AAAS,wBAAY,QAAQ;AACvC,iCAAuB,KAAK,MAAM;AAAA,QACnC,GAAE,CAAC;AAAA,MACL,OAAM;AACL,kBAAU,QAAQ;AAClB,YAAI,MAAM;AAAS,sBAAY,QAAQ;AACvC,+BAAuB,KAAK,MAAM;AAAA,MACnC;AAAA,IACF,OAAM;AACL,gBAAU,QAAQ;AAClB,kBAAY,QAAQ;AACpB,iBAAW,MAAA;AACT,qBAAa,QAAQ;AAAA,MACtB,GAAE,GAAG;AACN,6BAAuB,KAAK,OAAO;AAAA,IACpC;AACD,0BAAsB;AAAA,EACxB,GACA;AAAA,IACE,WAAW;AAAA,EACZ,CAAA;AAIH,QAAM,mBAAmB,CAAC,UAAc;AACtC,SAAKC,yCAAAA,oBAAoB,KAAK;AAAA,EAChC;AAGA,QAAM,kBAAkB,MAAA;AACtB,qBAAiB,KAAK;AACtB,SAAK,OAAO;AAAA,EACd;AAGA,QAAM,iBAAiB,MAAA;AACrB,QAAI,MAAM,kBAAkB;AAC1B,uBAAiB,KAAK;AACtB,WAAK,OAAO;AACZ,WAAK,eAAe;AAAA,IACrB;AAAA,EACH;AAEA,SAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA;AAEJ;;"}