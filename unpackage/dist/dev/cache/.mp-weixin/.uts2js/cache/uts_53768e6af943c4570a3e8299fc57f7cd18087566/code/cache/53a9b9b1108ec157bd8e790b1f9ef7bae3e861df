{"code":"import { __awaiter } from \"tslib\";\nimport { getCurrentInstance, nextTick, provide, reactive, ref, toRefs, watch, } from 'vue';\nimport { tabbarContextKey } from '../../../../tokens';\nimport { CHANGE_EVENT, UPDATE_MODEL_EVENT } from '../../../../constants';\nimport { useOrderedChildren, useSelectorQuery } from '../../../../hooks';\nimport { debugWarn, generateId, isBoolean, isPromise } from '../../../../utils';\nexport const useTabbar = (props) => {\n    const emit = getCurrentInstance().emit;\n    const _a = useOrderedChildren(), items = _a.children, addChild = _a.addChild, removeItem = _a.removeChild;\n    const getSelectorNodeInfo = useSelectorQuery().getSelectorNodeInfo;\n    const rectId = `tt-${generateId()}`;\n    const activeUid = ref(-1);\n    // 添加Item\n    const addItem = (item) => {\n        if (props.modelValue !== undefined && activeUid.value === -1) {\n            if (props.modelValue === item.name ||\n                props.modelValue === items.value.length) {\n                nextTick(() => {\n                    updateActiveId(item.uid);\n                    setTimeout(() => {\n                        if (activeUid.value !== -1)\n                            return;\n                        activeUid.value = item.uid;\n                    }, 50);\n                });\n            }\n        }\n        addChild(item);\n    };\n    // 更新当前激活的Uid\n    const updateActiveId = (uid, changeEmit = false) => {\n        var _a;\n        activeUid.value = uid;\n        const itemIndex = items.value.findIndex((item) => { return item.uid === uid; });\n        const value = ((_a = items.value[itemIndex]) === null || _a === void 0 ? void 0 : _a.name) || itemIndex;\n        emit(UPDATE_MODEL_EVENT, value);\n        if (changeEmit) {\n            nextTick(() => {\n                emit(CHANGE_EVENT, value);\n            });\n        }\n    };\n    // 设置当前被点击Item\n    const setActiveItem = (uid) => {\n        // 是否有切换拦截\n        if (!props.beforeSwitch) {\n            updateActiveId(uid, true);\n            return;\n        }\n        const index = items.value.findIndex((item) => { return item.uid === uid; });\n        const shouldSwitch = props.beforeSwitch(index);\n        const isPromiseOrBoolean = [\n            isPromise(shouldSwitch),\n            isBoolean(shouldSwitch),\n        ].includes(true);\n        if (!isPromiseOrBoolean) {\n            debugWarn('TnTabbar', 'beforeSwitch切换前拦截函数必须返回Promise或者Boolean');\n            return;\n        }\n        if (isPromise(shouldSwitch)) {\n            shouldSwitch.then((res) => {\n                if (res)\n                    updateActiveId(uid, true);\n            });\n        }\n        else {\n            if (shouldSwitch)\n                updateActiveId(uid, true);\n        }\n    };\n    // 根据modelValue设置当前激活的Item\n    const setActiveItemByValue = (value) => {\n        var _a;\n        if (value === undefined) {\n            // 如果没有传递任何值则设置第一个Item为激活状态\n            updateActiveId(items.value[0].uid);\n            return;\n        }\n        let item;\n        // 如果类型是number，则先通过索引进行查找\n        if (typeof value === 'number') {\n            item = (_a = items.value) === null || _a === void 0 ? void 0 : _a[value];\n        }\n        // 如果没有找到，则通过name查找\n        if (!item) {\n            item = items.value.find((item) => { return item.name === value; });\n        }\n        if (!item) {\n            // 设置第一个Item为激活状态\n            updateActiveId(items.value[0].uid);\n        }\n        else {\n            updateActiveId(item.uid);\n        }\n    };\n    watch(() => { return props.modelValue; }, (val) => {\n        nextTick(() => {\n            setActiveItemByValue(val);\n        });\n    });\n    // 凸起按钮节点信息\n    const bulgeRectInfo = ref({\n        width: 0,\n        height: 0,\n        left: 0,\n    });\n    // 是否设置凸起按钮\n    const hasBulgeButton = ref(false);\n    // 设置凸起按钮的位置\n    const setBulgeCircle = (itemRectInfo) => { return __awaiter(void 0, void 0, void 0, function* () {\n        const left = itemRectInfo.left;\n        try {\n            const rectInfo = yield getSelectorNodeInfo(`#${rectId}`);\n            const tabbarRectLeft = rectInfo.left;\n            let width = itemRectInfo.width;\n            if (itemRectInfo === null || itemRectInfo === void 0 ? void 0 : itemRectInfo.maxWidth) {\n                width = itemRectInfo.maxWidth;\n            }\n            bulgeRectInfo.value.width = width * 0.75;\n            bulgeRectInfo.value.height = bulgeRectInfo.value.width;\n            bulgeRectInfo.value.left =\n                left - (tabbarRectLeft || 0) + itemRectInfo.width / 2;\n            hasBulgeButton.value = true;\n        }\n        catch (err) {\n            debugWarn('TnTabbar', `获取Tabbar节点信息失败: ${err}`);\n        }\n    }); };\n    // provide\n    provide(tabbarContextKey, reactive(Object.assign(Object.assign({}, toRefs(props)), { items,\n        activeUid,\n        addItem,\n        removeItem,\n        setActiveItem,\n        setBulgeCircle })));\n    return {\n        rectId,\n        hasBulgeButton,\n        bulgeRectInfo,\n        setActiveItem,\n        setActiveItemByValue,\n    };\n};\n//# sourceMappingURL=D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/tabbar/src/composables/use-tabbar.js.map","references":["D:/DEV/HBuilderX/plugins/uniapp-cli-vite/node_modules/@vue/runtime-core/dist/runtime-core.d.ts","D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/tokens/index.ts","D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/constants/index.ts","D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/hooks/index.ts","D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/utils/index.ts","D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/tokens/index.ts","D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/tabbar/src/tabbar.ts","D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/tabbar/src/types.ts"],"uniExtApis":[],"map":"{\"version\":3,\"file\":\"use-tabbar.js\",\"sourceRoot\":\"\",\"sources\":[\"use-tabbar.ts\"],\"names\":[],\"mappings\":\";AAAA,OAAO,EACL,kBAAkB,EAClB,QAAQ,EACR,OAAO,EACP,QAAQ,EACR,GAAG,EACH,MAAM,EACN,KAAK,GACN,MAAM,KAAK,CAAA;AACZ,OAAO,EAAE,gBAAgB,EAAE,MAAM,oBAAoB,CAAA;AACrD,OAAO,EAAE,YAAY,EAAE,kBAAkB,EAAE,MAAM,uBAAuB,CAAA;AACxE,OAAO,EAAE,kBAAkB,EAAE,gBAAgB,EAAE,MAAM,mBAAmB,CAAA;AACxE,OAAO,EAAE,SAAS,EAAE,UAAU,EAAE,SAAS,EAAE,SAAS,EAAE,MAAM,mBAAmB,CAAA;AAM/E,MAAM,CAAC,MAAM,SAAS,GAAG,CAAC,KAAkB;IAClC,MAAA,IAAI,GAAK,kBAAkB,EAAG,KAA1B,CAA0B;IAChC,MAAA,KAIF,kBAAkB,EAAqB,EAH/B,KAAK,cAAA,EACf,QAAQ,cAAA,EACK,UAAU,iBACkB,CAAA;IAEnC,MAAA,mBAAmB,GAAK,gBAAgB,EAAE,oBAAvB,CAAuB;IAElD,MAAM,MAAM,GAAG,MAAM,UAAU,EAAE,EAAE,CAAA;IAEnC,MAAM,SAAS,GAAG,GAAG,CAAS,CAAC,CAAC,CAAC,CAAA;IAEjC,SAAS;IACT,MAAM,OAAO,GAAG,CAAC,IAAuB;QACtC,IAAI,KAAK,CAAC,UAAU,KAAK,SAAS,IAAI,SAAS,CAAC,KAAK,KAAK,CAAC,CAAC,EAAE;YAC5D,IACE,KAAK,CAAC,UAAU,KAAK,IAAI,CAAC,IAAI;gBAC9B,KAAK,CAAC,UAAU,KAAK,KAAK,CAAC,KAAK,CAAC,MAAM,EACvC;gBACA,QAAQ,CAAC;oBACP,cAAc,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;oBACxB,UAAU,CAAC;wBACT,IAAI,SAAS,CAAC,KAAK,KAAK,CAAC,CAAC;4BAAE,OAAM;wBAClC,SAAS,CAAC,KAAK,GAAG,IAAI,CAAC,GAAG,CAAA;oBAC5B,CAAC,EAAE,EAAE,CAAC,CAAA;gBACR,CAAC,CAAC,CAAA;aACH;SACF;QACD,QAAQ,CAAC,IAAI,CAAC,CAAA;IAChB,CAAC,CAAA;IAED,aAAa;IACb,MAAM,cAAc,GAAG,CAAC,GAAW,EAAE,UAAU,GAAG,KAAK;;QACrD,SAAS,CAAC,KAAK,GAAG,GAAG,CAAA;QACrB,MAAM,SAAS,GAAG,KAAK,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,IAAI,OAAK,OAAA,IAAI,CAAC,GAAG,KAAK,GAAG,EAAhB,CAAgB,CAAC,CAAA;QAEnE,MAAM,KAAK,GAAG,CAAA,MAAA,KAAK,CAAC,KAAK,CAAC,SAAS,CAAC,0CAAE,IAAI,KAAI,SAAS,CAAA;QAEvD,IAAI,CAAC,kBAAkB,EAAE,KAAK,CAAC,CAAA;QAC/B,IAAI,UAAU,EAAE;YACd,QAAQ,CAAC;gBACP,IAAI,CAAC,YAAY,EAAE,KAAK,CAAC,CAAA;YAC3B,CAAC,CAAC,CAAA;SACH;IACH,CAAC,CAAA;IAED,cAAc;IACd,MAAM,aAAa,GAAG,CAAC,GAAW;QAChC,UAAU;QACV,IAAI,CAAC,KAAK,CAAC,YAAY,EAAE;YACvB,cAAc,CAAC,GAAG,EAAE,IAAI,CAAC,CAAA;YACzB,OAAM;SACP;QAED,MAAM,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,IAAI,OAAK,OAAA,IAAI,CAAC,GAAG,KAAK,GAAG,EAAhB,CAAgB,CAAC,CAAA;QAC/D,MAAM,YAAY,GAAG,KAAK,CAAC,YAAY,CAAC,KAAK,CAAC,CAAA;QAC9C,MAAM,kBAAkB,GAAG;YACzB,SAAS,CAAC,YAAY,CAAC;YACvB,SAAS,CAAC,YAAY,CAAC;SACxB,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAA;QAEhB,IAAI,CAAC,kBAAkB,EAAE;YACvB,SAAS,CACP,UAAU,EACV,yCAAyC,CAC1C,CAAA;YACD,OAAM;SACP;QAED,IAAI,SAAS,CAAC,YAAY,CAAC,EAAE;YAC3B,YAAY,CAAC,IAAI,CAAC,CAAC,GAAG;gBACpB,IAAI,GAAG;oBAAE,cAAc,CAAC,GAAG,EAAE,IAAI,CAAC,CAAA;YACpC,CAAC,CAAC,CAAA;SACH;aAAM;YACL,IAAI,YAAY;gBAAE,cAAc,CAAC,GAAG,EAAE,IAAI,CAAC,CAAA;SAC5C;IACH,CAAC,CAAA;IAED,0BAA0B;IAC1B,MAAM,oBAAoB,GAAG,CAAC,KAAuB;;QACnD,IAAI,KAAK,KAAK,SAAS,EAAE;YACvB,2BAA2B;YAC3B,cAAc,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAA;YAClC,OAAM;SACP;QACD,IAAI,IAAmC,CAAA;QACvC,yBAAyB;QACzB,IAAI,OAAO,KAAK,KAAK,QAAQ,EAAE;YAC7B,IAAI,GAAG,MAAA,KAAK,CAAC,KAAK,0CAAG,KAAK,CAAC,CAAA;SAC5B;QACD,mBAAmB;QACnB,IAAI,CAAC,IAAI,EAAE;YACT,IAAI,GAAG,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,IAAI,OAAK,OAAA,IAAI,CAAC,IAAI,KAAK,KAAK,EAAnB,CAAmB,CAAC,CAAA;SACvD;QACD,IAAI,CAAC,IAAI,EAAE;YACT,iBAAiB;YACjB,cAAc,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAA;SACnC;aAAM;YACL,cAAc,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;SACzB;IACH,CAAC,CAAA;IAED,KAAK,CACH,QAAM,OAAA,KAAK,CAAC,UAAU,EAAhB,CAAgB,EACtB,CAAC,GAAG;QACF,QAAQ,CAAC;YACP,oBAAoB,CAAC,GAAG,CAAC,CAAA;QAC3B,CAAC,CAAC,CAAA;IACJ,CAAC,CACF,CAAA;IAED,WAAW;IACX,MAAM,aAAa,GAAG,GAAG,CAAiB;QACxC,KAAK,EAAE,CAAC;QACR,MAAM,EAAE,CAAC;QACT,IAAI,EAAE,CAAC;KACR,CAAC,CAAA;IACF,WAAW;IACX,MAAM,cAAc,GAAG,GAAG,CAAU,KAAK,CAAC,CAAA;IAC1C,YAAY;IACZ,MAAM,cAAc,GAAG,CAAO,YAA4B;QAChD,MAAA,IAAI,GAAK,YAAY,KAAjB,CAAiB;QAC7B,IAAI;YACF,MAAM,QAAQ,GAAG,MAAM,mBAAmB,CAAC,IAAI,MAAM,EAAE,CAAC,CAAA;YAEhD,MAAM,cAAc,GAAK,QAAQ,KAAb,CAAa;YACzC,IAAI,KAAK,GAAG,YAAY,CAAC,KAAK,CAAA;YAC9B,IAAI,YAAY,aAAZ,YAAY,uBAAZ,YAAY,CAAE,QAAQ,EAAE;gBAC1B,KAAK,GAAG,YAAY,CAAC,QAAQ,CAAA;aAC9B;YACD,aAAa,CAAC,KAAK,CAAC,KAAK,GAAG,KAAK,GAAG,IAAI,CAAA;YACxC,aAAa,CAAC,KAAK,CAAC,MAAM,GAAG,aAAa,CAAC,KAAK,CAAC,KAAK,CAAA;YACtD,aAAa,CAAC,KAAK,CAAC,IAAI;gBACtB,IAAI,GAAG,CAAC,cAAc,IAAI,CAAC,CAAC,GAAG,YAAY,CAAC,KAAK,GAAG,CAAC,CAAA;YAEvD,cAAc,CAAC,KAAK,GAAG,IAAI,CAAA;SAC5B;QAAC,OAAO,GAAG,EAAE;YACZ,SAAS,CAAC,UAAU,EAAE,mBAAmB,GAAG,EAAE,CAAC,CAAA;SAChD;IACH,CAAC,IAAA,CAAA;IAED,UAAU;IACV,OAAO,CACL,gBAAgB,EAChB,QAAQ,iCACH,MAAM,CAAC,KAAK,CAAC,KAEhB,KAAK;QACL,SAAS;QACT,OAAO;QACP,UAAU;QACV,aAAa;QACb,cAAc,IACd,CACH,CAAA;IAED,OAAO;QACL,MAAM;QACN,cAAc;QACd,aAAa;QACb,aAAa;QACb,oBAAoB;KACrB,CAAA;AACH,CAAC,CAAA\"}"}
