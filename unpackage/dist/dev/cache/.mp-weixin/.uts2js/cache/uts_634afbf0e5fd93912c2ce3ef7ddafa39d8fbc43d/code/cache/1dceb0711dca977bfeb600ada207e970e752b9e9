{"code":"import { __awaiter } from \"tslib\";\nimport { getCurrentInstance, nextTick, ref, watch } from 'vue';\nimport { useSelectorQuery } from '../../../../hooks';\nimport { cloneDeep, debugWarn, generateId } from '../../../../utils';\nexport const useWaterFall = (props) => {\n    const instance = getCurrentInstance();\n    if (!instance) {\n        debugWarn('TnWaterFall', '请在 setup 中使用 useWaterFall');\n    }\n    const componentId = `twf-${generateId()}`;\n    const getSelectorNodeInfo = useSelectorQuery(instance).getSelectorNodeInfo;\n    // 切割左右两边数据\n    const leftData = ref([]);\n    const rightData = ref([]);\n    // 获取左右两边容器的高度信息\n    let leftContainerHeight = 0;\n    let rightContainerHeight = 0;\n    const getContainerHeight = () => { return __awaiter(void 0, void 0, void 0, function* () {\n        try {\n            const leftContainerRectInfo = yield getSelectorNodeInfo(`#${componentId}-left`);\n            const rightContainerRectInfo = yield getSelectorNodeInfo(`#${componentId}-right`);\n            leftContainerHeight = leftContainerRectInfo.height || leftContainerHeight;\n            rightContainerHeight =\n                rightContainerRectInfo.height || rightContainerHeight;\n        }\n        catch (err) {\n            debugWarn('TnWaterFall', `获取容器高度信息失败：${err}`);\n        }\n    }); };\n    // 旧数据\n    let oldUserData = [];\n    // 分割数据\n    const splitData = (data) => { return __awaiter(void 0, void 0, void 0, function* () {\n        if (!data || !data.length)\n            return;\n        if (props.mode === 'calc') {\n            // 根据左右两边的数据高度，判断当前数据应该放在左边还是右边\n            yield getContainerHeight();\n            if (leftContainerHeight <= rightContainerHeight) {\n                leftData.value.push(data.shift());\n            }\n            else {\n                rightData.value.push(data.shift());\n            }\n            nextTick(() => {\n                setTimeout(() => {\n                    splitData(data);\n                }, 200);\n            });\n        }\n        else if (props.mode === 'normal') {\n            // 判断当前的第一个元素是放在左边还是右边\n            let firstLeft = true;\n            yield getContainerHeight();\n            if (leftData.value.length > rightData.value.length) {\n                firstLeft = false;\n            }\n            let leftSmall = false;\n            if (leftContainerHeight < rightContainerHeight) {\n                leftSmall = true;\n            }\n            // 按照顺序，左右交替放置数据\n            data.forEach((item, index) => {\n                if ((index % 2 === 0 && firstLeft) || leftSmall) {\n                    leftData.value.push(item);\n                }\n                else {\n                    rightData.value.push(item);\n                }\n                if (!firstLeft) {\n                    firstLeft = true;\n                }\n                if (leftSmall && index >= 2) {\n                    leftSmall = false;\n                }\n            });\n        }\n    }); };\n    // 重新渲染列表\n    const resetWaterFall = () => {\n        if (!props.data)\n            return;\n        leftData.value = [];\n        rightData.value = [];\n        leftContainerHeight = 0;\n        rightContainerHeight = 0;\n        nextTick(() => {\n            oldUserData = props.data;\n            splitData(props.data);\n        });\n    };\n    watch(() => { return props.data; }, (val) => {\n        if (!val)\n            return;\n        if (oldUserData.length === val.length)\n            return;\n        const newData = cloneDeep(val.slice(oldUserData.length));\n        if (!newData.length) {\n            leftData.value = [];\n            rightData.value = [];\n            leftContainerHeight = 0;\n            rightContainerHeight = 0;\n        }\n        nextTick(() => {\n            oldUserData = val;\n            splitData(newData);\n        });\n    }, {\n        immediate: true,\n    });\n    return {\n        componentId,\n        leftData,\n        rightData,\n        resetWaterFall,\n    };\n};\n//# sourceMappingURL=D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/water-fall/src/composables/use-water-fall.js.map","references":["D:/Development/HBuilderX/plugins/uniapp-cli-vite/node_modules/@vue/runtime-core/dist/runtime-core.d.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/hooks/index.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/utils/index.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/water-fall/src/water-fall.ts"],"uniExtApis":[],"map":"{\"version\":3,\"file\":\"use-water-fall.js\",\"sourceRoot\":\"\",\"sources\":[\"use-water-fall.ts\"],\"names\":[],\"mappings\":\"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\"}"}
