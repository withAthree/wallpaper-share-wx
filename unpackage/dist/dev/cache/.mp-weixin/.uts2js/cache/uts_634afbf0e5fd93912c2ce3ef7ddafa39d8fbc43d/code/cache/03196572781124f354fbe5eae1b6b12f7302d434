{"code":"import { __awaiter } from \"tslib\";\nimport { computed, getCurrentInstance, nextTick, onMounted, provide, reactive, ref, toRefs, useSlots, watch, } from 'vue';\nimport { CHANGE_EVENT, UPDATE_MODEL_EVENT } from '../../../../constants';\nimport { tabsContextKey } from '../../../../tokens';\nimport { useOrderedChildren, useSelectorQuery } from '../../../../hooks';\nimport { debugWarn, generateId, isBoolean, isPromise } from '../../../../utils';\nexport const useTabs = (props) => {\n    const instance = getCurrentInstance();\n    if (!instance) {\n        debugWarn('TnTabs', '请在 setup 函数中使用 useTabs ');\n    }\n    const emit = instance.emit;\n    const slots = useSlots();\n    const _a = useOrderedChildren(), items = _a.children, addChild = _a.addChild, removeItem = _a.removeChild;\n    const getSelectorNodeInfo = useSelectorQuery(instance).getSelectorNodeInfo;\n    const componentId = `tt-${generateId()}`;\n    const barComponentId = `${componentId}-b`;\n    // 是否需要显示bar滑块\n    const showBar = computed(() => { return props.bar || !!slots.bar; });\n    // 当前被激活的ItemUid\n    const activeUid = ref(-1);\n    // 添加tabsItem到items容器中\n    const addItem = (item) => {\n        if (props.modelValue !== undefined && activeUid.value === -1) {\n            if (props.modelValue === item.name ||\n                props.modelValue === items.value.length) {\n                nextTick(() => {\n                    updateActiveUid(item.uid);\n                });\n            }\n        }\n        addChild(item);\n    };\n    // tabs容器节点信息\n    const tabsRect = {\n        width: 0,\n        height: 0,\n        left: 0,\n    };\n    // bar滑块的容器节点信息\n    const barRect = {\n        width: 0,\n        height: 0,\n        left: 0,\n    };\n    // 滑块滑动的距离\n    const barOffsetLeft = ref(0);\n    // scrollView的滚动距离\n    const scrollLeft = ref(0);\n    // 更新偏移位置信息\n    const updateOffsetPosition = (index) => {\n        if (!props.scroll && !props.bar && !slots.bar)\n            return;\n        // 获取当前Item\n        const item = items.value[index].elementRect;\n        if (props.bar || slots.bar) {\n            // 更新滑块的偏移位置\n            barOffsetLeft.value =\n                item.left - tabsRect.left + (item.width - barRect.width) / 2;\n        }\n        if (props.scroll) {\n            // 更新scrollView的偏移位置\n            const scrollLeftValue = item.left - tabsRect.left - (tabsRect.width - item.width) / 2;\n            scrollLeft.value = scrollLeftValue < 0 ? 0 : scrollLeftValue;\n        }\n    };\n    // 更新当前激活的ItemUid\n    const updateActiveUid = (uid, changeEmit = false) => {\n        activeUid.value = uid;\n        const itemIndex = items.value.findIndex((item) => { return item.uid === uid; });\n        const value = items.value[itemIndex].name\n            ? items.value[itemIndex].name\n            : itemIndex;\n        updateOffsetPosition(itemIndex);\n        emit(UPDATE_MODEL_EVENT, value);\n        if (changeEmit) {\n            emit(CHANGE_EVENT, value);\n        }\n    };\n    // 设置当前被点击Item\n    const setActiveItem = (uid) => {\n        if (!props.beforeSwitch) {\n            updateActiveUid(uid, true);\n            return;\n        }\n        const itemIndex = items.value.findIndex((item) => { return item.uid === uid; });\n        const shouldSwitch = props.beforeSwitch(itemIndex);\n        const isPromiseOrBoolean = [\n            isPromise(shouldSwitch),\n            isBoolean(shouldSwitch),\n        ].includes(true);\n        if (!isPromiseOrBoolean) {\n            debugWarn('TnTabs', 'beforeSwitch返回值必须是Promise或者Boolean');\n            return;\n        }\n        if (isPromise(shouldSwitch)) {\n            shouldSwitch\n                .then((res) => {\n                if (res) {\n                    updateActiveUid(uid, true);\n                }\n            })\n                .catch((err) => {\n                debugWarn('TnTabs', `执行beforeSwitch出错：${err}`);\n            });\n        }\n        else {\n            if (shouldSwitch) {\n                updateActiveUid(uid, true);\n            }\n        }\n    };\n    // 通过索引更新当前激活的ActiveItem\n    const updateActiveItemByValue = (value) => {\n        var _a;\n        if (value === undefined) {\n            // 如果没有传递任何值则设置第一个Item为激活状态\n            updateActiveUid(items.value[0].uid);\n            return;\n        }\n        let item;\n        // 如果类型是number，则先通过索引进行查找\n        if (typeof value === 'number') {\n            item = (_a = items.value) === null || _a === void 0 ? void 0 : _a[value];\n        }\n        // 如果没有找到，则通过name查找\n        if (!item) {\n            item = items.value.find((item) => { return item.name === value; });\n        }\n        if (!item) {\n            // 设置第一个Item为激活状态\n            updateActiveUid(items.value[0].uid);\n        }\n        else {\n            updateActiveUid(item.uid);\n        }\n    };\n    watch(() => { return props.modelValue; }, (val) => {\n        updateActiveItemByValue(val);\n    });\n    let initCount = 0;\n    // 获取Tabs容器节点信息\n    const getTabsRectInfo = () => { return __awaiter(void 0, void 0, void 0, function* () {\n        try {\n            const rectInfo = yield getSelectorNodeInfo(`#${componentId}`);\n            initCount = 0;\n            tabsRect.width = rectInfo.width || 0;\n            tabsRect.height = rectInfo.height || 0;\n            tabsRect.left = rectInfo.left || 0;\n        }\n        catch (err) {\n            if (initCount > 10) {\n                initCount = 0;\n                debugWarn('TnTabs', `获取Tabs容器节点信息出错: ${err}`);\n                return;\n            }\n            initCount++;\n            setTimeout(() => {\n                getTabsRectInfo();\n            }, 150);\n        }\n    }); };\n    // 获取Bar滑块的容器节点信息\n    const getBarRectInfo = () => { return __awaiter(void 0, void 0, void 0, function* () {\n        if (!props.bar && !slots.bar)\n            return;\n        try {\n            const rectInfo = yield getSelectorNodeInfo(`#${barComponentId}`);\n            initCount = 0;\n            barRect.width = rectInfo.width || 0;\n            barRect.height = rectInfo.height || 0;\n            barRect.left = rectInfo.left || 0;\n        }\n        catch (err) {\n            if (initCount > 10) {\n                initCount = 0;\n                debugWarn('TnTabs', `获取Bar滑块节点信息出错: ${err}`);\n                return;\n            }\n            initCount++;\n            setTimeout(() => {\n                getBarRectInfo();\n            }, 150);\n        }\n    }); };\n    onMounted(() => {\n        nextTick(() => {\n            getTabsRectInfo();\n            getBarRectInfo();\n        });\n    });\n    provide(tabsContextKey, reactive(Object.assign(Object.assign({}, toRefs(props)), { items,\n        activeUid,\n        showBar,\n        addItem,\n        removeItem,\n        setActiveItem })));\n    return {\n        tabItems: items,\n        componentId,\n        barComponentId,\n        barOffsetLeft,\n        scrollLeft,\n        showBar,\n    };\n};\n//# sourceMappingURL=D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/tabs/src/composables/use-tabs.js.map","references":["D:/Development/HBuilderX/plugins/uniapp-cli-vite/node_modules/@vue/runtime-core/dist/runtime-core.d.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/constants/index.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/tokens/index.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/hooks/index.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/utils/index.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/tokens/index.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/tabs/src/tabs.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/tabs/src/types.ts"],"uniExtApis":[],"map":"{\"version\":3,\"file\":\"use-tabs.js\",\"sourceRoot\":\"\",\"sources\":[\"use-tabs.ts\"],\"names\":[],\"mappings\":\"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\"}"}
