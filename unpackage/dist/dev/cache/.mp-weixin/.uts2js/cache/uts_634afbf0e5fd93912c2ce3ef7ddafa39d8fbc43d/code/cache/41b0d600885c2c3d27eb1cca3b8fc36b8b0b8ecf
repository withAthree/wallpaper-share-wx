{"code":"import { __awaiter, __read } from \"tslib\";\nimport { computed, getCurrentInstance, nextTick, onMounted, ref, watch, } from 'vue';\nimport { useSelectorQuery, useTouch, useUniAppSystemRectInfo, } from '../../../../hooks';\nimport { debugWarn, generateId } from '../../../../utils';\nexport const useIndexList = (props, emits) => {\n    const instance = getCurrentInstance();\n    if (!instance) {\n        debugWarn('TnIndexList', '请在 setup 中使用 useIndexList');\n    }\n    const componentId = generateId();\n    const componentContentClass = `tilc-${componentId}`;\n    const componentKeyListId = `tilkl-${componentId}`;\n    const _a = useSelectorQuery(instance), getSelectorNodeInfo = _a.getSelectorNodeInfo, getSelectorNodeInfos = _a.getSelectorNodeInfos;\n    // 索引列表数据\n    const keysData = computed(() => { return Object.keys(props.data); });\n    // 列表数据\n    const listData = ref([]);\n    watch(() => { return props.data; }, (val) => {\n        // 带星标的数据\n        const starData = {\n            key: '★',\n            title: '★',\n            data: [],\n        };\n        listData.value = Object.entries(val).map((_a) => {\n            var _b = __read(_a, 2), key = _b[0], value = _b[1];\n            starData.data = starData.data.concat(value.data.filter((item) => { return item === null || item === void 0 ? void 0 : item.star; }));\n            return {\n                key,\n                title: value.title,\n                data: value.data,\n            };\n        });\n        if (starData.data.length) {\n            if (!keysData.value.includes('★')) {\n                keysData.value.unshift('★');\n            }\n            listData.value.unshift(starData);\n        }\n    }, {\n        immediate: true,\n    });\n    // 容器的高度\n    const systemScreenInfo = useUniAppSystemRectInfo().systemScreenInfo;\n    const contentContainerHeight = computed(() => { return props.height || systemScreenInfo.height - props.stickyOffsetTop; });\n    // 内容节点的top值\n    let contentTopValues = [];\n    // scroll-view的top值\n    const scrollViewTopValue = ref(0);\n    // 获取全部列表项的节点信息\n    let initCount = 0;\n    const getContentItemNodeInfo = () => { return __awaiter(void 0, void 0, void 0, function* () {\n        try {\n            const contentNodeInfos = yield getSelectorNodeInfos(`.${componentContentClass}`);\n            initCount = 0;\n            contentTopValues = contentNodeInfos.map((item) => { return item.top || 0; });\n        }\n        catch (err) {\n            if (initCount > 10) {\n                initCount = 0;\n                debugWarn('TnIndexList', `获取全部列表项的节点信息失败：${err}`);\n                return;\n            }\n            initCount++;\n            setTimeout(() => {\n                getContentItemNodeInfo();\n            }, 150);\n        }\n    }); };\n    const _b = useTouch(), keyListTouchCurrentY = _b.currentY, updateKeyListTouchOptions = _b.updateOptions, keyListTouchStartEvent = _b.onTouchStart, keyListTouchMoveEvent = _b.onTouchMove, keyListTouchEndEvent = _b.onTouchEnd;\n    // 获取索引列表的容器信息\n    let keyListTop = 0;\n    let keyListItemRectInfo = [];\n    const getKeyListNodeInfo = () => { return __awaiter(void 0, void 0, void 0, function* () {\n        try {\n            const keyListNodeInfo = yield getSelectorNodeInfo(`#${componentKeyListId}`);\n            const keyListItemNodeInfo = yield getSelectorNodeInfos(`#${componentKeyListId} .key-value`);\n            initCount = 0;\n            keyListTop = keyListNodeInfo.top || 0;\n            keyListItemRectInfo = keyListItemNodeInfo.map((item) => {\n                return {\n                    top: (item.top || 0) - keyListTop,\n                    height: item.height || 0,\n                };\n            });\n            updateKeyListTouchOptions({\n                left: keyListNodeInfo.left,\n                right: keyListNodeInfo.right,\n                top: keyListNodeInfo.top,\n                bottom: keyListNodeInfo.bottom,\n            });\n        }\n        catch (err) {\n            if (initCount > 10) {\n                initCount = 0;\n                debugWarn('TnIndexList', `获取索引列表的容器信息失败：${err}`);\n                return;\n            }\n            initCount++;\n            setTimeout(() => {\n                getKeyListNodeInfo();\n            }, 150);\n        }\n    }); };\n    // 提示框的top值\n    const keyListTipsTopValue = ref(0);\n    const currentTouchKeyIndex = ref(-1);\n    const currentTouchKeyValue = computed(() => { return keysData.value[currentTouchKeyIndex.value]; });\n    // 设置当前滑动、点击索引的值\n    const updateKeyListIndexValue = () => {\n        // 判断当前滑动位置在哪里\n        let index = -1;\n        index = keyListItemRectInfo.findLastIndex((item) => { return item.top < keyListTouchCurrentY.value; });\n        if (index !== -1) {\n            const keyListRectItem = keyListItemRectInfo[index];\n            keyListTipsTopValue.value =\n                keyListRectItem.top + keyListRectItem.height / 2;\n            const top_1 = contentTopValues[index];\n            scrollViewTopValue.value = top_1 - contentTopValues[0];\n            currentTouchKeyIndex.value = index;\n        }\n    };\n    // 触摸事件\n    const onKeyListTouchStart = (event) => {\n        keyListTouchStartEvent(event);\n    };\n    const onKeyListTouchMove = (event) => {\n        keyListTouchMoveEvent(event);\n        updateKeyListIndexValue();\n    };\n    const onKeyListTouchEnd = (event) => {\n        keyListTouchEndEvent(event);\n        updateKeyListIndexValue();\n        emits('click', currentTouchKeyValue.value);\n        currentTouchKeyIndex.value = -1;\n    };\n    onMounted(() => {\n        nextTick(() => {\n            getContentItemNodeInfo();\n            if (props.showKeysList)\n                getKeyListNodeInfo();\n        });\n    });\n    return {\n        componentContentClass,\n        contentContainerHeight,\n        keysData,\n        listData,\n        scrollViewTopValue,\n        componentKeyListId,\n        keyListTipsTopValue,\n        currentTouchKeyIndex,\n        currentTouchKeyValue,\n        onKeyListTouchStart,\n        onKeyListTouchMove,\n        onKeyListTouchEnd,\n    };\n};\n//# sourceMappingURL=D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/index-list/src/composables/use-index-list.js.map","references":["D:/Development/HBuilderX/plugins/uniapp-cli-vite/node_modules/@vue/runtime-core/dist/runtime-core.d.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/hooks/index.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/utils/index.ts","D:/Development/HBuilderX/plugins/uniapp-cli-vite/node_modules/@vue/runtime-core/dist/runtime-core.d.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/index-list/src/index-list.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/index-list/src/types.ts"],"uniExtApis":[],"map":"{\"version\":3,\"file\":\"use-index-list.js\",\"sourceRoot\":\"\",\"sources\":[\"use-index-list.ts\"],\"names\":[],\"mappings\":\"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\"}"}
