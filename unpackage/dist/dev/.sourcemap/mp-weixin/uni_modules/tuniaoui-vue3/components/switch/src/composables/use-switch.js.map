{"version":3,"file":"use-switch.js","sources":["uni_modules/tuniaoui-vue3/components/switch/src/composables/use-switch.ts"],"sourcesContent":["import { computed, getCurrentInstance, nextTick, watch } from 'vue'\r\nimport { debugWarn, isBoolean, isPromise } from '../../../../utils'\r\nimport { CHANGE_EVENT, UPDATE_MODEL_EVENT } from '../../../../constants'\r\nimport { useFormItem } from '../../../form'\r\nimport { useSwitchCommonProps } from './use-switch-common-props'\r\n\r\nimport type { SwitchProps } from '../switch'\r\n\r\nexport const useSwitch = (props: SwitchProps) => {\r\n  const { emit } = getCurrentInstance()!\r\n\r\n  const { formItem } = useFormItem()\r\n\r\n  const { disabled } = useSwitchCommonProps(props)\r\n\r\n  // 判断是否为选中状态\r\n  const selected = computed<boolean>(\r\n    () => props.modelValue === props.activeValue\r\n  )\r\n\r\n  // 处理切换事件\r\n  const handleSwitch = () => {\r\n    const value =\r\n      props.modelValue === props.activeValue\r\n        ? props.inactiveValue\r\n        : props.activeValue\r\n\r\n    emit(UPDATE_MODEL_EVENT, value)\r\n    nextTick(() => emit(CHANGE_EVENT, value))\r\n  }\r\n\r\n  // switch按钮的点击切换事件\r\n  const switchClickEvent = () => {\r\n    if (disabled.value || props.loading) return\r\n\r\n    const { beforeChange } = props\r\n    if (!beforeChange) {\r\n      handleSwitch()\r\n      return\r\n    }\r\n\r\n    const shouldChange = beforeChange()\r\n\r\n    const isPromiseOrBool = [\r\n      isPromise(shouldChange),\r\n      isBoolean(shouldChange),\r\n    ].includes(true)\r\n    if (!isPromiseOrBool) {\r\n      throw new Error(\r\n        '[TnSwitch] beforeChange 返回值必须是 Promise 或者 boolean'\r\n      )\r\n    }\r\n\r\n    if (isPromise(shouldChange)) {\r\n      shouldChange\r\n        .then((res) => {\r\n          if (res) handleSwitch()\r\n        })\r\n        .catch((err) => {\r\n          // eslint-disable-next-line no-console\r\n          console.warn(`[TnSwitch] some error occured: ${err}`)\r\n        })\r\n    } else if (shouldChange) {\r\n      handleSwitch()\r\n    }\r\n  }\r\n\r\n  watch(\r\n    () => props.modelValue,\r\n    () => {\r\n      if (props.validateEvent) {\r\n        formItem?.validate?.('change').catch((err) => {\r\n          debugWarn(err)\r\n        })\r\n      }\r\n    }\r\n  )\r\n\r\n  return {\r\n    selected,\r\n    switchClickEvent,\r\n  }\r\n}\r\n"],"names":["getCurrentInstance","useFormItem","useSwitchCommonProps","computed","UPDATE_MODEL_EVENT","nextTick","CHANGE_EVENT","isPromise","isBoolean","uni","watch","debugWarn"],"mappings":";;;;;;;;;AAQO,MAAM,YAAY,CAAC,UAAkB;AAClC,QAAA,OAASA,iCAAqB;AAE9B,QAAA,WAAaC,iFAAa;AAE1B,QAAA,WAAaC,gFAAAA,qBAAqB,KAAK;AAG/C,QAAM,WAAWC,uBACf,MAAA;AAAM,WAAA,MAAM,eAAe,MAAM;AAAA,EAA3B,CAAsC;AAI9C,QAAM,eAAe,MAAA;AACnB,UAAM,QACJ,MAAM,eAAe,MAAM,cACvB,MAAM,gBACN,MAAM;AAEZ,SAAKC,yCAAAA,oBAAoB,KAAK;AAC9BC,kBAAQ,WAAC,MAAA;AAAM,aAAA,KAAKC,yCAAY,cAAE,KAAK;AAAA,IAAC,CAAA;AAAA,EAC1C;AAGA,QAAM,mBAAmB,MAAA;AACvB,QAAI,SAAS,SAAS,MAAM;AAAS;AAE7B,UAAA,eAAiB,MAAK;AAC9B,QAAI,CAAC,cAAc;AACjB;AACA;AAAA,IACD;AAED,UAAM,eAAe;AAErB,UAAM,kBAAkB;AAAA,MACtBC,cAAAA,UAAU,YAAY;AAAA,MACtBC,+CAAAA,UAAU,YAAY;AAAA,IACvB,EAAC,SAAS,IAAI;AACf,QAAI,CAAC,iBAAiB;AACpB,YAAM,IAAI,MACR,mDAAmD;AAAA,IAEtD;AAED,QAAID,cAAAA,UAAU,YAAY,GAAG;AAC3B,mBACG,KAAK,CAAC,QAAG;AACR,YAAI;AAAK;MACX,CAAC,EACA,MAAM,CAAC,QAAG;AAETE,sBAAa,MAAA,MAAA,QAAA,mFAAA,kCAAkC,GAAG,EAAE;AAAA,MACtD,CAAC;AAAA,IACJ,WAAU,cAAc;AACvB;IACD;AAAA,EACH;AAEAC,gBAAAA,MACE;AAAM,WAAA,MAAM;AAAA,EAAU,GACtB,MAAA;;AACE,QAAI,MAAM,eAAe;AACvB,OAAA,KAAA,aAAQ,QAAR,aAAQ,SAAA,SAAR,SAAU,cAAQ,QAAA,OAAA,SAAA,SAAA,GAAA,KAAA,UAAG,QAAQ,EAAE,MAAM,CAAC,QAAG;AACvCC,6CAAS,UAAC,GAAG;AAAA,MACf,CAAC;AAAA,IACF;AAAA,EACH,CAAC;AAGH,SAAO;AAAA,IACL;AAAA,IACA;AAAA;AAEJ;;"}