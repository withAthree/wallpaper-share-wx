{"code":"import { __awaiter } from \"tslib\";\nimport { computed, getCurrentInstance, inject, nextTick, onUnmounted, ref, } from 'vue';\nimport { avatarGroupContextKey } from '../../../../tokens';\nimport { useSelectorQuery } from '../../../../hooks';\nimport { debugWarn, generateId, isEmptyVariableInDefault, } from '../../../../utils';\nexport const useAvatar = (props, emits) => {\n    const instance = getCurrentInstance();\n    if (!instance) {\n        debugWarn('TnAvatarGroup', '请在 setup 中使用 useAvatarGroup');\n    }\n    const uid = instance.uid;\n    const avatarGroup = inject(avatarGroupContextKey, undefined);\n    avatarGroup === null || avatarGroup === void 0 ? void 0 : avatarGroup.addItem({ uid });\n    const componentId = `ta-${generateId()}`;\n    const getSelectorNodeInfo = useSelectorQuery(instance).getSelectorNodeInfo;\n    // 头像组头像数量\n    const groupAvatarCount = computed(() => {\n        return isEmptyVariableInDefault(avatarGroup === null || avatarGroup === void 0 ? void 0 : avatarGroup.avatarItems.length, 0);\n    });\n    const avatarGroupIndex = ref(-1);\n    nextTick(() => {\n        // 获取当前头像的索引\n        const avatarIndex = avatarGroup === null || avatarGroup === void 0 ? void 0 : avatarGroup.avatarItems.findIndex((item) => { return item.uid === uid; });\n        avatarGroupIndex.value = isEmptyVariableInDefault(avatarIndex, -1);\n        if (!avatarWidth.value && avatarGroupIndex.value !== -1) {\n            getAvatarWidthNodeInfo();\n        }\n    });\n    // 头像宽度信息\n    const avatarWidth = ref(0);\n    // 获取头像的宽度信息\n    let initCount = 0;\n    const getAvatarWidthNodeInfo = () => { return __awaiter(void 0, void 0, void 0, function* () {\n        try {\n            const rectInfo = yield getSelectorNodeInfo(`#${componentId}`);\n            if (!rectInfo.width) {\n                throw new Error('获取头像宽度信息失败');\n            }\n            avatarWidth.value = rectInfo.width || 0;\n        }\n        catch (err) {\n            if (initCount > 10) {\n                initCount = 0;\n                debugWarn('TnAvatar', `获取头像宽度信息失败：${err}`);\n                return;\n            }\n            initCount++;\n            setTimeout(() => {\n                getAvatarWidthNodeInfo();\n            }, 150);\n        }\n    }); };\n    const avatarClick = () => {\n        avatarGroup === null || avatarGroup === void 0 ? void 0 : avatarGroup.handleItemClick(uid);\n        emits('click');\n    };\n    onUnmounted(() => {\n        avatarGroup === null || avatarGroup === void 0 ? void 0 : avatarGroup.removeItem(uid);\n    });\n    return {\n        componentId,\n        groupAvatarCount,\n        avatarGroupIndex,\n        avatarWidth,\n        avatarClick,\n    };\n};\n//# sourceMappingURL=D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/avatar/src/composables/use-avatar.js.map","references":["D:/Development/HBuilderX/plugins/uniapp-cli-vite/node_modules/@vue/runtime-core/dist/runtime-core.d.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/tokens/index.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/hooks/index.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/utils/index.ts","D:/Development/HBuilderX/plugins/uniapp-cli-vite/node_modules/@vue/runtime-core/dist/runtime-core.d.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/avatar/src/avatar.ts"],"uniExtApis":[],"map":"{\"version\":3,\"file\":\"use-avatar.js\",\"sourceRoot\":\"\",\"sources\":[\"use-avatar.ts\"],\"names\":[],\"mappings\":\"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\"}"}
