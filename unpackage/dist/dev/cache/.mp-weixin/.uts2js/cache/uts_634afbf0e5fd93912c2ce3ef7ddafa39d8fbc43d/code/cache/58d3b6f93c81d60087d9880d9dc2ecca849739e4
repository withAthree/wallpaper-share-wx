{"code":"import { __awaiter, __read } from \"tslib\";\nimport { computed, getCurrentInstance, nextTick, onMounted, ref, watch, } from 'vue';\nimport { useSelectorQuery, useToggle } from '../../../../hooks';\nimport { debugWarn, formatDomSizeValue, generateId, isBoolean, isPromise, } from '../../../../utils';\nexport const useReadMore = (props, emits) => {\n    const instance = getCurrentInstance();\n    if (!instance) {\n        debugWarn('TnReadMore', '请在 setup 中使用 useReadMore');\n    }\n    const componentId = `trm-${generateId()}`;\n    const componentContentId = `${componentId}-content`;\n    const getSelectorNodeInfo = useSelectorQuery(instance).getSelectorNodeInfo;\n    // 是否展开状态\n    const _a = __read(useToggle(props.expand || false), 2), expandStatus = _a[0], toggleExpand = _a[1];\n    watch(() => { return props.expand; }, (val) => {\n        expandStatus.value = val;\n    });\n    // 是否显示操作区域\n    const showOperationArea = computed(() => { return !expandStatus.value || (expandStatus.value && props.showFold); });\n    // 操作区域高度\n    const foldOperationAreaHeight = 40;\n    // 容器高度\n    const containerHeight = computed(() => {\n        if (!expandStatus.value) {\n            return formatDomSizeValue(props.height);\n        }\n        else {\n            return `calc(${formatDomSizeValue(contentHeight.value, 'px')} + ${foldOperationAreaHeight}rpx)`;\n        }\n    });\n    // 内容区域的高度\n    let contentHeight = ref(0);\n    // 获取内容区域容器信息\n    let initCount = 0;\n    const getContentRectInfo = () => { return __awaiter(void 0, void 0, void 0, function* () {\n        try {\n            const rectInfo = yield getSelectorNodeInfo(`#${componentContentId}`);\n            initCount = 0;\n            contentHeight.value = rectInfo.height || 0;\n        }\n        catch (err) {\n            if (initCount > 10) {\n                initCount = 0;\n                debugWarn('TnReadMore', `获取内容容器信息失败: ${err}`);\n                return;\n            }\n            initCount++;\n            setTimeout(() => {\n                getContentRectInfo();\n            }, 150);\n        }\n    }); };\n    // 重置内容容器的高度\n    const resetContentHeight = () => {\n        nextTick(() => {\n            getContentRectInfo();\n        });\n    };\n    // 设置为展开\n    const setExpand = () => {\n        emits('expand');\n        toggleExpand();\n    };\n    // 设置为折叠\n    const setFold = () => {\n        emits('fold');\n        toggleExpand();\n    };\n    // 切换折叠、展开状态\n    const toggleExpandStatus = () => {\n        if (expandStatus.value) {\n            setFold();\n        }\n        else {\n            const beforeExpand = props.beforeExpand;\n            if (!beforeExpand) {\n                setExpand();\n                return;\n            }\n            const shouldExpand = beforeExpand();\n            const isPromiseOrBoolean = [\n                isPromise(shouldExpand),\n                isBoolean(shouldExpand),\n            ].includes(true);\n            if (!isPromiseOrBoolean) {\n                debugWarn('TnReadMore', 'beforeExpand 必须返回 Promise 或者 boolean 类型');\n                return;\n            }\n            if (isPromise(shouldExpand)) {\n                shouldExpand.then((res) => {\n                    if (res) {\n                        setExpand();\n                    }\n                });\n            }\n            else {\n                if (shouldExpand) {\n                    setExpand();\n                }\n            }\n        }\n    };\n    onMounted(() => {\n        nextTick(() => {\n            getContentRectInfo();\n        });\n    });\n    return {\n        componentContentId,\n        showOperationArea,\n        foldOperationAreaHeight,\n        containerHeight,\n        expandStatus,\n        toggleExpandStatus,\n        resetContentHeight,\n    };\n};\n//# sourceMappingURL=D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/read-more/src/composables/use-read-more.js.map","references":["D:/Development/HBuilderX/plugins/uniapp-cli-vite/node_modules/@vue/runtime-core/dist/runtime-core.d.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/hooks/index.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/utils/index.ts","D:/Development/HBuilderX/plugins/uniapp-cli-vite/node_modules/@vue/runtime-core/dist/runtime-core.d.ts","D:/Development/project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/read-more/src/read-more.ts"],"uniExtApis":[],"map":"{\"version\":3,\"file\":\"use-read-more.js\",\"sourceRoot\":\"\",\"sources\":[\"use-read-more.ts\"],\"names\":[],\"mappings\":\"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\"}"}
