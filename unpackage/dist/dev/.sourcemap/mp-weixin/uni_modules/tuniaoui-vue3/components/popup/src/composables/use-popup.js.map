{"version":3,"file":"use-popup.js","sources":["uni_modules/tuniaoui-vue3/components/popup/src/composables/use-popup.ts"],"sourcesContent":["import { computed, getCurrentInstance, ref, watch } from 'vue'\r\nimport { UPDATE_MODEL_EVENT } from '../../../../constants'\r\n\r\nimport type { PopupProps } from '../popup'\r\n\r\nexport const usePopup = (props: PopupProps) => {\r\n  const { emit } = getCurrentInstance()!\r\n  const iosDevice = computed<boolean>(() => {\r\n    const systemInfo = uni.getSystemInfoSync()\r\n    return systemInfo.osName === 'ios' || systemInfo.osName === 'macos'\r\n  })\r\n\r\n  // 是否显示遮罩层\r\n  const showOverlay = ref(false)\r\n  // 是否显示弹框\r\n  const showPopup = ref(false)\r\n  const visiblePopup = ref(false)\r\n  let initPopupModelValue = false\r\n  watch(\r\n    () => props.modelValue,\r\n    (value) => {\r\n      if (value) {\r\n        visiblePopup.value = true\r\n        if (iosDevice.value) {\r\n          setTimeout(() => {\r\n            showPopup.value = true\r\n            if (props.overlay) showOverlay.value = true\r\n            initPopupModelValue && emit('open')\r\n          }, 0)\r\n        } else {\r\n          showPopup.value = true\r\n          if (props.overlay) showOverlay.value = true\r\n          initPopupModelValue && emit('open')\r\n        }\r\n      } else {\r\n        showPopup.value = false\r\n        showOverlay.value = false\r\n        setTimeout(() => {\r\n          visiblePopup.value = false\r\n        }, 250)\r\n        initPopupModelValue && emit('close')\r\n      }\r\n      initPopupModelValue = true\r\n    },\r\n    {\r\n      immediate: true,\r\n    }\r\n  )\r\n\r\n  // 更新模态框的状态\r\n  const updateModelValue = (value: boolean) => {\r\n    emit(UPDATE_MODEL_EVENT, value)\r\n  }\r\n\r\n  // 点击关闭按钮\r\n  const onClickCloseBtn = () => {\r\n    updateModelValue(false)\r\n    emit('close')\r\n  }\r\n\r\n  // 点击遮罩层关闭模态框\r\n  const onClickOverlay = () => {\r\n    if (props.overlayCloseable) {\r\n      updateModelValue(false)\r\n      emit('close')\r\n      emit('overlay-click')\r\n    }\r\n  }\r\n\r\n  return {\r\n    iosDevice,\r\n    showOverlay,\r\n    showPopup,\r\n    visiblePopup,\r\n    updateModelValue,\r\n    onClickCloseBtn,\r\n    onClickOverlay,\r\n  }\r\n}\r\n"],"names":["getCurrentInstance","computed","uni","ref","watch","UPDATE_MODEL_EVENT"],"mappings":";;;AAKO,MAAM,WAAW,CAAC,UAAiB;AAChC,QAAA,OAASA,iCAAqB;AACtC,QAAM,YAAYC,cAAAA,SAAkB,MAAA;AAClC,UAAM,aAAaC,oBAAI;AACvB,WAAO,WAAW,WAAW,SAAS,WAAW,WAAW;AAAA,EAC9D,CAAC;AAGD,QAAM,cAAcC,kBAAI,KAAK;AAE7B,QAAM,YAAYA,kBAAI,KAAK;AAC3B,QAAM,eAAeA,kBAAI,KAAK;AAC9B,MAAI,sBAAsB;AAC1BC,gBAAK,MACH,MAAM;AAAA,WAAA,MAAM;AAAA,EAAN,GACN,CAAC,UAAK;AACJ,QAAI,OAAO;AACT,mBAAa,QAAQ;AACrB,UAAI,UAAU,OAAO;AACnB,mBAAW,MAAA;AACT,oBAAU,QAAQ;AAClB,cAAI,MAAM;AAAS,wBAAY,QAAQ;AACvC,iCAAuB,KAAK,MAAM;AAAA,QACnC,GAAE,CAAC;AAAA,MACL,OAAM;AACL,kBAAU,QAAQ;AAClB,YAAI,MAAM;AAAS,sBAAY,QAAQ;AACvC,+BAAuB,KAAK,MAAM;AAAA,MACnC;AAAA,IACF,OAAM;AACL,gBAAU,QAAQ;AAClB,kBAAY,QAAQ;AACpB,iBAAW,MAAA;AACT,qBAAa,QAAQ;AAAA,MACtB,GAAE,GAAG;AACN,6BAAuB,KAAK,OAAO;AAAA,IACpC;AACD,0BAAsB;AAAA,EACxB,GACA;AAAA,IACE,WAAW;AAAA,EACZ,CAAA;AAIH,QAAM,mBAAmB,CAAC,UAAc;AACtC,SAAKC,yCAAAA,oBAAoB,KAAK;AAAA,EAChC;AAGA,QAAM,kBAAkB,MAAA;AACtB,qBAAiB,KAAK;AACtB,SAAK,OAAO;AAAA,EACd;AAGA,QAAM,iBAAiB,MAAA;AACrB,QAAI,MAAM,kBAAkB;AAC1B,uBAAiB,KAAK;AACtB,WAAK,OAAO;AACZ,WAAK,eAAe;AAAA,IACrB;AAAA,EACH;AAEA,SAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA;AAEJ;;"}