{"code":"import { __awaiter } from \"tslib\";\nimport { computed, getCurrentInstance, nextTick, onMounted, onUnmounted, ref, } from 'vue';\nimport { useObserver, useSelectorQuery } from '../../../../hooks';\nimport { debugWarn, generateId, isEmptyVariableInDefault, } from '../../../../utils';\nexport const useLazyLoad = (props) => {\n    const instance = getCurrentInstance();\n    if (!instance) {\n        debugWarn('TnLazyLoad', '请在 setup 中使用 useLazyLoad');\n    }\n    const emit = instance.emit;\n    const getSelectorNodeInfo = useSelectorQuery(instance).getSelectorNodeInfo;\n    const _a = useObserver(instance), connectObserver = _a.connectObserver, disconnectObserver = _a.disconnectObserver;\n    const componentId = `tll-${generateId()}`;\n    // 图片触发加载位置\n    const threshold = computed(() => {\n        return isEmptyVariableInDefault(props.threshold, 100);\n    });\n    // 图片加载状态\n    const imageStatus = ref('waiting');\n    // 开始显示图片\n    const showImage = ref(false);\n    let initCount = 0;\n    // 初始化监听事件\n    const initObserver = () => { return __awaiter(void 0, void 0, void 0, function* () {\n        disconnectObserver();\n        try {\n            yield getSelectorNodeInfo(`#${componentId}`);\n            initCount = 0;\n            const bottomThreshold = threshold.value < 0\n                ? -Math.abs(threshold.value)\n                : Math.abs(threshold.value);\n            connectObserver(`#${componentId}`, (res) => {\n                if (res.intersectionRatio > 0) {\n                    // 开始显示图片\n                    showImage.value = true;\n                    imageStatus.value = 'loading';\n                    // 图片已加载关闭监听，减少资源消耗\n                    disconnectObserver();\n                }\n            }, {\n                type: 'relativeToViewport',\n                margins: {\n                    bottom: bottomThreshold,\n                },\n            });\n        }\n        catch (err) {\n            if (initCount > 10) {\n                initCount = 0;\n                debugWarn('TnLazyLoad', `获取图片节点信息失败：${err}`);\n                return;\n            }\n            initCount++;\n            setTimeout(() => {\n                initObserver();\n            }, 150);\n        }\n    }); };\n    // 图片加载完成事件\n    const handleImageLoadedSuccess = () => {\n        imageStatus.value = 'loaded';\n        emit('loaded');\n    };\n    // 图片加载失败事件\n    const handleImageLoadedFailed = (err) => {\n        debugWarn('TnLazyLoad', `图片加载失败: ${err}`);\n        imageStatus.value = 'error';\n        emit('error');\n    };\n    onMounted(() => {\n        nextTick(() => {\n            initObserver();\n        });\n    });\n    onUnmounted(() => {\n        disconnectObserver();\n    });\n    return {\n        componentId,\n        imageStatus,\n        showImage,\n        handleImageLoadedSuccess,\n        handleImageLoadedFailed,\n    };\n};\n//# sourceMappingURL=D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/lazy-load/src/composables/use-lazy-load.js.map","references":["D:/DEV/HBuilderX/plugins/uniapp-cli-vite/node_modules/@vue/runtime-core/dist/runtime-core.d.ts","D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/hooks/index.ts","D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/utils/index.ts","D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/lazy-load/src/lazy-load.ts","D:/DEV/Project/wallpaper-share-wx/uni_modules/tuniaoui-vue3/components/lazy-load/src/types.ts"],"uniExtApis":[],"map":"{\"version\":3,\"file\":\"use-lazy-load.js\",\"sourceRoot\":\"\",\"sources\":[\"use-lazy-load.ts\"],\"names\":[],\"mappings\":\"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\"}"}
