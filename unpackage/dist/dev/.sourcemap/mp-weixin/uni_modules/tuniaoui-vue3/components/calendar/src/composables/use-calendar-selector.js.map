{"version":3,"file":"use-calendar-selector.js","sources":["uni_modules/tuniaoui-vue3/components/calendar/src/composables/use-calendar-selector.ts"],"sourcesContent":["import { computed, getCurrentInstance, nextTick, onMounted, ref } from 'vue'\nimport { useSelectorQuery } from '../../../../hooks'\nimport { debugWarn, generateId } from '../../../../utils'\n\nimport type { Ref } from 'vue'\nimport type { CalendarMode } from '../calendar'\n\nexport const useCalendarSelector = (\n  currentDateCount: Ref<number>,\n  mode: CalendarMode\n) => {\n  const instance = getCurrentInstance()\n  if (!instance) {\n    debugWarn('TnCalendar', '请在 setup 函数中使用 useCalendarSelector')\n  }\n\n  const calendarId = `tc-${generateId()}`\n\n  const { getSelectorNodeInfo } = useSelectorQuery(instance)\n\n  // 单个日期的高度\n  const singleDateItemHeight = ref<number>(0)\n\n  // 日期容器的高度\n  const dateContainerHeight = computed<number>(\n    () => Math.ceil(currentDateCount.value / 7) * singleDateItemHeight.value\n  )\n\n  let initCount = 0\n  // 获取单个日期容器的信息\n  const getDateItemComponentRectInfo = async () => {\n    try {\n      const rectInfo = await getSelectorNodeInfo(\n        `#${calendarId} .tn-calendar__data__date`\n      )\n\n      initCount = 0\n      singleDateItemHeight.value = rectInfo.width || 0\n      if (mode === 'date' || mode === 'multi') {\n        singleDateItemHeight.value += uni.upx2px(12)\n      }\n    } catch (err) {\n      if (initCount > 10) {\n        initCount = 0\n        debugWarn('TnCalendar', `获取单个日期容器信息失败: ${err}`)\n        return\n      }\n      initCount++\n      setTimeout(() => {\n        getDateItemComponentRectInfo()\n      }, 150)\n    }\n  }\n\n  onMounted(() => {\n    nextTick(() => {\n      setTimeout(() => {\n        getDateItemComponentRectInfo()\n      }, 50)\n    })\n  })\n\n  return {\n    calendarId,\n    dateContainerHeight,\n  }\n}\n"],"names":["getCurrentInstance","debugWarn","generateId","useSelectorQuery","ref","computed","__awaiter","uni","onMounted","nextTick"],"mappings":";;;;;;;AAOa,MAAA,sBAAsB,CACjC,kBACA,SAAkB;AAElB,QAAM,WAAWA,cAAAA;AACjB,MAAI,CAAC,UAAU;AACbC,mDAAU,cAAc,oCAAoC;AAAA,EAC7D;AAED,QAAM,aAAa,MAAMC,oCAAU,WAAA,CAAE;AAE7B,QAAA,sBAAwBC,sDAAAA,iBAAiB,QAAQ;AAGzD,QAAM,uBAAuBC,kBAAY,CAAC;AAG1C,QAAM,sBAAsBC,cAAQ,SAClC;AAAM,WAAA,KAAK,KAAK,iBAAiB,QAAQ,CAAC,IAAI,qBAAqB;AAAA,EAAK,CAAA;AAG1E,MAAI,YAAY;AAEhB,QAAM,+BAA+B,MAAA;AAAA,WAAAC,cAAA,UAAA,QAAA,QAAA,QAAA,aAAA;AACnC,UAAI;AACF,cAAM,WAAW,MAAM,oBACrB,IAAI,UAAU,2BAA2B;AAG3C,oBAAY;AACZ,6BAAqB,QAAQ,SAAS,SAAS;AAC/C,YAAI,SAAS,UAAU,SAAS,SAAS;AACvC,+BAAqB,SAASC,cAAAA,MAAI,OAAO,EAAE;AAAA,QAC5C;AAAA,MACF,SAAQ,KAAK;AACZ,YAAI,YAAY,IAAI;AAClB,sBAAY;AACZN,+CAAAA,UAAU,cAAc,iBAAiB,GAAG,EAAE;AAC9C;AAAA,QACD;AACD;AACA,mBAAW,MAAA;AACT;QACD,GAAE,GAAG;AAAA,MACP;AAAA,IACF,CAAA;AAAA;AAEDO,gBAAAA,UAAU,MAAA;AACRC,kBAAAA,WAAS,MAAA;AACP,iBAAW,MAAA;AACT;MACD,GAAE,EAAE;AAAA,IACP,CAAC;AAAA,EACH,CAAC;AAED,SAAO;AAAA,IACL;AAAA,IACA;AAAA;AAEJ;;"}